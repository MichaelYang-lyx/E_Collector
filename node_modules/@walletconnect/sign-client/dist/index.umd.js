(function(Oe,Ze){typeof exports=="object"&&typeof module<"u"?Ze(exports):typeof define=="function"&&define.amd?define(["exports"],Ze):(Oe=typeof globalThis<"u"?globalThis:Oe||self,Ze(Oe["@walletconnect/sign-client"]={}))})(this,function(Oe){"use strict";var Ze=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Kt(t){var e=t.default;if(typeof e=="function"){var r=function(){return e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(i){var n=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(r,i,n.get?n:{enumerable:!0,get:function(){return t[i]}})}),r}var ht={exports:{}},ir=typeof Reflect=="object"?Reflect:null,Kn=ir&&typeof ir.apply=="function"?ir.apply:function(e,r,i){return Function.prototype.apply.call(e,r,i)},Wr;ir&&typeof ir.ownKeys=="function"?Wr=ir.ownKeys:Object.getOwnPropertySymbols?Wr=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Wr=function(e){return Object.getOwnPropertyNames(e)};function uc(t){console&&console.warn&&console.warn(t)}var Vn=Number.isNaN||function(e){return e!==e};function xe(){xe.init.call(this)}ht.exports=xe,ht.exports.once=dc,xe.EventEmitter=xe,xe.prototype._events=void 0,xe.prototype._eventsCount=0,xe.prototype._maxListeners=void 0;var Gn=10;function Yr(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(xe,"defaultMaxListeners",{enumerable:!0,get:function(){return Gn},set:function(t){if(typeof t!="number"||t<0||Vn(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");Gn=t}}),xe.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},xe.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Vn(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function kn(t){return t._maxListeners===void 0?xe.defaultMaxListeners:t._maxListeners}xe.prototype.getMaxListeners=function(){return kn(this)},xe.prototype.emit=function(e){for(var r=[],i=1;i<arguments.length;i++)r.push(arguments[i]);var n=e==="error",s=this._events;if(s!==void 0)n=n&&s.error===void 0;else if(!n)return!1;if(n){var a;if(r.length>0&&(a=r[0]),a instanceof Error)throw a;var c=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw c.context=a,c}var h=s[e];if(h===void 0)return!1;if(typeof h=="function")Kn(h,this,r);else for(var l=h.length,d=Qn(h,l),i=0;i<l;++i)Kn(d[i],this,r);return!0};function Wn(t,e,r,i){var n,s,a;if(Yr(r),s=t._events,s===void 0?(s=t._events=Object.create(null),t._eventsCount=0):(s.newListener!==void 0&&(t.emit("newListener",e,r.listener?r.listener:r),s=t._events),a=s[e]),a===void 0)a=s[e]=r,++t._eventsCount;else if(typeof a=="function"?a=s[e]=i?[r,a]:[a,r]:i?a.unshift(r):a.push(r),n=kn(t),n>0&&a.length>n&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=a.length,uc(c)}return t}xe.prototype.addListener=function(e,r){return Wn(this,e,r,!1)},xe.prototype.on=xe.prototype.addListener,xe.prototype.prependListener=function(e,r){return Wn(this,e,r,!0)};function lc(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Yn(t,e,r){var i={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},n=lc.bind(i);return n.listener=r,i.wrapFn=n,n}xe.prototype.once=function(e,r){return Yr(r),this.on(e,Yn(this,e,r)),this},xe.prototype.prependOnceListener=function(e,r){return Yr(r),this.prependListener(e,Yn(this,e,r)),this},xe.prototype.removeListener=function(e,r){var i,n,s,a,c;if(Yr(r),n=this._events,n===void 0)return this;if(i=n[e],i===void 0)return this;if(i===r||i.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||r));else if(typeof i!="function"){for(s=-1,a=i.length-1;a>=0;a--)if(i[a]===r||i[a].listener===r){c=i[a].listener,s=a;break}if(s<0)return this;s===0?i.shift():hc(i,s),i.length===1&&(n[e]=i[0]),n.removeListener!==void 0&&this.emit("removeListener",e,c||r)}return this},xe.prototype.off=xe.prototype.removeListener,xe.prototype.removeAllListeners=function(e){var r,i,n;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[e]),this;if(arguments.length===0){var s=Object.keys(i),a;for(n=0;n<s.length;++n)a=s[n],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=i[e],typeof r=="function")this.removeListener(e,r);else if(r!==void 0)for(n=r.length-1;n>=0;n--)this.removeListener(e,r[n]);return this};function Xn(t,e,r){var i=t._events;if(i===void 0)return[];var n=i[e];return n===void 0?[]:typeof n=="function"?r?[n.listener||n]:[n]:r?fc(n):Qn(n,n.length)}xe.prototype.listeners=function(e){return Xn(this,e,!0)},xe.prototype.rawListeners=function(e){return Xn(this,e,!1)},xe.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):Jn.call(t,e)},xe.prototype.listenerCount=Jn;function Jn(t){var e=this._events;if(e!==void 0){var r=e[t];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}xe.prototype.eventNames=function(){return this._eventsCount>0?Wr(this._events):[]};function Qn(t,e){for(var r=new Array(e),i=0;i<e;++i)r[i]=t[i];return r}function hc(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function fc(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function dc(t,e){return new Promise(function(r,i){function n(a){t.removeListener(e,s),i(a)}function s(){typeof t.removeListener=="function"&&t.removeListener("error",n),r([].slice.call(arguments))}Zn(t,e,s,{once:!0}),e!=="error"&&pc(t,n,{once:!0})})}function pc(t,e,r){typeof t.on=="function"&&Zn(t,"error",e,r)}function Zn(t,e,r,i){if(typeof t.on=="function")i.once?t.once(e,r):t.on(e,r);else if(typeof t.addEventListener=="function")t.addEventListener(e,function n(s){i.once&&t.removeEventListener(e,n),r(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var Xr={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var Ti=function(t,e){return Ti=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},Ti(t,e)};function gc(t,e){Ti(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Ni=function(){return Ni=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Ni.apply(this,arguments)};function yc(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function _c(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(s=(n<3?a(s):n>3?a(e,r,s):a(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function bc(t,e){return function(r,i){e(r,i,t)}}function wc(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function vc(t,e,r,i){function n(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(d){try{l(i.next(d))}catch(w){a(w)}}function h(d){try{l(i.throw(d))}catch(w){a(w)}}function l(d){d.done?s(d.value):n(d.value).then(c,h)}l((i=i.apply(t,e||[])).next())})}function mc(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(l){return function(d){return h([l,d])}}function h(l){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=l[0]&2?n.return:l[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,l[1])).done)return s;switch(n=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,n=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(d){l=[6,d],n=0}finally{i=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Ec(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function Sc(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Pi(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function es(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],a;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(c){a={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(a)throw a.error}}return s}function Dc(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(es(arguments[e]));return t}function Oc(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],a=0,c=s.length;a<c;a++,n++)i[n]=s[a];return i}function gr(t){return this instanceof gr?(this.v=t,this):new gr(t)}function xc(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(y){i[y]&&(n[y]=function(m){return new Promise(function(S,R){s.push([y,m,S,R])>1||c(y,m)})})}function c(y,m){try{h(i[y](m))}catch(S){w(s[0][3],S)}}function h(y){y.value instanceof gr?Promise.resolve(y.value.v).then(l,d):w(s[0][2],y)}function l(y){c("next",y)}function d(y){c("throw",y)}function w(y,m){y(m),s.shift(),s.length&&c(s[0][0],s[0][1])}}function Ic(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(a){return(r=!r)?{value:gr(t[n](a)),done:n==="return"}:s?s(a):a}:s}}function Tc(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Pi=="function"?Pi(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(a){return new Promise(function(c,h){a=t[s](a),n(c,h,a.done,a.value)})}}function n(s,a,c,h){Promise.resolve(h).then(function(l){s({value:l,done:c})},a)}}function Nc(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function Pc(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function Rc(t){return t&&t.__esModule?t:{default:t}}function Ac(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function Cc(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var Lc=Object.freeze({__proto__:null,__extends:gc,get __assign(){return Ni},__rest:yc,__decorate:_c,__param:bc,__metadata:wc,__awaiter:vc,__generator:mc,__createBinding:Ec,__exportStar:Sc,__values:Pi,__read:es,__spread:Dc,__spreadArrays:Oc,__await:gr,__asyncGenerator:xc,__asyncDelegator:Ic,__asyncValues:Tc,__makeTemplateObject:Nc,__importStar:Pc,__importDefault:Rc,__classPrivateFieldGet:Ac,__classPrivateFieldSet:Cc}),ts=Kt(Lc),yr={};Object.defineProperty(yr,"__esModule",{value:!0});function Fc(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return JSON.parse(t)}catch{return t}}yr.safeJsonParse=Fc;function Uc(t){return typeof t=="string"?t:JSON.stringify(t,(e,r)=>typeof r>"u"?null:r)}yr.safeJsonStringify=Uc;var _r={exports:{}},rs;function $c(){return rs||(rs=1,function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,i){this[r]=String(i)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(i){r[i]=void 0,delete r[i]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Ze<"u"&&Ze.localStorage?_r.exports=Ze.localStorage:typeof window<"u"&&window.localStorage?_r.exports=window.localStorage:_r.exports=new e}()),_r.exports}var Ri={},br={},is;function Mc(){if(is)return br;is=1,Object.defineProperty(br,"__esModule",{value:!0}),br.IKeyValueStorage=void 0;class t{}return br.IKeyValueStorage=t,br}var wr={},ns;function jc(){if(ns)return wr;ns=1,Object.defineProperty(wr,"__esModule",{value:!0}),wr.parseEntry=void 0;const t=yr;function e(r){var i;return[r[0],t.safeJsonParse((i=r[1])!==null&&i!==void 0?i:"")]}return wr.parseEntry=e,wr}var ss;function qc(){return ss||(ss=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=ts;e.__exportStar(Mc(),t),e.__exportStar(jc(),t)}(Ri)),Ri}Object.defineProperty(Xr,"__esModule",{value:!0}),Xr.KeyValueStorage=void 0;const nr=ts,os=yr,Bc=nr.__importDefault($c()),zc=qc();class as{constructor(){this.localStorage=Bc.default}getKeys(){return nr.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return nr.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(zc.parseEntry)})}getItem(e){return nr.__awaiter(this,void 0,void 0,function*(){const r=this.localStorage.getItem(e);if(r!==null)return os.safeJsonParse(r)})}setItem(e,r){return nr.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(e,os.safeJsonStringify(r))})}removeItem(e){return nr.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(e)})}}Xr.KeyValueStorage=as;var Hc=Xr.default=as,sr={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var Ai=function(t,e){return Ai=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},Ai(t,e)};function Kc(t,e){Ai(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Ci=function(){return Ci=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Ci.apply(this,arguments)};function Vc(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function Gc(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(s=(n<3?a(s):n>3?a(e,r,s):a(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function kc(t,e){return function(r,i){e(r,i,t)}}function Wc(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Yc(t,e,r,i){function n(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(d){try{l(i.next(d))}catch(w){a(w)}}function h(d){try{l(i.throw(d))}catch(w){a(w)}}function l(d){d.done?s(d.value):n(d.value).then(c,h)}l((i=i.apply(t,e||[])).next())})}function Xc(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(l){return function(d){return h([l,d])}}function h(l){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=l[0]&2?n.return:l[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,l[1])).done)return s;switch(n=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,n=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(d){l=[6,d],n=0}finally{i=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Jc(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function Qc(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Li(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function cs(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],a;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(c){a={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(a)throw a.error}}return s}function Zc(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(cs(arguments[e]));return t}function eu(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],a=0,c=s.length;a<c;a++,n++)i[n]=s[a];return i}function vr(t){return this instanceof vr?(this.v=t,this):new vr(t)}function tu(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(y){i[y]&&(n[y]=function(m){return new Promise(function(S,R){s.push([y,m,S,R])>1||c(y,m)})})}function c(y,m){try{h(i[y](m))}catch(S){w(s[0][3],S)}}function h(y){y.value instanceof vr?Promise.resolve(y.value.v).then(l,d):w(s[0][2],y)}function l(y){c("next",y)}function d(y){c("throw",y)}function w(y,m){y(m),s.shift(),s.length&&c(s[0][0],s[0][1])}}function ru(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(a){return(r=!r)?{value:vr(t[n](a)),done:n==="return"}:s?s(a):a}:s}}function iu(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Li=="function"?Li(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(a){return new Promise(function(c,h){a=t[s](a),n(c,h,a.done,a.value)})}}function n(s,a,c,h){Promise.resolve(h).then(function(l){s({value:l,done:c})},a)}}function nu(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function su(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function ou(t){return t&&t.__esModule?t:{default:t}}function au(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function cu(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var uu=Object.freeze({__proto__:null,__extends:Kc,get __assign(){return Ci},__rest:Vc,__decorate:Gc,__param:kc,__metadata:Wc,__awaiter:Yc,__generator:Xc,__createBinding:Jc,__exportStar:Qc,__values:Li,__read:cs,__spread:Zc,__spreadArrays:eu,__await:vr,__asyncGenerator:tu,__asyncDelegator:ru,__asyncValues:iu,__makeTemplateObject:nu,__importStar:su,__importDefault:ou,__classPrivateFieldGet:au,__classPrivateFieldSet:cu}),Jr=Kt(uu),mr={},Q={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var Fi=function(t,e){return Fi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},Fi(t,e)};function lu(t,e){Fi(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Ui=function(){return Ui=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Ui.apply(this,arguments)};function hu(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function fu(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(s=(n<3?a(s):n>3?a(e,r,s):a(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function du(t,e){return function(r,i){e(r,i,t)}}function pu(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function gu(t,e,r,i){function n(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(d){try{l(i.next(d))}catch(w){a(w)}}function h(d){try{l(i.throw(d))}catch(w){a(w)}}function l(d){d.done?s(d.value):n(d.value).then(c,h)}l((i=i.apply(t,e||[])).next())})}function yu(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(l){return function(d){return h([l,d])}}function h(l){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=l[0]&2?n.return:l[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,l[1])).done)return s;switch(n=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,n=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(d){l=[6,d],n=0}finally{i=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function _u(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function bu(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function $i(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function us(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],a;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(c){a={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(a)throw a.error}}return s}function wu(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(us(arguments[e]));return t}function vu(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],a=0,c=s.length;a<c;a++,n++)i[n]=s[a];return i}function Er(t){return this instanceof Er?(this.v=t,this):new Er(t)}function mu(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(y){i[y]&&(n[y]=function(m){return new Promise(function(S,R){s.push([y,m,S,R])>1||c(y,m)})})}function c(y,m){try{h(i[y](m))}catch(S){w(s[0][3],S)}}function h(y){y.value instanceof Er?Promise.resolve(y.value.v).then(l,d):w(s[0][2],y)}function l(y){c("next",y)}function d(y){c("throw",y)}function w(y,m){y(m),s.shift(),s.length&&c(s[0][0],s[0][1])}}function Eu(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(a){return(r=!r)?{value:Er(t[n](a)),done:n==="return"}:s?s(a):a}:s}}function Su(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof $i=="function"?$i(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(a){return new Promise(function(c,h){a=t[s](a),n(c,h,a.done,a.value)})}}function n(s,a,c,h){Promise.resolve(h).then(function(l){s({value:l,done:c})},a)}}function Du(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function Ou(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function xu(t){return t&&t.__esModule?t:{default:t}}function Iu(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function Tu(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var Nu=Object.freeze({__proto__:null,__extends:lu,get __assign(){return Ui},__rest:hu,__decorate:fu,__param:du,__metadata:pu,__awaiter:gu,__generator:yu,__createBinding:_u,__exportStar:bu,__values:$i,__read:us,__spread:wu,__spreadArrays:vu,__await:Er,__asyncGenerator:mu,__asyncDelegator:Eu,__asyncValues:Su,__makeTemplateObject:Du,__importStar:Ou,__importDefault:xu,__classPrivateFieldGet:Iu,__classPrivateFieldSet:Tu}),Qr=Kt(Nu),Mi={},Sr={},ls;function Pu(){if(ls)return Sr;ls=1,Object.defineProperty(Sr,"__esModule",{value:!0}),Sr.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return Sr.delay=t,Sr}var Vt={},ji={},Gt={},hs;function Ru(){return hs||(hs=1,Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.ONE_THOUSAND=Gt.ONE_HUNDRED=void 0,Gt.ONE_HUNDRED=100,Gt.ONE_THOUSAND=1e3),Gt}var qi={},fs;function Au(){return fs||(fs=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(qi)),qi}var ds;function ps(){return ds||(ds=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Qr;e.__exportStar(Ru(),t),e.__exportStar(Au(),t)}(ji)),ji}var gs;function Cu(){if(gs)return Vt;gs=1,Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.fromMiliseconds=Vt.toMiliseconds=void 0;const t=ps();function e(i){return i*t.ONE_THOUSAND}Vt.toMiliseconds=e;function r(i){return Math.floor(i/t.ONE_THOUSAND)}return Vt.fromMiliseconds=r,Vt}var ys;function Lu(){return ys||(ys=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Qr;e.__exportStar(Pu(),t),e.__exportStar(Cu(),t)}(Mi)),Mi}var or={},_s;function Fu(){if(_s)return or;_s=1,Object.defineProperty(or,"__esModule",{value:!0}),or.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const i=this.get(r);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const n=Date.now()-i.started;this.timestamps.set(r,{started:i.started,elapsed:n})}get(r){const i=this.timestamps.get(r);if(typeof i>"u")throw new Error(`No timestamp found for label: ${r}`);return i}elapsed(r){const i=this.get(r);return i.elapsed||Date.now()-i.started}}return or.Watch=t,or.default=t,or}var Bi={},Dr={},bs;function Uu(){if(bs)return Dr;bs=1,Object.defineProperty(Dr,"__esModule",{value:!0}),Dr.IWatch=void 0;class t{}return Dr.IWatch=t,Dr}var ws;function $u(){return ws||(ws=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Qr.__exportStar(Uu(),t)}(Bi)),Bi}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Qr;e.__exportStar(Lu(),t),e.__exportStar(Fu(),t),e.__exportStar($u(),t),e.__exportStar(ps(),t)})(Q);var zi={},Or={};class kt{}var Mu=Object.freeze({__proto__:null,IEvents:kt}),ju=Kt(Mu),vs;function qu(){if(vs)return Or;vs=1,Object.defineProperty(Or,"__esModule",{value:!0}),Or.IHeartBeat=void 0;const t=ju;class e extends t.IEvents{constructor(i){super()}}return Or.IHeartBeat=e,Or}var ms;function Es(){return ms||(ms=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Jr.__exportStar(qu(),t)}(zi)),zi}var Hi={},Wt={},Ss;function Bu(){if(Ss)return Wt;Ss=1,Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.HEARTBEAT_EVENTS=Wt.HEARTBEAT_INTERVAL=void 0;const t=Q;return Wt.HEARTBEAT_INTERVAL=t.FIVE_SECONDS,Wt.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Wt}var Ds;function Os(){return Ds||(Ds=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Jr.__exportStar(Bu(),t)}(Hi)),Hi}var xs;function zu(){if(xs)return mr;xs=1,Object.defineProperty(mr,"__esModule",{value:!0}),mr.HeartBeat=void 0;const t=Jr,e=ht.exports,r=Q,i=Es(),n=Os();class s extends i.IHeartBeat{constructor(c){super(c),this.events=new e.EventEmitter,this.interval=n.HEARTBEAT_INTERVAL,this.interval=c?.interval||n.HEARTBEAT_INTERVAL}static init(c){return t.__awaiter(this,void 0,void 0,function*(){const h=new s(c);return yield h.init(),h})}init(){return t.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(c,h){this.events.on(c,h)}once(c,h){this.events.once(c,h)}off(c,h){this.events.off(c,h)}removeListener(c,h){this.events.removeListener(c,h)}initialize(){return t.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(n.HEARTBEAT_EVENTS.pulse)}}return mr.HeartBeat=s,mr}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Jr;e.__exportStar(zu(),t),e.__exportStar(Es(),t),e.__exportStar(Os(),t)})(sr);var _e={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var Ki=function(t,e){return Ki=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},Ki(t,e)};function Hu(t,e){Ki(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Vi=function(){return Vi=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Vi.apply(this,arguments)};function Ku(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function Vu(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(s=(n<3?a(s):n>3?a(e,r,s):a(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function Gu(t,e){return function(r,i){e(r,i,t)}}function ku(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Wu(t,e,r,i){function n(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(d){try{l(i.next(d))}catch(w){a(w)}}function h(d){try{l(i.throw(d))}catch(w){a(w)}}function l(d){d.done?s(d.value):n(d.value).then(c,h)}l((i=i.apply(t,e||[])).next())})}function Yu(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(l){return function(d){return h([l,d])}}function h(l){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=l[0]&2?n.return:l[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,l[1])).done)return s;switch(n=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,n=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(d){l=[6,d],n=0}finally{i=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Xu(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function Ju(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Gi(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Is(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],a;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(c){a={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(a)throw a.error}}return s}function Qu(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Is(arguments[e]));return t}function Zu(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],a=0,c=s.length;a<c;a++,n++)i[n]=s[a];return i}function xr(t){return this instanceof xr?(this.v=t,this):new xr(t)}function el(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(y){i[y]&&(n[y]=function(m){return new Promise(function(S,R){s.push([y,m,S,R])>1||c(y,m)})})}function c(y,m){try{h(i[y](m))}catch(S){w(s[0][3],S)}}function h(y){y.value instanceof xr?Promise.resolve(y.value.v).then(l,d):w(s[0][2],y)}function l(y){c("next",y)}function d(y){c("throw",y)}function w(y,m){y(m),s.shift(),s.length&&c(s[0][0],s[0][1])}}function tl(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(a){return(r=!r)?{value:xr(t[n](a)),done:n==="return"}:s?s(a):a}:s}}function rl(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Gi=="function"?Gi(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(a){return new Promise(function(c,h){a=t[s](a),n(c,h,a.done,a.value)})}}function n(s,a,c,h){Promise.resolve(h).then(function(l){s({value:l,done:c})},a)}}function il(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function nl(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function sl(t){return t&&t.__esModule?t:{default:t}}function ol(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function al(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var cl=Object.freeze({__proto__:null,__extends:Hu,get __assign(){return Vi},__rest:Ku,__decorate:Vu,__param:Gu,__metadata:ku,__awaiter:Wu,__generator:Yu,__createBinding:Xu,__exportStar:Ju,__values:Gi,__read:Is,__spread:Qu,__spreadArrays:Zu,__await:xr,__asyncGenerator:el,__asyncDelegator:tl,__asyncValues:rl,__makeTemplateObject:il,__importStar:nl,__importDefault:sl,__classPrivateFieldGet:ol,__classPrivateFieldSet:al}),ul=Kt(cl),ki,Ts;function ll(){if(Ts)return ki;Ts=1;function t(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}ki=e;function e(r,i,n){var s=n&&n.stringify||t,a=1;if(typeof r=="object"&&r!==null){var c=i.length+a;if(c===1)return r;var h=new Array(c);h[0]=s(r);for(var l=1;l<c;l++)h[l]=s(i[l]);return h.join(" ")}if(typeof r!="string")return r;var d=i.length;if(d===0)return r;for(var w="",y=1-a,m=-1,S=r&&r.length||0,R=0;R<S;){if(r.charCodeAt(R)===37&&R+1<S){switch(m=m>-1?m:0,r.charCodeAt(R+1)){case 100:case 102:if(y>=d||i[y]==null)break;m<R&&(w+=r.slice(m,R)),w+=Number(i[y]),m=R+2,R++;break;case 105:if(y>=d||i[y]==null)break;m<R&&(w+=r.slice(m,R)),w+=Math.floor(Number(i[y])),m=R+2,R++;break;case 79:case 111:case 106:if(y>=d||i[y]===void 0)break;m<R&&(w+=r.slice(m,R));var A=typeof i[y];if(A==="string"){w+="'"+i[y]+"'",m=R+2,R++;break}if(A==="function"){w+=i[y].name||"<anonymous>",m=R+2,R++;break}w+=s(i[y]),m=R+2,R++;break;case 115:if(y>=d)break;m<R&&(w+=r.slice(m,R)),w+=String(i[y]),m=R+2,R++;break;case 37:m<R&&(w+=r.slice(m,R)),w+="%",m=R+2,R++,y--;break}++y}++R}return m===-1?r:(m<S&&(w+=r.slice(m)),w)}return ki}var Wi,Ns;function hl(){if(Ns)return Wi;Ns=1;const t=ll();Wi=n;const e=v().console||{},r={mapHttpRequest:S,mapHttpResponse:S,wrapRequestSerializer:R,wrapResponseSerializer:R,wrapErrorSerializer:R,req:S,res:S,err:y};function i(p,o){return Array.isArray(p)?p.filter(function(C){return C!=="!stdSerializers.err"}):p===!0?Object.keys(o):!1}function n(p){p=p||{},p.browser=p.browser||{};const o=p.browser.transmit;if(o&&typeof o.send!="function")throw Error("pino: transmit option must have a send function");const f=p.browser.write||e;p.browser.write&&(p.browser.asObject=!0);const C=p.serializers||{},L=i(p.browser.serialize,C);let H=p.browser.serialize;Array.isArray(p.browser.serialize)&&p.browser.serialize.indexOf("!stdSerializers.err")>-1&&(H=!1);const G=["error","fatal","warn","info","debug","trace"];typeof f=="function"&&(f.error=f.fatal=f.warn=f.info=f.debug=f.trace=f),p.enabled===!1&&(p.level="silent");const J=p.level||"info",x=Object.create(f);x.log||(x.log=A),Object.defineProperty(x,"levelVal",{get:k}),Object.defineProperty(x,"level",{get:j,set:U});const P={transmit:o,serialize:L,asObject:p.browser.asObject,levels:G,timestamp:m(p)};x.levels=n.levels,x.level=J,x.setMaxListeners=x.getMaxListeners=x.emit=x.addListener=x.on=x.prependListener=x.once=x.prependOnceListener=x.removeListener=x.removeAllListeners=x.listeners=x.listenerCount=x.eventNames=x.write=x.flush=A,x.serializers=C,x._serialize=L,x._stdErrSerialize=H,x.child=M,o&&(x._logEvent=w());function k(){return this.level==="silent"?1/0:this.levels.values[this.level]}function j(){return this._level}function U(F){if(F!=="silent"&&!this.levels.values[F])throw Error("unknown level "+F);this._level=F,s(P,x,"error","log"),s(P,x,"fatal","error"),s(P,x,"warn","error"),s(P,x,"info","log"),s(P,x,"debug","log"),s(P,x,"trace","log")}function M(F,q){if(!F)throw new Error("missing bindings for child Pino");q=q||{},L&&F.serializers&&(q.serializers=F.serializers);const te=q.serializers;if(L&&te){var B=Object.assign({},C,te),Z=p.browser.serialize===!0?Object.keys(B):L;delete F.serializers,h([F],Z,B,this._stdErrSerialize)}function Y(ee){this._childLevel=(ee._childLevel|0)+1,this.error=l(ee,F,"error"),this.fatal=l(ee,F,"fatal"),this.warn=l(ee,F,"warn"),this.info=l(ee,F,"info"),this.debug=l(ee,F,"debug"),this.trace=l(ee,F,"trace"),B&&(this.serializers=B,this._serialize=Z),o&&(this._logEvent=w([].concat(ee._logEvent.bindings,F)))}return Y.prototype=this,new Y(this)}return x}n.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},n.stdSerializers=r,n.stdTimeFunctions=Object.assign({},{nullTime:z,epochTime:E,unixTime:I,isoTime:_});function s(p,o,f,C){const L=Object.getPrototypeOf(o);o[f]=o.levelVal>o.levels.values[f]?A:L[f]?L[f]:e[f]||e[C]||A,a(p,o,f)}function a(p,o,f){!p.transmit&&o[f]===A||(o[f]=function(C){return function(){const H=p.timestamp(),G=new Array(arguments.length),J=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var x=0;x<G.length;x++)G[x]=arguments[x];if(p.serialize&&!p.asObject&&h(G,this._serialize,this.serializers,this._stdErrSerialize),p.asObject?C.call(J,c(this,f,G,H)):C.apply(J,G),p.transmit){const P=p.transmit.level||o.level,k=n.levels.values[P],j=n.levels.values[f];if(j<k)return;d(this,{ts:H,methodLevel:f,methodValue:j,transmitLevel:P,transmitValue:n.levels.values[p.transmit.level||o.level],send:p.transmit.send,val:o.levelVal},G)}}}(o[f]))}function c(p,o,f,C){p._serialize&&h(f,p._serialize,p.serializers,p._stdErrSerialize);const L=f.slice();let H=L[0];const G={};C&&(G.time=C),G.level=n.levels.values[o];let J=(p._childLevel|0)+1;if(J<1&&(J=1),H!==null&&typeof H=="object"){for(;J--&&typeof L[0]=="object";)Object.assign(G,L.shift());H=L.length?t(L.shift(),L):void 0}else typeof H=="string"&&(H=t(L.shift(),L));return H!==void 0&&(G.msg=H),G}function h(p,o,f,C){for(const L in p)if(C&&p[L]instanceof Error)p[L]=n.stdSerializers.err(p[L]);else if(typeof p[L]=="object"&&!Array.isArray(p[L]))for(const H in p[L])o&&o.indexOf(H)>-1&&H in f&&(p[L][H]=f[H](p[L][H]))}function l(p,o,f){return function(){const C=new Array(1+arguments.length);C[0]=o;for(var L=1;L<C.length;L++)C[L]=arguments[L-1];return p[f].apply(this,C)}}function d(p,o,f){const C=o.send,L=o.ts,H=o.methodLevel,G=o.methodValue,J=o.val,x=p._logEvent.bindings;h(f,p._serialize||Object.keys(p.serializers),p.serializers,p._stdErrSerialize===void 0?!0:p._stdErrSerialize),p._logEvent.ts=L,p._logEvent.messages=f.filter(function(P){return x.indexOf(P)===-1}),p._logEvent.level.label=H,p._logEvent.level.value=G,C(H,p._logEvent,J),p._logEvent=w(x)}function w(p){return{ts:0,messages:[],bindings:p||[],level:{label:"",value:0}}}function y(p){const o={type:p.constructor.name,msg:p.message,stack:p.stack};for(const f in p)o[f]===void 0&&(o[f]=p[f]);return o}function m(p){return typeof p.timestamp=="function"?p.timestamp:p.timestamp===!1?z:E}function S(){return{}}function R(p){return p}function A(){}function z(){return!1}function E(){return Date.now()}function I(){return Math.round(Date.now()/1e3)}function _(){return new Date(Date.now()).toISOString()}function v(){function p(o){return typeof o<"u"&&o}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return p(self)||p(window)||p(this)||{}}}return Wi}var Yt={},Ps;function Rs(){return Ps||(Ps=1,Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.PINO_CUSTOM_CONTEXT_KEY=Yt.PINO_LOGGER_DEFAULTS=void 0,Yt.PINO_LOGGER_DEFAULTS={level:"info"},Yt.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Yt}var ot={},As;function fl(){if(As)return ot;As=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.generateChildLogger=ot.formatChildLoggerContext=ot.getLoggerContext=ot.setBrowserLoggerContext=ot.getBrowserLoggerContext=ot.getDefaultLoggerOptions=void 0;const t=Rs();function e(c){return Object.assign(Object.assign({},c),{level:c?.level||t.PINO_LOGGER_DEFAULTS.level})}ot.getDefaultLoggerOptions=e;function r(c,h=t.PINO_CUSTOM_CONTEXT_KEY){return c[h]||""}ot.getBrowserLoggerContext=r;function i(c,h,l=t.PINO_CUSTOM_CONTEXT_KEY){return c[l]=h,c}ot.setBrowserLoggerContext=i;function n(c,h=t.PINO_CUSTOM_CONTEXT_KEY){let l="";return typeof c.bindings>"u"?l=r(c,h):l=c.bindings().context||"",l}ot.getLoggerContext=n;function s(c,h,l=t.PINO_CUSTOM_CONTEXT_KEY){const d=n(c,l);return d.trim()?`${d}/${h}`:h}ot.formatChildLoggerContext=s;function a(c,h,l=t.PINO_CUSTOM_CONTEXT_KEY){const d=s(c,h,l),w=c.child({context:d});return i(w,d,l)}return ot.generateChildLogger=a,ot}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.pino=void 0;const e=ul,r=e.__importDefault(hl());Object.defineProperty(t,"pino",{enumerable:!0,get:function(){return r.default}}),e.__exportStar(Rs(),t),e.__exportStar(fl(),t)})(_e);class dl extends kt{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}class pl extends kt{constructor(e,r){super(),this.core=e,this.logger=r,this.records=new Map}}class gl{constructor(e,r){this.logger=e,this.core=r}}class yl extends kt{constructor(e,r){super(),this.relayer=e,this.logger=r}}class _l extends kt{constructor(e){super()}}class bl{constructor(e,r,i,n){this.core=e,this.logger=r,this.name=i}}class wl extends kt{constructor(e,r){super(),this.relayer=e,this.logger=r}}class vl extends kt{constructor(e,r){super(),this.core=e,this.logger=r}}class ml{constructor(e,r){this.projectId=e,this.logger=r}}class El{constructor(e){this.opts=e,this.protocol="wc",this.version=2}}class Sl{constructor(e){this.client=e}}const Dl=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),Ol=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(i,n)=>typeof n=="string"&&n.match(/^\d+n$/)?BigInt(n.substring(0,n.length-1)):n)};function Cs(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return Ol(t)}catch{return t}}function Yi(t){return typeof t=="string"?t:Dl(t)||""}var Xi={},ar={},Zr={},ei={};Object.defineProperty(ei,"__esModule",{value:!0}),ei.BrowserRandomSource=void 0;const Ls=65536;class xl{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const e=typeof self<"u"?self.crypto||self.msCrypto:null;e&&e.getRandomValues!==void 0&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const r=new Uint8Array(e);for(let i=0;i<r.length;i+=Ls)this._crypto.getRandomValues(r.subarray(i,i+Math.min(r.length-i,Ls)));return r}}ei.BrowserRandomSource=xl;function Il(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ti={},gt={};Object.defineProperty(gt,"__esModule",{value:!0});function Tl(t){for(var e=0;e<t.length;e++)t[e]=0;return t}gt.wipe=Tl;var Nl={},Pl=Object.freeze({__proto__:null,default:Nl}),Rl=Kt(Pl);Object.defineProperty(ti,"__esModule",{value:!0}),ti.NodeRandomSource=void 0;const Al=gt;class Cl{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof Il<"u"){const e=Rl;e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let r=this._crypto.randomBytes(e);if(r.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");const i=new Uint8Array(e);for(let n=0;n<i.length;n++)i[n]=r[n];return(0,Al.wipe)(r),i}}ti.NodeRandomSource=Cl,Object.defineProperty(Zr,"__esModule",{value:!0}),Zr.SystemRandomSource=void 0;const Ll=ei,Fl=ti;class Ul{constructor(){if(this.isAvailable=!1,this.name="",this._source=new Ll.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new Fl.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}}Zr.SystemRandomSource=Ul;var ie={},Fs={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});function e(c,h){var l=c>>>16&65535,d=c&65535,w=h>>>16&65535,y=h&65535;return d*y+(l*y+d*w<<16>>>0)|0}t.mul=Math.imul||e;function r(c,h){return c+h|0}t.add=r;function i(c,h){return c-h|0}t.sub=i;function n(c,h){return c<<h|c>>>32-h}t.rotl=n;function s(c,h){return c<<32-h|c>>>h}t.rotr=s;function a(c){return typeof c=="number"&&isFinite(c)&&Math.floor(c)===c}t.isInteger=Number.isInteger||a,t.MAX_SAFE_INTEGER=9007199254740991,t.isSafeInteger=function(c){return t.isInteger(c)&&c>=-t.MAX_SAFE_INTEGER&&c<=t.MAX_SAFE_INTEGER}})(Fs),Object.defineProperty(ie,"__esModule",{value:!0});var Us=Fs;function $l(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])<<16>>16}ie.readInt16BE=$l;function Ml(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])>>>0}ie.readUint16BE=Ml;function jl(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])<<16>>16}ie.readInt16LE=jl;function ql(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])>>>0}ie.readUint16LE=ql;function $s(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>8,e[r+1]=t>>>0,e}ie.writeUint16BE=$s,ie.writeInt16BE=$s;function Ms(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e}ie.writeUint16LE=Ms,ie.writeInt16LE=Ms;function Ji(t,e){return e===void 0&&(e=0),t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}ie.readInt32BE=Ji;function Qi(t,e){return e===void 0&&(e=0),(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}ie.readUint32BE=Qi;function Zi(t,e){return e===void 0&&(e=0),t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]}ie.readInt32LE=Zi;function en(t,e){return e===void 0&&(e=0),(t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e])>>>0}ie.readUint32LE=en;function ri(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>24,e[r+1]=t>>>16,e[r+2]=t>>>8,e[r+3]=t>>>0,e}ie.writeUint32BE=ri,ie.writeInt32BE=ri;function ii(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24,e}ie.writeUint32LE=ii,ie.writeInt32LE=ii;function Bl(t,e){e===void 0&&(e=0);var r=Ji(t,e),i=Ji(t,e+4);return r*4294967296+i-(i>>31)*4294967296}ie.readInt64BE=Bl;function zl(t,e){e===void 0&&(e=0);var r=Qi(t,e),i=Qi(t,e+4);return r*4294967296+i}ie.readUint64BE=zl;function Hl(t,e){e===void 0&&(e=0);var r=Zi(t,e),i=Zi(t,e+4);return i*4294967296+r-(r>>31)*4294967296}ie.readInt64LE=Hl;function Kl(t,e){e===void 0&&(e=0);var r=en(t,e),i=en(t,e+4);return i*4294967296+r}ie.readUint64LE=Kl;function js(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),ri(t/4294967296>>>0,e,r),ri(t>>>0,e,r+4),e}ie.writeUint64BE=js,ie.writeInt64BE=js;function qs(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),ii(t>>>0,e,r),ii(t/4294967296>>>0,e,r+4),e}ie.writeUint64LE=qs,ie.writeInt64LE=qs;function Vl(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintBE: array is too short for the given bitLength");for(var i=0,n=1,s=t/8+r-1;s>=r;s--)i+=e[s]*n,n*=256;return i}ie.readUintBE=Vl;function Gl(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintLE: array is too short for the given bitLength");for(var i=0,n=1,s=r;s<r+t/8;s++)i+=e[s]*n,n*=256;return i}ie.readUintLE=Gl;function kl(t,e,r,i){if(r===void 0&&(r=new Uint8Array(t/8)),i===void 0&&(i=0),t%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!Us.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var n=1,s=t/8+i-1;s>=i;s--)r[s]=e/n&255,n*=256;return r}ie.writeUintBE=kl;function Wl(t,e,r,i){if(r===void 0&&(r=new Uint8Array(t/8)),i===void 0&&(i=0),t%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!Us.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var n=1,s=i;s<i+t/8;s++)r[s]=e/n&255,n*=256;return r}ie.writeUintLE=Wl;function Yl(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e)}ie.readFloat32BE=Yl;function Xl(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e,!0)}ie.readFloat32LE=Xl;function Jl(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e)}ie.readFloat64BE=Jl;function Ql(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e,!0)}ie.readFloat64LE=Ql;function Zl(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(r,t),e}ie.writeFloat32BE=Zl;function eh(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(r,t,!0),e}ie.writeFloat32LE=eh;function th(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(r,t),e}ie.writeFloat64BE=th;function rh(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(r,t,!0),e}ie.writeFloat64LE=rh,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.randomStringForEntropy=t.randomString=t.randomUint32=t.randomBytes=t.defaultRandomSource=void 0;const e=Zr,r=ie,i=gt;t.defaultRandomSource=new e.SystemRandomSource;function n(l,d=t.defaultRandomSource){return d.randomBytes(l)}t.randomBytes=n;function s(l=t.defaultRandomSource){const d=n(4,l),w=(0,r.readUint32LE)(d);return(0,i.wipe)(d),w}t.randomUint32=s;const a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function c(l,d=a,w=t.defaultRandomSource){if(d.length<2)throw new Error("randomString charset is too short");if(d.length>256)throw new Error("randomString charset is too long");let y="";const m=d.length,S=256-256%m;for(;l>0;){const R=n(Math.ceil(l*256/S),w);for(let A=0;A<R.length&&l>0;A++){const z=R[A];z<S&&(y+=d.charAt(z%m),l--)}(0,i.wipe)(R)}return y}t.randomString=c;function h(l,d=a,w=t.defaultRandomSource){const y=Math.ceil(l/(Math.log(d.length)/Math.LN2));return c(y,d,w)}t.randomStringForEntropy=h}(ar);var Bs={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=ie,r=gt;t.DIGEST_LENGTH=64,t.BLOCK_SIZE=128;var i=function(){function c(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return c.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},c.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},c.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},c.prototype.update=function(h,l){if(l===void 0&&(l=h.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var d=0;if(this._bytesHashed+=l,this._bufferLength>0){for(;this._bufferLength<t.BLOCK_SIZE&&l>0;)this._buffer[this._bufferLength++]=h[d++],l--;this._bufferLength===this.blockSize&&(s(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(l>=this.blockSize&&(d=s(this._tempHi,this._tempLo,this._stateHi,this._stateLo,h,d,l),l%=this.blockSize);l>0;)this._buffer[this._bufferLength++]=h[d++],l--;return this},c.prototype.finish=function(h){if(!this._finished){var l=this._bytesHashed,d=this._bufferLength,w=l/536870912|0,y=l<<3,m=l%128<112?128:256;this._buffer[d]=128;for(var S=d+1;S<m-8;S++)this._buffer[S]=0;e.writeUint32BE(w,this._buffer,m-8),e.writeUint32BE(y,this._buffer,m-4),s(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,m),this._finished=!0}for(var S=0;S<this.digestLength/8;S++)e.writeUint32BE(this._stateHi[S],h,S*8),e.writeUint32BE(this._stateLo[S],h,S*8+4);return this},c.prototype.digest=function(){var h=new Uint8Array(this.digestLength);return this.finish(h),h},c.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},c.prototype.restoreState=function(h){return this._stateHi.set(h.stateHi),this._stateLo.set(h.stateLo),this._bufferLength=h.bufferLength,h.buffer&&this._buffer.set(h.buffer),this._bytesHashed=h.bytesHashed,this._finished=!1,this},c.prototype.cleanSavedState=function(h){r.wipe(h.stateHi),r.wipe(h.stateLo),h.buffer&&r.wipe(h.buffer),h.bufferLength=0,h.bytesHashed=0},c}();t.SHA512=i;var n=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function s(c,h,l,d,w,y,m){for(var S=l[0],R=l[1],A=l[2],z=l[3],E=l[4],I=l[5],_=l[6],v=l[7],p=d[0],o=d[1],f=d[2],C=d[3],L=d[4],H=d[5],G=d[6],J=d[7],x,P,k,j,U,M,F,q;m>=128;){for(var te=0;te<16;te++){var B=8*te+y;c[te]=e.readUint32BE(w,B),h[te]=e.readUint32BE(w,B+4)}for(var te=0;te<80;te++){var Z=S,Y=R,ee=A,N=z,T=E,D=I,u=_,b=v,K=p,W=o,he=f,be=C,de=L,me=H,Fe=G,Re=J;if(x=v,P=J,U=P&65535,M=P>>>16,F=x&65535,q=x>>>16,x=(E>>>14|L<<32-14)^(E>>>18|L<<32-18)^(L>>>41-32|E<<32-(41-32)),P=(L>>>14|E<<32-14)^(L>>>18|E<<32-18)^(E>>>41-32|L<<32-(41-32)),U+=P&65535,M+=P>>>16,F+=x&65535,q+=x>>>16,x=E&I^~E&_,P=L&H^~L&G,U+=P&65535,M+=P>>>16,F+=x&65535,q+=x>>>16,x=n[te*2],P=n[te*2+1],U+=P&65535,M+=P>>>16,F+=x&65535,q+=x>>>16,x=c[te%16],P=h[te%16],U+=P&65535,M+=P>>>16,F+=x&65535,q+=x>>>16,M+=U>>>16,F+=M>>>16,q+=F>>>16,k=F&65535|q<<16,j=U&65535|M<<16,x=k,P=j,U=P&65535,M=P>>>16,F=x&65535,q=x>>>16,x=(S>>>28|p<<32-28)^(p>>>34-32|S<<32-(34-32))^(p>>>39-32|S<<32-(39-32)),P=(p>>>28|S<<32-28)^(S>>>34-32|p<<32-(34-32))^(S>>>39-32|p<<32-(39-32)),U+=P&65535,M+=P>>>16,F+=x&65535,q+=x>>>16,x=S&R^S&A^R&A,P=p&o^p&f^o&f,U+=P&65535,M+=P>>>16,F+=x&65535,q+=x>>>16,M+=U>>>16,F+=M>>>16,q+=F>>>16,b=F&65535|q<<16,Re=U&65535|M<<16,x=N,P=be,U=P&65535,M=P>>>16,F=x&65535,q=x>>>16,x=k,P=j,U+=P&65535,M+=P>>>16,F+=x&65535,q+=x>>>16,M+=U>>>16,F+=M>>>16,q+=F>>>16,N=F&65535|q<<16,be=U&65535|M<<16,R=Z,A=Y,z=ee,E=N,I=T,_=D,v=u,S=b,o=K,f=W,C=he,L=be,H=de,G=me,J=Fe,p=Re,te%16===15)for(var B=0;B<16;B++)x=c[B],P=h[B],U=P&65535,M=P>>>16,F=x&65535,q=x>>>16,x=c[(B+9)%16],P=h[(B+9)%16],U+=P&65535,M+=P>>>16,F+=x&65535,q+=x>>>16,k=c[(B+1)%16],j=h[(B+1)%16],x=(k>>>1|j<<32-1)^(k>>>8|j<<32-8)^k>>>7,P=(j>>>1|k<<32-1)^(j>>>8|k<<32-8)^(j>>>7|k<<32-7),U+=P&65535,M+=P>>>16,F+=x&65535,q+=x>>>16,k=c[(B+14)%16],j=h[(B+14)%16],x=(k>>>19|j<<32-19)^(j>>>61-32|k<<32-(61-32))^k>>>6,P=(j>>>19|k<<32-19)^(k>>>61-32|j<<32-(61-32))^(j>>>6|k<<32-6),U+=P&65535,M+=P>>>16,F+=x&65535,q+=x>>>16,M+=U>>>16,F+=M>>>16,q+=F>>>16,c[B]=F&65535|q<<16,h[B]=U&65535|M<<16}x=S,P=p,U=P&65535,M=P>>>16,F=x&65535,q=x>>>16,x=l[0],P=d[0],U+=P&65535,M+=P>>>16,F+=x&65535,q+=x>>>16,M+=U>>>16,F+=M>>>16,q+=F>>>16,l[0]=S=F&65535|q<<16,d[0]=p=U&65535|M<<16,x=R,P=o,U=P&65535,M=P>>>16,F=x&65535,q=x>>>16,x=l[1],P=d[1],U+=P&65535,M+=P>>>16,F+=x&65535,q+=x>>>16,M+=U>>>16,F+=M>>>16,q+=F>>>16,l[1]=R=F&65535|q<<16,d[1]=o=U&65535|M<<16,x=A,P=f,U=P&65535,M=P>>>16,F=x&65535,q=x>>>16,x=l[2],P=d[2],U+=P&65535,M+=P>>>16,F+=x&65535,q+=x>>>16,M+=U>>>16,F+=M>>>16,q+=F>>>16,l[2]=A=F&65535|q<<16,d[2]=f=U&65535|M<<16,x=z,P=C,U=P&65535,M=P>>>16,F=x&65535,q=x>>>16,x=l[3],P=d[3],U+=P&65535,M+=P>>>16,F+=x&65535,q+=x>>>16,M+=U>>>16,F+=M>>>16,q+=F>>>16,l[3]=z=F&65535|q<<16,d[3]=C=U&65535|M<<16,x=E,P=L,U=P&65535,M=P>>>16,F=x&65535,q=x>>>16,x=l[4],P=d[4],U+=P&65535,M+=P>>>16,F+=x&65535,q+=x>>>16,M+=U>>>16,F+=M>>>16,q+=F>>>16,l[4]=E=F&65535|q<<16,d[4]=L=U&65535|M<<16,x=I,P=H,U=P&65535,M=P>>>16,F=x&65535,q=x>>>16,x=l[5],P=d[5],U+=P&65535,M+=P>>>16,F+=x&65535,q+=x>>>16,M+=U>>>16,F+=M>>>16,q+=F>>>16,l[5]=I=F&65535|q<<16,d[5]=H=U&65535|M<<16,x=_,P=G,U=P&65535,M=P>>>16,F=x&65535,q=x>>>16,x=l[6],P=d[6],U+=P&65535,M+=P>>>16,F+=x&65535,q+=x>>>16,M+=U>>>16,F+=M>>>16,q+=F>>>16,l[6]=_=F&65535|q<<16,d[6]=G=U&65535|M<<16,x=v,P=J,U=P&65535,M=P>>>16,F=x&65535,q=x>>>16,x=l[7],P=d[7],U+=P&65535,M+=P>>>16,F+=x&65535,q+=x>>>16,M+=U>>>16,F+=M>>>16,q+=F>>>16,l[7]=v=F&65535|q<<16,d[7]=J=U&65535|M<<16,y+=128,m-=128}return y}function a(c){var h=new i;h.update(c);var l=h.digest();return h.clean(),l}t.hash=a})(Bs),function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.convertSecretKeyToX25519=t.convertPublicKeyToX25519=t.verify=t.sign=t.extractPublicKeyFromSecretKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.SEED_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=t.SIGNATURE_LENGTH=void 0;const e=ar,r=Bs,i=gt;t.SIGNATURE_LENGTH=64,t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=64,t.SEED_LENGTH=32;function n(N){const T=new Float64Array(16);if(N)for(let D=0;D<N.length;D++)T[D]=N[D];return T}const s=new Uint8Array(32);s[0]=9;const a=n(),c=n([1]),h=n([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),l=n([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),d=n([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),w=n([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),y=n([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function m(N,T){for(let D=0;D<16;D++)N[D]=T[D]|0}function S(N){let T=1;for(let D=0;D<16;D++){let u=N[D]+T+65535;T=Math.floor(u/65536),N[D]=u-T*65536}N[0]+=T-1+37*(T-1)}function R(N,T,D){const u=~(D-1);for(let b=0;b<16;b++){const K=u&(N[b]^T[b]);N[b]^=K,T[b]^=K}}function A(N,T){const D=n(),u=n();for(let b=0;b<16;b++)u[b]=T[b];S(u),S(u),S(u);for(let b=0;b<2;b++){D[0]=u[0]-65517;for(let W=1;W<15;W++)D[W]=u[W]-65535-(D[W-1]>>16&1),D[W-1]&=65535;D[15]=u[15]-32767-(D[14]>>16&1);const K=D[15]>>16&1;D[14]&=65535,R(u,D,1-K)}for(let b=0;b<16;b++)N[2*b]=u[b]&255,N[2*b+1]=u[b]>>8}function z(N,T){let D=0;for(let u=0;u<32;u++)D|=N[u]^T[u];return(1&D-1>>>8)-1}function E(N,T){const D=new Uint8Array(32),u=new Uint8Array(32);return A(D,N),A(u,T),z(D,u)}function I(N){const T=new Uint8Array(32);return A(T,N),T[0]&1}function _(N,T){for(let D=0;D<16;D++)N[D]=T[2*D]+(T[2*D+1]<<8);N[15]&=32767}function v(N,T,D){for(let u=0;u<16;u++)N[u]=T[u]+D[u]}function p(N,T,D){for(let u=0;u<16;u++)N[u]=T[u]-D[u]}function o(N,T,D){let u,b,K=0,W=0,he=0,be=0,de=0,me=0,Fe=0,Re=0,ye=0,pe=0,fe=0,ue=0,ce=0,ae=0,oe=0,re=0,le=0,ge=0,ne=0,we=0,ve=0,Se=0,De=0,Ee=0,Ot=0,Pt=0,qt=0,_t=0,Zt=0,Vr=0,mi=0,$e=D[0],Ae=D[1],Me=D[2],je=D[3],qe=D[4],Ce=D[5],Ve=D[6],Ge=D[7],ke=D[8],We=D[9],Ye=D[10],ze=D[11],Be=D[12],Ne=D[13],Xe=D[14],Je=D[15];u=T[0],K+=u*$e,W+=u*Ae,he+=u*Me,be+=u*je,de+=u*qe,me+=u*Ce,Fe+=u*Ve,Re+=u*Ge,ye+=u*ke,pe+=u*We,fe+=u*Ye,ue+=u*ze,ce+=u*Be,ae+=u*Ne,oe+=u*Xe,re+=u*Je,u=T[1],W+=u*$e,he+=u*Ae,be+=u*Me,de+=u*je,me+=u*qe,Fe+=u*Ce,Re+=u*Ve,ye+=u*Ge,pe+=u*ke,fe+=u*We,ue+=u*Ye,ce+=u*ze,ae+=u*Be,oe+=u*Ne,re+=u*Xe,le+=u*Je,u=T[2],he+=u*$e,be+=u*Ae,de+=u*Me,me+=u*je,Fe+=u*qe,Re+=u*Ce,ye+=u*Ve,pe+=u*Ge,fe+=u*ke,ue+=u*We,ce+=u*Ye,ae+=u*ze,oe+=u*Be,re+=u*Ne,le+=u*Xe,ge+=u*Je,u=T[3],be+=u*$e,de+=u*Ae,me+=u*Me,Fe+=u*je,Re+=u*qe,ye+=u*Ce,pe+=u*Ve,fe+=u*Ge,ue+=u*ke,ce+=u*We,ae+=u*Ye,oe+=u*ze,re+=u*Be,le+=u*Ne,ge+=u*Xe,ne+=u*Je,u=T[4],de+=u*$e,me+=u*Ae,Fe+=u*Me,Re+=u*je,ye+=u*qe,pe+=u*Ce,fe+=u*Ve,ue+=u*Ge,ce+=u*ke,ae+=u*We,oe+=u*Ye,re+=u*ze,le+=u*Be,ge+=u*Ne,ne+=u*Xe,we+=u*Je,u=T[5],me+=u*$e,Fe+=u*Ae,Re+=u*Me,ye+=u*je,pe+=u*qe,fe+=u*Ce,ue+=u*Ve,ce+=u*Ge,ae+=u*ke,oe+=u*We,re+=u*Ye,le+=u*ze,ge+=u*Be,ne+=u*Ne,we+=u*Xe,ve+=u*Je,u=T[6],Fe+=u*$e,Re+=u*Ae,ye+=u*Me,pe+=u*je,fe+=u*qe,ue+=u*Ce,ce+=u*Ve,ae+=u*Ge,oe+=u*ke,re+=u*We,le+=u*Ye,ge+=u*ze,ne+=u*Be,we+=u*Ne,ve+=u*Xe,Se+=u*Je,u=T[7],Re+=u*$e,ye+=u*Ae,pe+=u*Me,fe+=u*je,ue+=u*qe,ce+=u*Ce,ae+=u*Ve,oe+=u*Ge,re+=u*ke,le+=u*We,ge+=u*Ye,ne+=u*ze,we+=u*Be,ve+=u*Ne,Se+=u*Xe,De+=u*Je,u=T[8],ye+=u*$e,pe+=u*Ae,fe+=u*Me,ue+=u*je,ce+=u*qe,ae+=u*Ce,oe+=u*Ve,re+=u*Ge,le+=u*ke,ge+=u*We,ne+=u*Ye,we+=u*ze,ve+=u*Be,Se+=u*Ne,De+=u*Xe,Ee+=u*Je,u=T[9],pe+=u*$e,fe+=u*Ae,ue+=u*Me,ce+=u*je,ae+=u*qe,oe+=u*Ce,re+=u*Ve,le+=u*Ge,ge+=u*ke,ne+=u*We,we+=u*Ye,ve+=u*ze,Se+=u*Be,De+=u*Ne,Ee+=u*Xe,Ot+=u*Je,u=T[10],fe+=u*$e,ue+=u*Ae,ce+=u*Me,ae+=u*je,oe+=u*qe,re+=u*Ce,le+=u*Ve,ge+=u*Ge,ne+=u*ke,we+=u*We,ve+=u*Ye,Se+=u*ze,De+=u*Be,Ee+=u*Ne,Ot+=u*Xe,Pt+=u*Je,u=T[11],ue+=u*$e,ce+=u*Ae,ae+=u*Me,oe+=u*je,re+=u*qe,le+=u*Ce,ge+=u*Ve,ne+=u*Ge,we+=u*ke,ve+=u*We,Se+=u*Ye,De+=u*ze,Ee+=u*Be,Ot+=u*Ne,Pt+=u*Xe,qt+=u*Je,u=T[12],ce+=u*$e,ae+=u*Ae,oe+=u*Me,re+=u*je,le+=u*qe,ge+=u*Ce,ne+=u*Ve,we+=u*Ge,ve+=u*ke,Se+=u*We,De+=u*Ye,Ee+=u*ze,Ot+=u*Be,Pt+=u*Ne,qt+=u*Xe,_t+=u*Je,u=T[13],ae+=u*$e,oe+=u*Ae,re+=u*Me,le+=u*je,ge+=u*qe,ne+=u*Ce,we+=u*Ve,ve+=u*Ge,Se+=u*ke,De+=u*We,Ee+=u*Ye,Ot+=u*ze,Pt+=u*Be,qt+=u*Ne,_t+=u*Xe,Zt+=u*Je,u=T[14],oe+=u*$e,re+=u*Ae,le+=u*Me,ge+=u*je,ne+=u*qe,we+=u*Ce,ve+=u*Ve,Se+=u*Ge,De+=u*ke,Ee+=u*We,Ot+=u*Ye,Pt+=u*ze,qt+=u*Be,_t+=u*Ne,Zt+=u*Xe,Vr+=u*Je,u=T[15],re+=u*$e,le+=u*Ae,ge+=u*Me,ne+=u*je,we+=u*qe,ve+=u*Ce,Se+=u*Ve,De+=u*Ge,Ee+=u*ke,Ot+=u*We,Pt+=u*Ye,qt+=u*ze,_t+=u*Be,Zt+=u*Ne,Vr+=u*Xe,mi+=u*Je,K+=38*le,W+=38*ge,he+=38*ne,be+=38*we,de+=38*ve,me+=38*Se,Fe+=38*De,Re+=38*Ee,ye+=38*Ot,pe+=38*Pt,fe+=38*qt,ue+=38*_t,ce+=38*Zt,ae+=38*Vr,oe+=38*mi,b=1,u=K+b+65535,b=Math.floor(u/65536),K=u-b*65536,u=W+b+65535,b=Math.floor(u/65536),W=u-b*65536,u=he+b+65535,b=Math.floor(u/65536),he=u-b*65536,u=be+b+65535,b=Math.floor(u/65536),be=u-b*65536,u=de+b+65535,b=Math.floor(u/65536),de=u-b*65536,u=me+b+65535,b=Math.floor(u/65536),me=u-b*65536,u=Fe+b+65535,b=Math.floor(u/65536),Fe=u-b*65536,u=Re+b+65535,b=Math.floor(u/65536),Re=u-b*65536,u=ye+b+65535,b=Math.floor(u/65536),ye=u-b*65536,u=pe+b+65535,b=Math.floor(u/65536),pe=u-b*65536,u=fe+b+65535,b=Math.floor(u/65536),fe=u-b*65536,u=ue+b+65535,b=Math.floor(u/65536),ue=u-b*65536,u=ce+b+65535,b=Math.floor(u/65536),ce=u-b*65536,u=ae+b+65535,b=Math.floor(u/65536),ae=u-b*65536,u=oe+b+65535,b=Math.floor(u/65536),oe=u-b*65536,u=re+b+65535,b=Math.floor(u/65536),re=u-b*65536,K+=b-1+37*(b-1),b=1,u=K+b+65535,b=Math.floor(u/65536),K=u-b*65536,u=W+b+65535,b=Math.floor(u/65536),W=u-b*65536,u=he+b+65535,b=Math.floor(u/65536),he=u-b*65536,u=be+b+65535,b=Math.floor(u/65536),be=u-b*65536,u=de+b+65535,b=Math.floor(u/65536),de=u-b*65536,u=me+b+65535,b=Math.floor(u/65536),me=u-b*65536,u=Fe+b+65535,b=Math.floor(u/65536),Fe=u-b*65536,u=Re+b+65535,b=Math.floor(u/65536),Re=u-b*65536,u=ye+b+65535,b=Math.floor(u/65536),ye=u-b*65536,u=pe+b+65535,b=Math.floor(u/65536),pe=u-b*65536,u=fe+b+65535,b=Math.floor(u/65536),fe=u-b*65536,u=ue+b+65535,b=Math.floor(u/65536),ue=u-b*65536,u=ce+b+65535,b=Math.floor(u/65536),ce=u-b*65536,u=ae+b+65535,b=Math.floor(u/65536),ae=u-b*65536,u=oe+b+65535,b=Math.floor(u/65536),oe=u-b*65536,u=re+b+65535,b=Math.floor(u/65536),re=u-b*65536,K+=b-1+37*(b-1),N[0]=K,N[1]=W,N[2]=he,N[3]=be,N[4]=de,N[5]=me,N[6]=Fe,N[7]=Re,N[8]=ye,N[9]=pe,N[10]=fe,N[11]=ue,N[12]=ce,N[13]=ae,N[14]=oe,N[15]=re}function f(N,T){o(N,T,T)}function C(N,T){const D=n();let u;for(u=0;u<16;u++)D[u]=T[u];for(u=253;u>=0;u--)f(D,D),u!==2&&u!==4&&o(D,D,T);for(u=0;u<16;u++)N[u]=D[u]}function L(N,T){const D=n();let u;for(u=0;u<16;u++)D[u]=T[u];for(u=250;u>=0;u--)f(D,D),u!==1&&o(D,D,T);for(u=0;u<16;u++)N[u]=D[u]}function H(N,T){const D=n(),u=n(),b=n(),K=n(),W=n(),he=n(),be=n(),de=n(),me=n();p(D,N[1],N[0]),p(me,T[1],T[0]),o(D,D,me),v(u,N[0],N[1]),v(me,T[0],T[1]),o(u,u,me),o(b,N[3],T[3]),o(b,b,l),o(K,N[2],T[2]),v(K,K,K),p(W,u,D),p(he,K,b),v(be,K,b),v(de,u,D),o(N[0],W,he),o(N[1],de,be),o(N[2],be,he),o(N[3],W,de)}function G(N,T,D){for(let u=0;u<4;u++)R(N[u],T[u],D)}function J(N,T){const D=n(),u=n(),b=n();C(b,T[2]),o(D,T[0],b),o(u,T[1],b),A(N,u),N[31]^=I(D)<<7}function x(N,T,D){m(N[0],a),m(N[1],c),m(N[2],c),m(N[3],a);for(let u=255;u>=0;--u){const b=D[u/8|0]>>(u&7)&1;G(N,T,b),H(T,N),H(N,N),G(N,T,b)}}function P(N,T){const D=[n(),n(),n(),n()];m(D[0],d),m(D[1],w),m(D[2],c),o(D[3],d,w),x(N,D,T)}function k(N){if(N.length!==t.SEED_LENGTH)throw new Error(`ed25519: seed must be ${t.SEED_LENGTH} bytes`);const T=(0,r.hash)(N);T[0]&=248,T[31]&=127,T[31]|=64;const D=new Uint8Array(32),u=[n(),n(),n(),n()];P(u,T),J(D,u);const b=new Uint8Array(64);return b.set(N),b.set(D,32),{publicKey:D,secretKey:b}}t.generateKeyPairFromSeed=k;function j(N){const T=(0,e.randomBytes)(32,N),D=k(T);return(0,i.wipe)(T),D}t.generateKeyPair=j;function U(N){if(N.length!==t.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${t.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(N.subarray(32))}t.extractPublicKeyFromSecretKey=U;const M=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function F(N,T){let D,u,b,K;for(u=63;u>=32;--u){for(D=0,b=u-32,K=u-12;b<K;++b)T[b]+=D-16*T[u]*M[b-(u-32)],D=Math.floor((T[b]+128)/256),T[b]-=D*256;T[b]+=D,T[u]=0}for(D=0,b=0;b<32;b++)T[b]+=D-(T[31]>>4)*M[b],D=T[b]>>8,T[b]&=255;for(b=0;b<32;b++)T[b]-=D*M[b];for(u=0;u<32;u++)T[u+1]+=T[u]>>8,N[u]=T[u]&255}function q(N){const T=new Float64Array(64);for(let D=0;D<64;D++)T[D]=N[D];for(let D=0;D<64;D++)N[D]=0;F(N,T)}function te(N,T){const D=new Float64Array(64),u=[n(),n(),n(),n()],b=(0,r.hash)(N.subarray(0,32));b[0]&=248,b[31]&=127,b[31]|=64;const K=new Uint8Array(64);K.set(b.subarray(32),32);const W=new r.SHA512;W.update(K.subarray(32)),W.update(T);const he=W.digest();W.clean(),q(he),P(u,he),J(K,u),W.reset(),W.update(K.subarray(0,32)),W.update(N.subarray(32)),W.update(T);const be=W.digest();q(be);for(let de=0;de<32;de++)D[de]=he[de];for(let de=0;de<32;de++)for(let me=0;me<32;me++)D[de+me]+=be[de]*b[me];return F(K.subarray(32),D),K}t.sign=te;function B(N,T){const D=n(),u=n(),b=n(),K=n(),W=n(),he=n(),be=n();return m(N[2],c),_(N[1],T),f(b,N[1]),o(K,b,h),p(b,b,N[2]),v(K,N[2],K),f(W,K),f(he,W),o(be,he,W),o(D,be,b),o(D,D,K),L(D,D),o(D,D,b),o(D,D,K),o(D,D,K),o(N[0],D,K),f(u,N[0]),o(u,u,K),E(u,b)&&o(N[0],N[0],y),f(u,N[0]),o(u,u,K),E(u,b)?-1:(I(N[0])===T[31]>>7&&p(N[0],a,N[0]),o(N[3],N[0],N[1]),0)}function Z(N,T,D){const u=new Uint8Array(32),b=[n(),n(),n(),n()],K=[n(),n(),n(),n()];if(D.length!==t.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${t.SIGNATURE_LENGTH} bytes`);if(B(K,N))return!1;const W=new r.SHA512;W.update(D.subarray(0,32)),W.update(N),W.update(T);const he=W.digest();return q(he),x(b,K,he),P(K,D.subarray(32)),H(b,K),J(u,b),!z(D,u)}t.verify=Z;function Y(N){let T=[n(),n(),n(),n()];if(B(T,N))throw new Error("Ed25519: invalid public key");let D=n(),u=n(),b=T[1];v(D,c,b),p(u,c,b),C(u,u),o(D,D,u);let K=new Uint8Array(32);return A(K,D),K}t.convertPublicKeyToX25519=Y;function ee(N){const T=(0,r.hash)(N.subarray(0,32));T[0]&=248,T[31]&=127,T[31]|=64;const D=new Uint8Array(T.subarray(0,32));return(0,i.wipe)(T),D}t.convertSecretKeyToX25519=ee}(Xi);const ih="EdDSA",nh="JWT",zs=".",Hs="base64url",sh="utf8",oh="utf8",ah=":",ch="did",uh="key",Ks="base58btc",lh="z",hh="K36",fh=32;function tn(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Vs(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?tn(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function rn(t,e){e||(e=t.reduce((n,s)=>n+s.length,0));const r=Vs(e);let i=0;for(const n of t)r.set(n,i),i+=n.length;return tn(r)}function dh(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var s=t.charAt(n),a=s.charCodeAt(0);if(r[a]!==255)throw new TypeError(s+" is ambiguous");r[a]=n}var c=t.length,h=t.charAt(0),l=Math.log(c)/Math.log(256),d=Math.log(256)/Math.log(c);function w(S){if(S instanceof Uint8Array||(ArrayBuffer.isView(S)?S=new Uint8Array(S.buffer,S.byteOffset,S.byteLength):Array.isArray(S)&&(S=Uint8Array.from(S))),!(S instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(S.length===0)return"";for(var R=0,A=0,z=0,E=S.length;z!==E&&S[z]===0;)z++,R++;for(var I=(E-z)*d+1>>>0,_=new Uint8Array(I);z!==E;){for(var v=S[z],p=0,o=I-1;(v!==0||p<A)&&o!==-1;o--,p++)v+=256*_[o]>>>0,_[o]=v%c>>>0,v=v/c>>>0;if(v!==0)throw new Error("Non-zero carry");A=p,z++}for(var f=I-A;f!==I&&_[f]===0;)f++;for(var C=h.repeat(R);f<I;++f)C+=t.charAt(_[f]);return C}function y(S){if(typeof S!="string")throw new TypeError("Expected String");if(S.length===0)return new Uint8Array;var R=0;if(S[R]!==" "){for(var A=0,z=0;S[R]===h;)A++,R++;for(var E=(S.length-R)*l+1>>>0,I=new Uint8Array(E);S[R];){var _=r[S.charCodeAt(R)];if(_===255)return;for(var v=0,p=E-1;(_!==0||v<z)&&p!==-1;p--,v++)_+=c*I[p]>>>0,I[p]=_%256>>>0,_=_/256>>>0;if(_!==0)throw new Error("Non-zero carry");z=v,R++}if(S[R]!==" "){for(var o=E-z;o!==E&&I[o]===0;)o++;for(var f=new Uint8Array(A+(E-o)),C=A;o!==E;)f[C++]=I[o++];return f}}}function m(S){var R=y(S);if(R)return R;throw new Error(`Non-${e} character`)}return{encode:w,decodeUnsafe:y,decode:m}}var ph=dh,gh=ph;const Gs=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},yh=t=>new TextEncoder().encode(t),_h=t=>new TextDecoder().decode(t);class bh{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class wh{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ks(this,e)}}class vh{constructor(e){this.decoders=e}or(e){return ks(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ks=(t,e)=>new vh({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class mh{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new bh(e,r,i),this.decoder=new wh(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ni=({name:t,prefix:e,encode:r,decode:i})=>new mh(t,e,r,i),Ir=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=gh(r,e);return ni({prefix:t,name:e,encode:i,decode:s=>Gs(n(s))})},Eh=(t,e,r,i)=>{const n={};for(let d=0;d<e.length;++d)n[e[d]]=d;let s=t.length;for(;t[s-1]==="=";)--s;const a=new Uint8Array(s*r/8|0);let c=0,h=0,l=0;for(let d=0;d<s;++d){const w=n[t[d]];if(w===void 0)throw new SyntaxError(`Non-${i} character`);h=h<<r|w,c+=r,c>=8&&(c-=8,a[l++]=255&h>>c)}if(c>=r||255&h<<8-c)throw new SyntaxError("Unexpected end of data");return a},Sh=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let s="",a=0,c=0;for(let h=0;h<t.length;++h)for(c=c<<8|t[h],a+=8;a>r;)a-=r,s+=e[n&c>>a];if(a&&(s+=e[n&c<<r-a]),i)for(;s.length*r&7;)s+="=";return s},et=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>ni({prefix:e,name:t,encode(n){return Sh(n,i,r)},decode(n){return Eh(n,i,r,t)}}),Dh=ni({prefix:"\0",name:"identity",encode:t=>_h(t),decode:t=>yh(t)});var Oh=Object.freeze({__proto__:null,identity:Dh});const xh=et({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Ih=Object.freeze({__proto__:null,base2:xh});const Th=et({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Nh=Object.freeze({__proto__:null,base8:Th});const Ph=Ir({prefix:"9",name:"base10",alphabet:"0123456789"});var Rh=Object.freeze({__proto__:null,base10:Ph});const Ah=et({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Ch=et({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Lh=Object.freeze({__proto__:null,base16:Ah,base16upper:Ch});const Fh=et({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Uh=et({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),$h=et({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Mh=et({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),jh=et({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),qh=et({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Bh=et({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),zh=et({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Hh=et({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Kh=Object.freeze({__proto__:null,base32:Fh,base32upper:Uh,base32pad:$h,base32padupper:Mh,base32hex:jh,base32hexupper:qh,base32hexpad:Bh,base32hexpadupper:zh,base32z:Hh});const Vh=Ir({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Gh=Ir({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var kh=Object.freeze({__proto__:null,base36:Vh,base36upper:Gh});const Wh=Ir({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Yh=Ir({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Xh=Object.freeze({__proto__:null,base58btc:Wh,base58flickr:Yh});const Jh=et({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Qh=et({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Zh=et({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),ef=et({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var tf=Object.freeze({__proto__:null,base64:Jh,base64pad:Qh,base64url:Zh,base64urlpad:ef});const Ws=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),rf=Ws.reduce((t,e,r)=>(t[r]=e,t),[]),nf=Ws.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function sf(t){return t.reduce((e,r)=>(e+=rf[r],e),"")}function of(t){const e=[];for(const r of t){const i=nf[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const af=ni({prefix:"\u{1F680}",name:"base256emoji",encode:sf,decode:of});var cf=Object.freeze({__proto__:null,base256emoji:af}),uf=Xs,Ys=128,lf=127,hf=~lf,ff=Math.pow(2,31);function Xs(t,e,r){e=e||[],r=r||0;for(var i=r;t>=ff;)e[r++]=t&255|Ys,t/=128;for(;t&hf;)e[r++]=t&255|Ys,t>>>=7;return e[r]=t|0,Xs.bytes=r-i+1,e}var df=nn,pf=128,Js=127;function nn(t,i){var r=0,i=i||0,n=0,s=i,a,c=t.length;do{if(s>=c)throw nn.bytes=0,new RangeError("Could not decode varint");a=t[s++],r+=n<28?(a&Js)<<n:(a&Js)*Math.pow(2,n),n+=7}while(a>=pf);return nn.bytes=s-i,r}var gf=Math.pow(2,7),yf=Math.pow(2,14),_f=Math.pow(2,21),bf=Math.pow(2,28),wf=Math.pow(2,35),vf=Math.pow(2,42),mf=Math.pow(2,49),Ef=Math.pow(2,56),Sf=Math.pow(2,63),Df=function(t){return t<gf?1:t<yf?2:t<_f?3:t<bf?4:t<wf?5:t<vf?6:t<mf?7:t<Ef?8:t<Sf?9:10},Of={encode:uf,decode:df,encodingLength:Df},Qs=Of;const Zs=(t,e,r=0)=>(Qs.encode(t,e,r),e),eo=t=>Qs.encodingLength(t),sn=(t,e)=>{const r=e.byteLength,i=eo(t),n=i+eo(r),s=new Uint8Array(n+r);return Zs(t,s,0),Zs(r,s,i),s.set(e,n),new xf(t,r,e,s)};class xf{constructor(e,r,i,n){this.code=e,this.size=r,this.digest=i,this.bytes=n}}const to=({name:t,code:e,encode:r})=>new If(t,e,r);class If{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?sn(this.code,r):r.then(i=>sn(this.code,i))}else throw Error("Unknown type, must be binary type")}}const ro=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Tf=to({name:"sha2-256",code:18,encode:ro("SHA-256")}),Nf=to({name:"sha2-512",code:19,encode:ro("SHA-512")});var Pf=Object.freeze({__proto__:null,sha256:Tf,sha512:Nf});const io=0,Rf="identity",no=Gs;var Af=Object.freeze({__proto__:null,identity:{code:io,name:Rf,encode:no,digest:t=>sn(io,no(t))}});new TextEncoder,new TextDecoder;const so={...Oh,...Ih,...Nh,...Rh,...Lh,...Kh,...kh,...Xh,...tf,...cf};({...Pf,...Af});function oo(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const ao=oo("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),on=oo("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Vs(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),co={utf8:ao,"utf-8":ao,hex:so.base16,latin1:on,ascii:on,binary:on,...so};function at(t,e="utf8"){const r=co[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function ft(t,e="utf8"){const r=co[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?tn(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function si(t){return at(ft(Yi(t),sh),Hs)}function uo(t){const e=ft(hh,Ks),r=lh+at(rn([e,t]),Ks);return[ch,uh,r].join(ah)}function Cf(t){return at(t,Hs)}function Lf(t){return ft([si(t.header),si(t.payload)].join(zs),oh)}function Ff(t){return[si(t.header),si(t.payload),Cf(t.signature)].join(zs)}function lo(t=ar.randomBytes(fh)){return Xi.generateKeyPairFromSeed(t)}async function Uf(t,e,r,i,n=Q.fromMiliseconds(Date.now())){const s={alg:ih,typ:nh},a=uo(i.publicKey),c=n+r,h={iss:a,sub:t,aud:e,iat:n,exp:c},l=Lf({header:s,payload:h}),d=Xi.sign(i.secretKey,l);return Ff({header:s,payload:h,signature:d})}var an={},oi={};Object.defineProperty(oi,"__esModule",{value:!0});var it=ie,cn=gt,$f=20;function Mf(t,e,r){for(var i=1634760805,n=857760878,s=2036477234,a=1797285236,c=r[3]<<24|r[2]<<16|r[1]<<8|r[0],h=r[7]<<24|r[6]<<16|r[5]<<8|r[4],l=r[11]<<24|r[10]<<16|r[9]<<8|r[8],d=r[15]<<24|r[14]<<16|r[13]<<8|r[12],w=r[19]<<24|r[18]<<16|r[17]<<8|r[16],y=r[23]<<24|r[22]<<16|r[21]<<8|r[20],m=r[27]<<24|r[26]<<16|r[25]<<8|r[24],S=r[31]<<24|r[30]<<16|r[29]<<8|r[28],R=e[3]<<24|e[2]<<16|e[1]<<8|e[0],A=e[7]<<24|e[6]<<16|e[5]<<8|e[4],z=e[11]<<24|e[10]<<16|e[9]<<8|e[8],E=e[15]<<24|e[14]<<16|e[13]<<8|e[12],I=i,_=n,v=s,p=a,o=c,f=h,C=l,L=d,H=w,G=y,J=m,x=S,P=R,k=A,j=z,U=E,M=0;M<$f;M+=2)I=I+o|0,P^=I,P=P>>>32-16|P<<16,H=H+P|0,o^=H,o=o>>>32-12|o<<12,_=_+f|0,k^=_,k=k>>>32-16|k<<16,G=G+k|0,f^=G,f=f>>>32-12|f<<12,v=v+C|0,j^=v,j=j>>>32-16|j<<16,J=J+j|0,C^=J,C=C>>>32-12|C<<12,p=p+L|0,U^=p,U=U>>>32-16|U<<16,x=x+U|0,L^=x,L=L>>>32-12|L<<12,v=v+C|0,j^=v,j=j>>>32-8|j<<8,J=J+j|0,C^=J,C=C>>>32-7|C<<7,p=p+L|0,U^=p,U=U>>>32-8|U<<8,x=x+U|0,L^=x,L=L>>>32-7|L<<7,_=_+f|0,k^=_,k=k>>>32-8|k<<8,G=G+k|0,f^=G,f=f>>>32-7|f<<7,I=I+o|0,P^=I,P=P>>>32-8|P<<8,H=H+P|0,o^=H,o=o>>>32-7|o<<7,I=I+f|0,U^=I,U=U>>>32-16|U<<16,J=J+U|0,f^=J,f=f>>>32-12|f<<12,_=_+C|0,P^=_,P=P>>>32-16|P<<16,x=x+P|0,C^=x,C=C>>>32-12|C<<12,v=v+L|0,k^=v,k=k>>>32-16|k<<16,H=H+k|0,L^=H,L=L>>>32-12|L<<12,p=p+o|0,j^=p,j=j>>>32-16|j<<16,G=G+j|0,o^=G,o=o>>>32-12|o<<12,v=v+L|0,k^=v,k=k>>>32-8|k<<8,H=H+k|0,L^=H,L=L>>>32-7|L<<7,p=p+o|0,j^=p,j=j>>>32-8|j<<8,G=G+j|0,o^=G,o=o>>>32-7|o<<7,_=_+C|0,P^=_,P=P>>>32-8|P<<8,x=x+P|0,C^=x,C=C>>>32-7|C<<7,I=I+f|0,U^=I,U=U>>>32-8|U<<8,J=J+U|0,f^=J,f=f>>>32-7|f<<7;it.writeUint32LE(I+i|0,t,0),it.writeUint32LE(_+n|0,t,4),it.writeUint32LE(v+s|0,t,8),it.writeUint32LE(p+a|0,t,12),it.writeUint32LE(o+c|0,t,16),it.writeUint32LE(f+h|0,t,20),it.writeUint32LE(C+l|0,t,24),it.writeUint32LE(L+d|0,t,28),it.writeUint32LE(H+w|0,t,32),it.writeUint32LE(G+y|0,t,36),it.writeUint32LE(J+m|0,t,40),it.writeUint32LE(x+S|0,t,44),it.writeUint32LE(P+R|0,t,48),it.writeUint32LE(k+A|0,t,52),it.writeUint32LE(j+z|0,t,56),it.writeUint32LE(U+E|0,t,60)}function ho(t,e,r,i,n){if(n===void 0&&(n=0),t.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(i.length<r.length)throw new Error("ChaCha: destination is shorter than source");var s,a;if(n===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");s=new Uint8Array(16),a=s.length-e.length,s.set(e,a)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");s=e,a=n}for(var c=new Uint8Array(64),h=0;h<r.length;h+=64){Mf(c,s,t);for(var l=h;l<h+64&&l<r.length;l++)i[l]=r[l]^c[l-h];qf(s,0,a)}return cn.wipe(c),n===0&&cn.wipe(s),i}oi.streamXOR=ho;function jf(t,e,r,i){return i===void 0&&(i=0),cn.wipe(r),ho(t,e,r,r,i)}oi.stream=jf;function qf(t,e,r){for(var i=1;r--;)i=i+(t[e]&255)|0,t[e]=i&255,i>>>=8,e++;if(i>0)throw new Error("ChaCha: counter overflow")}var fo={},$t={};Object.defineProperty($t,"__esModule",{value:!0});function Bf(t,e,r){return~(t-1)&e|t-1&r}$t.select=Bf;function zf(t,e){return(t|0)-(e|0)-1>>>31&1}$t.lessOrEqual=zf;function po(t,e){if(t.length!==e.length)return 0;for(var r=0,i=0;i<t.length;i++)r|=t[i]^e[i];return 1&r-1>>>8}$t.compare=po;function Hf(t,e){return t.length===0||e.length===0?!1:po(t,e)!==0}$t.equal=Hf,function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=$t,r=gt;t.DIGEST_LENGTH=16;var i=function(){function a(c){this.digestLength=t.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var h=c[0]|c[1]<<8;this._r[0]=h&8191;var l=c[2]|c[3]<<8;this._r[1]=(h>>>13|l<<3)&8191;var d=c[4]|c[5]<<8;this._r[2]=(l>>>10|d<<6)&7939;var w=c[6]|c[7]<<8;this._r[3]=(d>>>7|w<<9)&8191;var y=c[8]|c[9]<<8;this._r[4]=(w>>>4|y<<12)&255,this._r[5]=y>>>1&8190;var m=c[10]|c[11]<<8;this._r[6]=(y>>>14|m<<2)&8191;var S=c[12]|c[13]<<8;this._r[7]=(m>>>11|S<<5)&8065;var R=c[14]|c[15]<<8;this._r[8]=(S>>>8|R<<8)&8191,this._r[9]=R>>>5&127,this._pad[0]=c[16]|c[17]<<8,this._pad[1]=c[18]|c[19]<<8,this._pad[2]=c[20]|c[21]<<8,this._pad[3]=c[22]|c[23]<<8,this._pad[4]=c[24]|c[25]<<8,this._pad[5]=c[26]|c[27]<<8,this._pad[6]=c[28]|c[29]<<8,this._pad[7]=c[30]|c[31]<<8}return a.prototype._blocks=function(c,h,l){for(var d=this._fin?0:2048,w=this._h[0],y=this._h[1],m=this._h[2],S=this._h[3],R=this._h[4],A=this._h[5],z=this._h[6],E=this._h[7],I=this._h[8],_=this._h[9],v=this._r[0],p=this._r[1],o=this._r[2],f=this._r[3],C=this._r[4],L=this._r[5],H=this._r[6],G=this._r[7],J=this._r[8],x=this._r[9];l>=16;){var P=c[h+0]|c[h+1]<<8;w+=P&8191;var k=c[h+2]|c[h+3]<<8;y+=(P>>>13|k<<3)&8191;var j=c[h+4]|c[h+5]<<8;m+=(k>>>10|j<<6)&8191;var U=c[h+6]|c[h+7]<<8;S+=(j>>>7|U<<9)&8191;var M=c[h+8]|c[h+9]<<8;R+=(U>>>4|M<<12)&8191,A+=M>>>1&8191;var F=c[h+10]|c[h+11]<<8;z+=(M>>>14|F<<2)&8191;var q=c[h+12]|c[h+13]<<8;E+=(F>>>11|q<<5)&8191;var te=c[h+14]|c[h+15]<<8;I+=(q>>>8|te<<8)&8191,_+=te>>>5|d;var B=0,Z=B;Z+=w*v,Z+=y*(5*x),Z+=m*(5*J),Z+=S*(5*G),Z+=R*(5*H),B=Z>>>13,Z&=8191,Z+=A*(5*L),Z+=z*(5*C),Z+=E*(5*f),Z+=I*(5*o),Z+=_*(5*p),B+=Z>>>13,Z&=8191;var Y=B;Y+=w*p,Y+=y*v,Y+=m*(5*x),Y+=S*(5*J),Y+=R*(5*G),B=Y>>>13,Y&=8191,Y+=A*(5*H),Y+=z*(5*L),Y+=E*(5*C),Y+=I*(5*f),Y+=_*(5*o),B+=Y>>>13,Y&=8191;var ee=B;ee+=w*o,ee+=y*p,ee+=m*v,ee+=S*(5*x),ee+=R*(5*J),B=ee>>>13,ee&=8191,ee+=A*(5*G),ee+=z*(5*H),ee+=E*(5*L),ee+=I*(5*C),ee+=_*(5*f),B+=ee>>>13,ee&=8191;var N=B;N+=w*f,N+=y*o,N+=m*p,N+=S*v,N+=R*(5*x),B=N>>>13,N&=8191,N+=A*(5*J),N+=z*(5*G),N+=E*(5*H),N+=I*(5*L),N+=_*(5*C),B+=N>>>13,N&=8191;var T=B;T+=w*C,T+=y*f,T+=m*o,T+=S*p,T+=R*v,B=T>>>13,T&=8191,T+=A*(5*x),T+=z*(5*J),T+=E*(5*G),T+=I*(5*H),T+=_*(5*L),B+=T>>>13,T&=8191;var D=B;D+=w*L,D+=y*C,D+=m*f,D+=S*o,D+=R*p,B=D>>>13,D&=8191,D+=A*v,D+=z*(5*x),D+=E*(5*J),D+=I*(5*G),D+=_*(5*H),B+=D>>>13,D&=8191;var u=B;u+=w*H,u+=y*L,u+=m*C,u+=S*f,u+=R*o,B=u>>>13,u&=8191,u+=A*p,u+=z*v,u+=E*(5*x),u+=I*(5*J),u+=_*(5*G),B+=u>>>13,u&=8191;var b=B;b+=w*G,b+=y*H,b+=m*L,b+=S*C,b+=R*f,B=b>>>13,b&=8191,b+=A*o,b+=z*p,b+=E*v,b+=I*(5*x),b+=_*(5*J),B+=b>>>13,b&=8191;var K=B;K+=w*J,K+=y*G,K+=m*H,K+=S*L,K+=R*C,B=K>>>13,K&=8191,K+=A*f,K+=z*o,K+=E*p,K+=I*v,K+=_*(5*x),B+=K>>>13,K&=8191;var W=B;W+=w*x,W+=y*J,W+=m*G,W+=S*H,W+=R*L,B=W>>>13,W&=8191,W+=A*C,W+=z*f,W+=E*o,W+=I*p,W+=_*v,B+=W>>>13,W&=8191,B=(B<<2)+B|0,B=B+Z|0,Z=B&8191,B=B>>>13,Y+=B,w=Z,y=Y,m=ee,S=N,R=T,A=D,z=u,E=b,I=K,_=W,h+=16,l-=16}this._h[0]=w,this._h[1]=y,this._h[2]=m,this._h[3]=S,this._h[4]=R,this._h[5]=A,this._h[6]=z,this._h[7]=E,this._h[8]=I,this._h[9]=_},a.prototype.finish=function(c,h){h===void 0&&(h=0);var l=new Uint16Array(10),d,w,y,m;if(this._leftover){for(m=this._leftover,this._buffer[m++]=1;m<16;m++)this._buffer[m]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(d=this._h[1]>>>13,this._h[1]&=8191,m=2;m<10;m++)this._h[m]+=d,d=this._h[m]>>>13,this._h[m]&=8191;for(this._h[0]+=d*5,d=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=d,d=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=d,l[0]=this._h[0]+5,d=l[0]>>>13,l[0]&=8191,m=1;m<10;m++)l[m]=this._h[m]+d,d=l[m]>>>13,l[m]&=8191;for(l[9]-=8192,w=(d^1)-1,m=0;m<10;m++)l[m]&=w;for(w=~w,m=0;m<10;m++)this._h[m]=this._h[m]&w|l[m];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,y=this._h[0]+this._pad[0],this._h[0]=y&65535,m=1;m<8;m++)y=(this._h[m]+this._pad[m]|0)+(y>>>16)|0,this._h[m]=y&65535;return c[h+0]=this._h[0]>>>0,c[h+1]=this._h[0]>>>8,c[h+2]=this._h[1]>>>0,c[h+3]=this._h[1]>>>8,c[h+4]=this._h[2]>>>0,c[h+5]=this._h[2]>>>8,c[h+6]=this._h[3]>>>0,c[h+7]=this._h[3]>>>8,c[h+8]=this._h[4]>>>0,c[h+9]=this._h[4]>>>8,c[h+10]=this._h[5]>>>0,c[h+11]=this._h[5]>>>8,c[h+12]=this._h[6]>>>0,c[h+13]=this._h[6]>>>8,c[h+14]=this._h[7]>>>0,c[h+15]=this._h[7]>>>8,this._finished=!0,this},a.prototype.update=function(c){var h=0,l=c.length,d;if(this._leftover){d=16-this._leftover,d>l&&(d=l);for(var w=0;w<d;w++)this._buffer[this._leftover+w]=c[h+w];if(l-=d,h+=d,this._leftover+=d,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(l>=16&&(d=l-l%16,this._blocks(c,h,d),h+=d,l-=d),l){for(var w=0;w<l;w++)this._buffer[this._leftover+w]=c[h+w];this._leftover+=l}return this},a.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var c=new Uint8Array(16);return this.finish(c),c},a.prototype.clean=function(){return r.wipe(this._buffer),r.wipe(this._r),r.wipe(this._h),r.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},a}();t.Poly1305=i;function n(a,c){var h=new i(a);h.update(c);var l=h.digest();return h.clean(),l}t.oneTimeAuth=n;function s(a,c){return a.length!==t.DIGEST_LENGTH||c.length!==t.DIGEST_LENGTH?!1:e.equal(a,c)}t.equal=s}(fo),function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=oi,r=fo,i=gt,n=ie,s=$t;t.KEY_LENGTH=32,t.NONCE_LENGTH=12,t.TAG_LENGTH=16;var a=new Uint8Array(16),c=function(){function h(l){if(this.nonceLength=t.NONCE_LENGTH,this.tagLength=t.TAG_LENGTH,l.length!==t.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(l)}return h.prototype.seal=function(l,d,w,y){if(l.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var m=new Uint8Array(16);m.set(l,m.length-l.length);var S=new Uint8Array(32);e.stream(this._key,m,S,4);var R=d.length+this.tagLength,A;if(y){if(y.length!==R)throw new Error("ChaCha20Poly1305: incorrect destination length");A=y}else A=new Uint8Array(R);return e.streamXOR(this._key,m,d,A,4),this._authenticate(A.subarray(A.length-this.tagLength,A.length),S,A.subarray(0,A.length-this.tagLength),w),i.wipe(m),A},h.prototype.open=function(l,d,w,y){if(l.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(d.length<this.tagLength)return null;var m=new Uint8Array(16);m.set(l,m.length-l.length);var S=new Uint8Array(32);e.stream(this._key,m,S,4);var R=new Uint8Array(this.tagLength);if(this._authenticate(R,S,d.subarray(0,d.length-this.tagLength),w),!s.equal(R,d.subarray(d.length-this.tagLength,d.length)))return null;var A=d.length-this.tagLength,z;if(y){if(y.length!==A)throw new Error("ChaCha20Poly1305: incorrect destination length");z=y}else z=new Uint8Array(A);return e.streamXOR(this._key,m,d.subarray(0,d.length-this.tagLength),z,4),i.wipe(m),z},h.prototype.clean=function(){return i.wipe(this._key),this},h.prototype._authenticate=function(l,d,w,y){var m=new r.Poly1305(d);y&&(m.update(y),y.length%16>0&&m.update(a.subarray(y.length%16))),m.update(w),w.length%16>0&&m.update(a.subarray(w.length%16));var S=new Uint8Array(8);y&&n.writeUint64LE(y.length,S),m.update(S),n.writeUint64LE(w.length,S),m.update(S);for(var R=m.digest(),A=0;A<R.length;A++)l[A]=R[A];m.clean(),i.wipe(R),i.wipe(S)},h}();t.ChaCha20Poly1305=c}(an);var go={},Tr={},un={};Object.defineProperty(un,"__esModule",{value:!0});function Kf(t){return typeof t.saveState<"u"&&typeof t.restoreState<"u"&&typeof t.cleanSavedState<"u"}un.isSerializableHash=Kf,Object.defineProperty(Tr,"__esModule",{value:!0});var It=un,Vf=$t,Gf=gt,yo=function(){function t(e,r){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var i=new Uint8Array(this.blockSize);r.length>this.blockSize?this._inner.update(r).finish(i).clean():i.set(r);for(var n=0;n<i.length;n++)i[n]^=54;this._inner.update(i);for(var n=0;n<i.length;n++)i[n]^=106;this._outer.update(i),It.isSerializableHash(this._inner)&&It.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),Gf.wipe(i)}return t.prototype.reset=function(){if(!It.isSerializableHash(this._inner)||!It.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.clean=function(){It.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),It.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},t.prototype.update=function(e){return this._inner.update(e),this},t.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},t.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},t.prototype.saveState=function(){if(!It.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},t.prototype.restoreState=function(e){if(!It.isSerializableHash(this._inner)||!It.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.cleanSavedState=function(e){if(!It.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},t}();Tr.HMAC=yo;function kf(t,e,r){var i=new yo(t,e);i.update(r);var n=i.digest();return i.clean(),n}Tr.hmac=kf,Tr.equal=Vf.equal,Object.defineProperty(go,"__esModule",{value:!0});var _o=Tr,bo=gt,Wf=function(){function t(e,r,i,n){i===void 0&&(i=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=n;var s=_o.hmac(this._hash,i,r);this._hmac=new _o.HMAC(e,s),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return t.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(e===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},t.prototype.expand=function(e){for(var r=new Uint8Array(e),i=0;i<r.length;i++)this._bufpos===this._buffer.length&&this._fillBuffer(),r[i]=this._buffer[this._bufpos++];return r},t.prototype.clean=function(){this._hmac.clean(),bo.wipe(this._buffer),bo.wipe(this._counter),this._bufpos=0},t}(),Yf=go.HKDF=Wf,ai={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=ie,r=gt;t.DIGEST_LENGTH=32,t.BLOCK_SIZE=64;var i=function(){function c(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return c.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},c.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},c.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._temp),this.reset()},c.prototype.update=function(h,l){if(l===void 0&&(l=h.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var d=0;if(this._bytesHashed+=l,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&l>0;)this._buffer[this._bufferLength++]=h[d++],l--;this._bufferLength===this.blockSize&&(s(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(l>=this.blockSize&&(d=s(this._temp,this._state,h,d,l),l%=this.blockSize);l>0;)this._buffer[this._bufferLength++]=h[d++],l--;return this},c.prototype.finish=function(h){if(!this._finished){var l=this._bytesHashed,d=this._bufferLength,w=l/536870912|0,y=l<<3,m=l%64<56?64:128;this._buffer[d]=128;for(var S=d+1;S<m-8;S++)this._buffer[S]=0;e.writeUint32BE(w,this._buffer,m-8),e.writeUint32BE(y,this._buffer,m-4),s(this._temp,this._state,this._buffer,0,m),this._finished=!0}for(var S=0;S<this.digestLength/4;S++)e.writeUint32BE(this._state[S],h,S*4);return this},c.prototype.digest=function(){var h=new Uint8Array(this.digestLength);return this.finish(h),h},c.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},c.prototype.restoreState=function(h){return this._state.set(h.state),this._bufferLength=h.bufferLength,h.buffer&&this._buffer.set(h.buffer),this._bytesHashed=h.bytesHashed,this._finished=!1,this},c.prototype.cleanSavedState=function(h){r.wipe(h.state),h.buffer&&r.wipe(h.buffer),h.bufferLength=0,h.bytesHashed=0},c}();t.SHA256=i;var n=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function s(c,h,l,d,w){for(;w>=64;){for(var y=h[0],m=h[1],S=h[2],R=h[3],A=h[4],z=h[5],E=h[6],I=h[7],_=0;_<16;_++){var v=d+_*4;c[_]=e.readUint32BE(l,v)}for(var _=16;_<64;_++){var p=c[_-2],o=(p>>>17|p<<32-17)^(p>>>19|p<<32-19)^p>>>10;p=c[_-15];var f=(p>>>7|p<<32-7)^(p>>>18|p<<32-18)^p>>>3;c[_]=(o+c[_-7]|0)+(f+c[_-16]|0)}for(var _=0;_<64;_++){var o=(((A>>>6|A<<26)^(A>>>11|A<<21)^(A>>>25|A<<7))+(A&z^~A&E)|0)+(I+(n[_]+c[_]|0)|0)|0,f=((y>>>2|y<<32-2)^(y>>>13|y<<32-13)^(y>>>22|y<<32-22))+(y&m^y&S^m&S)|0;I=E,E=z,z=A,A=R+o|0,R=S,S=m,m=y,y=o+f|0}h[0]+=y,h[1]+=m,h[2]+=S,h[3]+=R,h[4]+=A,h[5]+=z,h[6]+=E,h[7]+=I,d+=64,w-=64}return d}function a(c){var h=new i;h.update(c);var l=h.digest();return h.clean(),l}t.hash=a})(ai);var ln={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.sharedKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.scalarMultBase=t.scalarMult=t.SHARED_KEY_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=void 0;const e=ar,r=gt;t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=32,t.SHARED_KEY_LENGTH=32;function i(_){const v=new Float64Array(16);if(_)for(let p=0;p<_.length;p++)v[p]=_[p];return v}const n=new Uint8Array(32);n[0]=9;const s=i([56129,1]);function a(_){let v=1;for(let p=0;p<16;p++){let o=_[p]+v+65535;v=Math.floor(o/65536),_[p]=o-v*65536}_[0]+=v-1+37*(v-1)}function c(_,v,p){const o=~(p-1);for(let f=0;f<16;f++){const C=o&(_[f]^v[f]);_[f]^=C,v[f]^=C}}function h(_,v){const p=i(),o=i();for(let f=0;f<16;f++)o[f]=v[f];a(o),a(o),a(o);for(let f=0;f<2;f++){p[0]=o[0]-65517;for(let L=1;L<15;L++)p[L]=o[L]-65535-(p[L-1]>>16&1),p[L-1]&=65535;p[15]=o[15]-32767-(p[14]>>16&1);const C=p[15]>>16&1;p[14]&=65535,c(o,p,1-C)}for(let f=0;f<16;f++)_[2*f]=o[f]&255,_[2*f+1]=o[f]>>8}function l(_,v){for(let p=0;p<16;p++)_[p]=v[2*p]+(v[2*p+1]<<8);_[15]&=32767}function d(_,v,p){for(let o=0;o<16;o++)_[o]=v[o]+p[o]}function w(_,v,p){for(let o=0;o<16;o++)_[o]=v[o]-p[o]}function y(_,v,p){let o,f,C=0,L=0,H=0,G=0,J=0,x=0,P=0,k=0,j=0,U=0,M=0,F=0,q=0,te=0,B=0,Z=0,Y=0,ee=0,N=0,T=0,D=0,u=0,b=0,K=0,W=0,he=0,be=0,de=0,me=0,Fe=0,Re=0,ye=p[0],pe=p[1],fe=p[2],ue=p[3],ce=p[4],ae=p[5],oe=p[6],re=p[7],le=p[8],ge=p[9],ne=p[10],we=p[11],ve=p[12],Se=p[13],De=p[14],Ee=p[15];o=v[0],C+=o*ye,L+=o*pe,H+=o*fe,G+=o*ue,J+=o*ce,x+=o*ae,P+=o*oe,k+=o*re,j+=o*le,U+=o*ge,M+=o*ne,F+=o*we,q+=o*ve,te+=o*Se,B+=o*De,Z+=o*Ee,o=v[1],L+=o*ye,H+=o*pe,G+=o*fe,J+=o*ue,x+=o*ce,P+=o*ae,k+=o*oe,j+=o*re,U+=o*le,M+=o*ge,F+=o*ne,q+=o*we,te+=o*ve,B+=o*Se,Z+=o*De,Y+=o*Ee,o=v[2],H+=o*ye,G+=o*pe,J+=o*fe,x+=o*ue,P+=o*ce,k+=o*ae,j+=o*oe,U+=o*re,M+=o*le,F+=o*ge,q+=o*ne,te+=o*we,B+=o*ve,Z+=o*Se,Y+=o*De,ee+=o*Ee,o=v[3],G+=o*ye,J+=o*pe,x+=o*fe,P+=o*ue,k+=o*ce,j+=o*ae,U+=o*oe,M+=o*re,F+=o*le,q+=o*ge,te+=o*ne,B+=o*we,Z+=o*ve,Y+=o*Se,ee+=o*De,N+=o*Ee,o=v[4],J+=o*ye,x+=o*pe,P+=o*fe,k+=o*ue,j+=o*ce,U+=o*ae,M+=o*oe,F+=o*re,q+=o*le,te+=o*ge,B+=o*ne,Z+=o*we,Y+=o*ve,ee+=o*Se,N+=o*De,T+=o*Ee,o=v[5],x+=o*ye,P+=o*pe,k+=o*fe,j+=o*ue,U+=o*ce,M+=o*ae,F+=o*oe,q+=o*re,te+=o*le,B+=o*ge,Z+=o*ne,Y+=o*we,ee+=o*ve,N+=o*Se,T+=o*De,D+=o*Ee,o=v[6],P+=o*ye,k+=o*pe,j+=o*fe,U+=o*ue,M+=o*ce,F+=o*ae,q+=o*oe,te+=o*re,B+=o*le,Z+=o*ge,Y+=o*ne,ee+=o*we,N+=o*ve,T+=o*Se,D+=o*De,u+=o*Ee,o=v[7],k+=o*ye,j+=o*pe,U+=o*fe,M+=o*ue,F+=o*ce,q+=o*ae,te+=o*oe,B+=o*re,Z+=o*le,Y+=o*ge,ee+=o*ne,N+=o*we,T+=o*ve,D+=o*Se,u+=o*De,b+=o*Ee,o=v[8],j+=o*ye,U+=o*pe,M+=o*fe,F+=o*ue,q+=o*ce,te+=o*ae,B+=o*oe,Z+=o*re,Y+=o*le,ee+=o*ge,N+=o*ne,T+=o*we,D+=o*ve,u+=o*Se,b+=o*De,K+=o*Ee,o=v[9],U+=o*ye,M+=o*pe,F+=o*fe,q+=o*ue,te+=o*ce,B+=o*ae,Z+=o*oe,Y+=o*re,ee+=o*le,N+=o*ge,T+=o*ne,D+=o*we,u+=o*ve,b+=o*Se,K+=o*De,W+=o*Ee,o=v[10],M+=o*ye,F+=o*pe,q+=o*fe,te+=o*ue,B+=o*ce,Z+=o*ae,Y+=o*oe,ee+=o*re,N+=o*le,T+=o*ge,D+=o*ne,u+=o*we,b+=o*ve,K+=o*Se,W+=o*De,he+=o*Ee,o=v[11],F+=o*ye,q+=o*pe,te+=o*fe,B+=o*ue,Z+=o*ce,Y+=o*ae,ee+=o*oe,N+=o*re,T+=o*le,D+=o*ge,u+=o*ne,b+=o*we,K+=o*ve,W+=o*Se,he+=o*De,be+=o*Ee,o=v[12],q+=o*ye,te+=o*pe,B+=o*fe,Z+=o*ue,Y+=o*ce,ee+=o*ae,N+=o*oe,T+=o*re,D+=o*le,u+=o*ge,b+=o*ne,K+=o*we,W+=o*ve,he+=o*Se,be+=o*De,de+=o*Ee,o=v[13],te+=o*ye,B+=o*pe,Z+=o*fe,Y+=o*ue,ee+=o*ce,N+=o*ae,T+=o*oe,D+=o*re,u+=o*le,b+=o*ge,K+=o*ne,W+=o*we,he+=o*ve,be+=o*Se,de+=o*De,me+=o*Ee,o=v[14],B+=o*ye,Z+=o*pe,Y+=o*fe,ee+=o*ue,N+=o*ce,T+=o*ae,D+=o*oe,u+=o*re,b+=o*le,K+=o*ge,W+=o*ne,he+=o*we,be+=o*ve,de+=o*Se,me+=o*De,Fe+=o*Ee,o=v[15],Z+=o*ye,Y+=o*pe,ee+=o*fe,N+=o*ue,T+=o*ce,D+=o*ae,u+=o*oe,b+=o*re,K+=o*le,W+=o*ge,he+=o*ne,be+=o*we,de+=o*ve,me+=o*Se,Fe+=o*De,Re+=o*Ee,C+=38*Y,L+=38*ee,H+=38*N,G+=38*T,J+=38*D,x+=38*u,P+=38*b,k+=38*K,j+=38*W,U+=38*he,M+=38*be,F+=38*de,q+=38*me,te+=38*Fe,B+=38*Re,f=1,o=C+f+65535,f=Math.floor(o/65536),C=o-f*65536,o=L+f+65535,f=Math.floor(o/65536),L=o-f*65536,o=H+f+65535,f=Math.floor(o/65536),H=o-f*65536,o=G+f+65535,f=Math.floor(o/65536),G=o-f*65536,o=J+f+65535,f=Math.floor(o/65536),J=o-f*65536,o=x+f+65535,f=Math.floor(o/65536),x=o-f*65536,o=P+f+65535,f=Math.floor(o/65536),P=o-f*65536,o=k+f+65535,f=Math.floor(o/65536),k=o-f*65536,o=j+f+65535,f=Math.floor(o/65536),j=o-f*65536,o=U+f+65535,f=Math.floor(o/65536),U=o-f*65536,o=M+f+65535,f=Math.floor(o/65536),M=o-f*65536,o=F+f+65535,f=Math.floor(o/65536),F=o-f*65536,o=q+f+65535,f=Math.floor(o/65536),q=o-f*65536,o=te+f+65535,f=Math.floor(o/65536),te=o-f*65536,o=B+f+65535,f=Math.floor(o/65536),B=o-f*65536,o=Z+f+65535,f=Math.floor(o/65536),Z=o-f*65536,C+=f-1+37*(f-1),f=1,o=C+f+65535,f=Math.floor(o/65536),C=o-f*65536,o=L+f+65535,f=Math.floor(o/65536),L=o-f*65536,o=H+f+65535,f=Math.floor(o/65536),H=o-f*65536,o=G+f+65535,f=Math.floor(o/65536),G=o-f*65536,o=J+f+65535,f=Math.floor(o/65536),J=o-f*65536,o=x+f+65535,f=Math.floor(o/65536),x=o-f*65536,o=P+f+65535,f=Math.floor(o/65536),P=o-f*65536,o=k+f+65535,f=Math.floor(o/65536),k=o-f*65536,o=j+f+65535,f=Math.floor(o/65536),j=o-f*65536,o=U+f+65535,f=Math.floor(o/65536),U=o-f*65536,o=M+f+65535,f=Math.floor(o/65536),M=o-f*65536,o=F+f+65535,f=Math.floor(o/65536),F=o-f*65536,o=q+f+65535,f=Math.floor(o/65536),q=o-f*65536,o=te+f+65535,f=Math.floor(o/65536),te=o-f*65536,o=B+f+65535,f=Math.floor(o/65536),B=o-f*65536,o=Z+f+65535,f=Math.floor(o/65536),Z=o-f*65536,C+=f-1+37*(f-1),_[0]=C,_[1]=L,_[2]=H,_[3]=G,_[4]=J,_[5]=x,_[6]=P,_[7]=k,_[8]=j,_[9]=U,_[10]=M,_[11]=F,_[12]=q,_[13]=te,_[14]=B,_[15]=Z}function m(_,v){y(_,v,v)}function S(_,v){const p=i();for(let o=0;o<16;o++)p[o]=v[o];for(let o=253;o>=0;o--)m(p,p),o!==2&&o!==4&&y(p,p,v);for(let o=0;o<16;o++)_[o]=p[o]}function R(_,v){const p=new Uint8Array(32),o=new Float64Array(80),f=i(),C=i(),L=i(),H=i(),G=i(),J=i();for(let j=0;j<31;j++)p[j]=_[j];p[31]=_[31]&127|64,p[0]&=248,l(o,v);for(let j=0;j<16;j++)C[j]=o[j];f[0]=H[0]=1;for(let j=254;j>=0;--j){const U=p[j>>>3]>>>(j&7)&1;c(f,C,U),c(L,H,U),d(G,f,L),w(f,f,L),d(L,C,H),w(C,C,H),m(H,G),m(J,f),y(f,L,f),y(L,C,G),d(G,f,L),w(f,f,L),m(C,f),w(L,H,J),y(f,L,s),d(f,f,H),y(L,L,f),y(f,H,J),y(H,C,o),m(C,G),c(f,C,U),c(L,H,U)}for(let j=0;j<16;j++)o[j+16]=f[j],o[j+32]=L[j],o[j+48]=C[j],o[j+64]=H[j];const x=o.subarray(32),P=o.subarray(16);S(x,x),y(P,P,x);const k=new Uint8Array(32);return h(k,P),k}t.scalarMult=R;function A(_){return R(_,n)}t.scalarMultBase=A;function z(_){if(_.length!==t.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${t.SECRET_KEY_LENGTH} bytes`);const v=new Uint8Array(_);return{publicKey:A(v),secretKey:v}}t.generateKeyPairFromSeed=z;function E(_){const v=(0,e.randomBytes)(32,_),p=z(v);return(0,r.wipe)(v),p}t.generateKeyPair=E;function I(_,v,p=!1){if(_.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(v.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");const o=R(_,v);if(p){let f=0;for(let C=0;C<o.length;C++)f|=o[C];if(f===0)throw new Error("X25519: invalid shared key")}return o}t.sharedKey=I})(ln);var wo=function(t,e,r){if(r||arguments.length===2)for(var i=0,n=e.length,s;i<n;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))},Xf=function(){function t(e,r,i){this.name=e,this.version=r,this.os=i,this.type="browser"}return t}(),Jf=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}(),Qf=function(){function t(e,r,i,n){this.name=e,this.version=r,this.os=i,this.bot=n,this.type="bot-device"}return t}(),Zf=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),ed=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),td=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,rd=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,vo=3,id=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",td]],mo=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function nd(t){return t?Eo(t):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new ed:typeof navigator<"u"?Eo(navigator.userAgent):ad()}function sd(t){return t!==""&&id.reduce(function(e,r){var i=r[0],n=r[1];if(e)return e;var s=n.exec(t);return!!s&&[i,s]},!1)}function Eo(t){var e=sd(t);if(!e)return null;var r=e[0],i=e[1];if(r==="searchbot")return new Zf;var n=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);n?n.length<vo&&(n=wo(wo([],n,!0),cd(vo-n.length),!0)):n=[];var s=n.join("."),a=od(t),c=rd.exec(t);return c&&c[1]?new Qf(r,s,a,c[1]):new Xf(r,s,a)}function od(t){for(var e=0,r=mo.length;e<r;e++){var i=mo[e],n=i[0],s=i[1],a=s.exec(t);if(a)return n}return null}function ad(){var t=typeof process<"u"&&process.version;return t?new Jf(process.version.slice(1)):null}function cd(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var Ie={};Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.getLocalStorage=Ie.getLocalStorageOrThrow=Ie.getCrypto=Ie.getCryptoOrThrow=Do=Ie.getLocation=Ie.getLocationOrThrow=hn=Ie.getNavigator=Ie.getNavigatorOrThrow=So=Ie.getDocument=Ie.getDocumentOrThrow=Ie.getFromWindowOrThrow=Ie.getFromWindow=void 0;function Xt(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}Ie.getFromWindow=Xt;function cr(t){const e=Xt(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}Ie.getFromWindowOrThrow=cr;function ud(){return cr("document")}Ie.getDocumentOrThrow=ud;function ld(){return Xt("document")}var So=Ie.getDocument=ld;function hd(){return cr("navigator")}Ie.getNavigatorOrThrow=hd;function fd(){return Xt("navigator")}var hn=Ie.getNavigator=fd;function dd(){return cr("location")}Ie.getLocationOrThrow=dd;function pd(){return Xt("location")}var Do=Ie.getLocation=pd;function gd(){return cr("crypto")}Ie.getCryptoOrThrow=gd;function yd(){return Xt("crypto")}Ie.getCrypto=yd;function _d(){return cr("localStorage")}Ie.getLocalStorageOrThrow=_d;function bd(){return Xt("localStorage")}Ie.getLocalStorage=bd;var fn={};Object.defineProperty(fn,"__esModule",{value:!0});var Oo=fn.getWindowMetadata=void 0;const xo=Ie;function wd(){let t,e;try{t=xo.getDocumentOrThrow(),e=xo.getLocationOrThrow()}catch{return null}function r(){const w=t.getElementsByTagName("link"),y=[];for(let m=0;m<w.length;m++){const S=w[m],R=S.getAttribute("rel");if(R&&R.toLowerCase().indexOf("icon")>-1){const A=S.getAttribute("href");if(A)if(A.toLowerCase().indexOf("https:")===-1&&A.toLowerCase().indexOf("http:")===-1&&A.indexOf("//")!==0){let z=e.protocol+"//"+e.host;if(A.indexOf("/")===0)z+=A;else{const E=e.pathname.split("/");E.pop();const I=E.join("/");z+=I+"/"+A}y.push(z)}else if(A.indexOf("//")===0){const z=e.protocol+A;y.push(z)}else y.push(A)}}return y}function i(...w){const y=t.getElementsByTagName("meta");for(let m=0;m<y.length;m++){const S=y[m],R=["itemprop","property","name"].map(A=>S.getAttribute(A)).filter(A=>A?w.includes(A):!1);if(R.length&&R){const A=S.getAttribute("content");if(A)return A}}return""}function n(){let w=i("name","og:site_name","og:title","twitter:title");return w||(w=t.title),w}function s(){return i("description","og:description","twitter:description","keywords")}const a=n(),c=s(),h=e.origin,l=r();return{description:c,url:h,icons:l,name:a}}Oo=fn.getWindowMetadata=wd;var Nr={},vd=t=>encodeURIComponent(t).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`),Io="%[a-f0-9]{2}",To=new RegExp("("+Io+")|([^%]+?)","gi"),No=new RegExp("("+Io+")+","gi");function dn(t,e){try{return[decodeURIComponent(t.join(""))]}catch{}if(t.length===1)return t;e=e||1;var r=t.slice(0,e),i=t.slice(e);return Array.prototype.concat.call([],dn(r),dn(i))}function md(t){try{return decodeURIComponent(t)}catch{for(var e=t.match(To)||[],r=1;r<e.length;r++)t=dn(e,r).join(""),e=t.match(To)||[];return t}}function Ed(t){for(var e={"%FE%FF":"\uFFFD\uFFFD","%FF%FE":"\uFFFD\uFFFD"},r=No.exec(t);r;){try{e[r[0]]=decodeURIComponent(r[0])}catch{var i=md(r[0]);i!==r[0]&&(e[r[0]]=i)}r=No.exec(t)}e["%C2"]="\uFFFD";for(var n=Object.keys(e),s=0;s<n.length;s++){var a=n[s];t=t.replace(new RegExp(a,"g"),e[a])}return t}var Sd=function(t){if(typeof t!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof t+"`");try{return t=t.replace(/\+/g," "),decodeURIComponent(t)}catch{return Ed(t)}},Dd=(t,e)=>{if(!(typeof t=="string"&&typeof e=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(e==="")return[t];const r=t.indexOf(e);return r===-1?[t]:[t.slice(0,r),t.slice(r+e.length)]},Od=function(t,e){for(var r={},i=Object.keys(t),n=Array.isArray(e),s=0;s<i.length;s++){var a=i[s],c=t[a];(n?e.indexOf(a)!==-1:e(a,c,t))&&(r[a]=c)}return r};(function(t){const e=vd,r=Sd,i=Dd,n=Od,s=E=>E==null,a=Symbol("encodeFragmentIdentifier");function c(E){switch(E.arrayFormat){case"index":return I=>(_,v)=>{const p=_.length;return v===void 0||E.skipNull&&v===null||E.skipEmptyString&&v===""?_:v===null?[..._,[d(I,E),"[",p,"]"].join("")]:[..._,[d(I,E),"[",d(p,E),"]=",d(v,E)].join("")]};case"bracket":return I=>(_,v)=>v===void 0||E.skipNull&&v===null||E.skipEmptyString&&v===""?_:v===null?[..._,[d(I,E),"[]"].join("")]:[..._,[d(I,E),"[]=",d(v,E)].join("")];case"colon-list-separator":return I=>(_,v)=>v===void 0||E.skipNull&&v===null||E.skipEmptyString&&v===""?_:v===null?[..._,[d(I,E),":list="].join("")]:[..._,[d(I,E),":list=",d(v,E)].join("")];case"comma":case"separator":case"bracket-separator":{const I=E.arrayFormat==="bracket-separator"?"[]=":"=";return _=>(v,p)=>p===void 0||E.skipNull&&p===null||E.skipEmptyString&&p===""?v:(p=p===null?"":p,v.length===0?[[d(_,E),I,d(p,E)].join("")]:[[v,d(p,E)].join(E.arrayFormatSeparator)])}default:return I=>(_,v)=>v===void 0||E.skipNull&&v===null||E.skipEmptyString&&v===""?_:v===null?[..._,d(I,E)]:[..._,[d(I,E),"=",d(v,E)].join("")]}}function h(E){let I;switch(E.arrayFormat){case"index":return(_,v,p)=>{if(I=/\[(\d*)\]$/.exec(_),_=_.replace(/\[\d*\]$/,""),!I){p[_]=v;return}p[_]===void 0&&(p[_]={}),p[_][I[1]]=v};case"bracket":return(_,v,p)=>{if(I=/(\[\])$/.exec(_),_=_.replace(/\[\]$/,""),!I){p[_]=v;return}if(p[_]===void 0){p[_]=[v];return}p[_]=[].concat(p[_],v)};case"colon-list-separator":return(_,v,p)=>{if(I=/(:list)$/.exec(_),_=_.replace(/:list$/,""),!I){p[_]=v;return}if(p[_]===void 0){p[_]=[v];return}p[_]=[].concat(p[_],v)};case"comma":case"separator":return(_,v,p)=>{const o=typeof v=="string"&&v.includes(E.arrayFormatSeparator),f=typeof v=="string"&&!o&&w(v,E).includes(E.arrayFormatSeparator);v=f?w(v,E):v;const C=o||f?v.split(E.arrayFormatSeparator).map(L=>w(L,E)):v===null?v:w(v,E);p[_]=C};case"bracket-separator":return(_,v,p)=>{const o=/(\[\])$/.test(_);if(_=_.replace(/\[\]$/,""),!o){p[_]=v&&w(v,E);return}const f=v===null?[]:v.split(E.arrayFormatSeparator).map(C=>w(C,E));if(p[_]===void 0){p[_]=f;return}p[_]=[].concat(p[_],f)};default:return(_,v,p)=>{if(p[_]===void 0){p[_]=v;return}p[_]=[].concat(p[_],v)}}}function l(E){if(typeof E!="string"||E.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function d(E,I){return I.encode?I.strict?e(E):encodeURIComponent(E):E}function w(E,I){return I.decode?r(E):E}function y(E){return Array.isArray(E)?E.sort():typeof E=="object"?y(Object.keys(E)).sort((I,_)=>Number(I)-Number(_)).map(I=>E[I]):E}function m(E){const I=E.indexOf("#");return I!==-1&&(E=E.slice(0,I)),E}function S(E){let I="";const _=E.indexOf("#");return _!==-1&&(I=E.slice(_)),I}function R(E){E=m(E);const I=E.indexOf("?");return I===-1?"":E.slice(I+1)}function A(E,I){return I.parseNumbers&&!Number.isNaN(Number(E))&&typeof E=="string"&&E.trim()!==""?E=Number(E):I.parseBooleans&&E!==null&&(E.toLowerCase()==="true"||E.toLowerCase()==="false")&&(E=E.toLowerCase()==="true"),E}function z(E,I){I=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},I),l(I.arrayFormatSeparator);const _=h(I),v=Object.create(null);if(typeof E!="string"||(E=E.trim().replace(/^[?#&]/,""),!E))return v;for(const p of E.split("&")){if(p==="")continue;let[o,f]=i(I.decode?p.replace(/\+/g," "):p,"=");f=f===void 0?null:["comma","separator","bracket-separator"].includes(I.arrayFormat)?f:w(f,I),_(w(o,I),f,v)}for(const p of Object.keys(v)){const o=v[p];if(typeof o=="object"&&o!==null)for(const f of Object.keys(o))o[f]=A(o[f],I);else v[p]=A(o,I)}return I.sort===!1?v:(I.sort===!0?Object.keys(v).sort():Object.keys(v).sort(I.sort)).reduce((p,o)=>{const f=v[o];return f&&typeof f=="object"&&!Array.isArray(f)?p[o]=y(f):p[o]=f,p},Object.create(null))}t.extract=R,t.parse=z,t.stringify=(E,I)=>{if(!E)return"";I=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},I),l(I.arrayFormatSeparator);const _=f=>I.skipNull&&s(E[f])||I.skipEmptyString&&E[f]==="",v=c(I),p={};for(const f of Object.keys(E))_(f)||(p[f]=E[f]);const o=Object.keys(p);return I.sort!==!1&&o.sort(I.sort),o.map(f=>{const C=E[f];return C===void 0?"":C===null?d(f,I):Array.isArray(C)?C.length===0&&I.arrayFormat==="bracket-separator"?d(f,I)+"[]":C.reduce(v(f),[]).join("&"):d(f,I)+"="+d(C,I)}).filter(f=>f.length>0).join("&")},t.parseUrl=(E,I)=>{I=Object.assign({decode:!0},I);const[_,v]=i(E,"#");return Object.assign({url:_.split("?")[0]||"",query:z(R(E),I)},I&&I.parseFragmentIdentifier&&v?{fragmentIdentifier:w(v,I)}:{})},t.stringifyUrl=(E,I)=>{I=Object.assign({encode:!0,strict:!0,[a]:!0},I);const _=m(E.url).split("?")[0]||"",v=t.extract(E.url),p=t.parse(v,{sort:!1}),o=Object.assign(p,E.query);let f=t.stringify(o,I);f&&(f=`?${f}`);let C=S(E.url);return E.fragmentIdentifier&&(C=`#${I[a]?d(E.fragmentIdentifier,I):E.fragmentIdentifier}`),`${_}${f}${C}`},t.pick=(E,I,_)=>{_=Object.assign({parseFragmentIdentifier:!0,[a]:!1},_);const{url:v,query:p,fragmentIdentifier:o}=t.parseUrl(E,_);return t.stringifyUrl({url:v,query:n(p,I),fragmentIdentifier:o},_)},t.exclude=(E,I,_)=>{const v=Array.isArray(I)?p=>!I.includes(p):(p,o)=>!I(p,o);return t.pick(E,v,_)}})(Nr);const xd={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe"}};function Po(t,e){return t.includes(":")?[t]:e.chains||[]}const Ro="base10",ct="base16",pn="base64pad",gn="utf8",Ao=0,Jt=1,Id=0,Co=1,yn=12,_n=32;function Td(){const t=ln.generateKeyPair();return{privateKey:at(t.secretKey,ct),publicKey:at(t.publicKey,ct)}}function bn(){const t=ar.randomBytes(_n);return at(t,ct)}function Nd(t,e){const r=ln.sharedKey(ft(t,ct),ft(e,ct),!0),i=new Yf(ai.SHA256,r).expand(_n);return at(i,ct)}function Pd(t){const e=ai.hash(ft(t,ct));return at(e,ct)}function ur(t){const e=ai.hash(ft(t,gn));return at(e,ct)}function Rd(t){return ft(`${t}`,Ro)}function Pr(t){return Number(at(t,Ro))}function Ad(t){const e=Rd(typeof t.type<"u"?t.type:Ao);if(Pr(e)===Jt&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?ft(t.senderPublicKey,ct):void 0,i=typeof t.iv<"u"?ft(t.iv,ct):ar.randomBytes(yn),n=new an.ChaCha20Poly1305(ft(t.symKey,ct)).seal(i,ft(t.message,gn));return Ld({type:e,sealed:n,iv:i,senderPublicKey:r})}function Cd(t){const e=new an.ChaCha20Poly1305(ft(t.symKey,ct)),{sealed:r,iv:i}=ci(t.encoded),n=e.open(i,r);if(n===null)throw new Error("Failed to decrypt");return at(n,gn)}function Ld(t){if(Pr(t.type)===Jt){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return at(rn([t.type,t.senderPublicKey,t.iv,t.sealed]),pn)}return at(rn([t.type,t.iv,t.sealed]),pn)}function ci(t){const e=ft(t,pn),r=e.slice(Id,Co),i=Co;if(Pr(r)===Jt){const c=i+_n,h=c+yn,l=e.slice(i,c),d=e.slice(c,h),w=e.slice(h);return{type:r,sealed:w,iv:d,senderPublicKey:l}}const n=i+yn,s=e.slice(i,n),a=e.slice(n);return{type:r,sealed:a,iv:s}}function Fd(t,e){const r=ci(t);return Lo({type:Pr(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?at(r.senderPublicKey,ct):void 0,receiverPublicKey:e?.receiverPublicKey})}function Lo(t){const e=t?.type||Ao;if(e===Jt){if(typeof t?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof t?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t?.senderPublicKey,receiverPublicKey:t?.receiverPublicKey}}function Fo(t){return t.type===Jt&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}var Ud=Object.defineProperty,Uo=Object.getOwnPropertySymbols,$d=Object.prototype.hasOwnProperty,Md=Object.prototype.propertyIsEnumerable,$o=(t,e,r)=>e in t?Ud(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Mo=(t,e)=>{for(var r in e||(e={}))$d.call(e,r)&&$o(t,r,e[r]);if(Uo)for(var r of Uo(e))Md.call(e,r)&&$o(t,r,e[r]);return t};const jd="ReactNative",yt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},qd="js";function wn(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Rr(){return!So()&&!!hn()&&navigator.product===jd}function Ar(){return!wn()&&!!hn()}function Cr(){return Rr()?yt.reactNative:wn()?yt.node:Ar()?yt.browser:yt.unknown}function Bd(t,e){let r=Nr.parse(t);return r=Mo(Mo({},r),e),t=Nr.stringify(r),t}function zd(){return Oo()||{name:"",description:"",url:"",icons:[""]}}function Hd(){if(Cr()===yt.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:i}=global.Platform;return[r,i].join("-")}const t=nd();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function Kd(){var t;const e=Cr();return e===yt.browser?[e,((t=Do())==null?void 0:t.host)||"unknown"].join(":"):e}function Vd(t,e,r){const i=Hd(),n=Kd();return[[t,e].join("-"),[qd,r].join("-"),i,n].join("/")}function Gd({protocol:t,version:e,relayUrl:r,sdkVersion:i,auth:n,projectId:s,useOnCloseEvent:a}){const c=r.split("?"),h=Vd(t,e,i),l={auth:n,ua:h,projectId:s,useOnCloseEvent:a||void 0},d=Bd(c[1]||"",l);return c[0]+"?"+d}function Qt(t,e){return t.filter(r=>e.includes(r)).length===t.length}function jo(t){return Object.fromEntries(t.entries())}function qo(t){return new Map(Object.entries(t))}function lr(t=Q.FIVE_MINUTES,e){const r=Q.toMiliseconds(t||Q.FIVE_MINUTES);let i,n,s;return{resolve:a=>{s&&i&&(clearTimeout(s),i(a))},reject:a=>{s&&n&&(clearTimeout(s),n(a))},done:()=>new Promise((a,c)=>{s=setTimeout(()=>{c(new Error(e))},r),i=a,n=c})}}function Lr(t,e,r){return new Promise(async(i,n)=>{const s=setTimeout(()=>n(new Error(r)),e);try{const a=await t;i(a)}catch(a){n(a)}clearTimeout(s)})}function Bo(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function kd(t){return Bo("topic",t)}function Wd(t){return Bo("id",t)}function zo(t){const[e,r]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function Et(t,e){return Q.fromMiliseconds((e||Date.now())+Q.toMiliseconds(t))}function Mt(t){return Date.now()>=Q.toMiliseconds(t)}function Ue(t,e){return`${t}${e?`:${e}`:""}`}async function Yd({id:t,topic:e,wcDeepLink:r}){try{if(!r)return;const i=typeof r=="string"?JSON.parse(r):r;let n=i?.href;if(typeof n!="string")return;n.endsWith("/")&&(n=n.slice(0,-1));const s=`${n}/wc?requestId=${t}&sessionTopic=${e}`,a=Cr();a===yt.browser?s.startsWith("https://")?window.open(s,"_blank","noreferrer noopener"):window.open(s,"_self","noreferrer noopener"):a===yt.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(s)}catch(i){console.error(i)}}const Xd="irn";function vn(t){return t?.relay||{protocol:Xd}}function ui(t){const e=xd[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var Jd=Object.defineProperty,Ho=Object.getOwnPropertySymbols,Qd=Object.prototype.hasOwnProperty,Zd=Object.prototype.propertyIsEnumerable,Ko=(t,e,r)=>e in t?Jd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ep=(t,e)=>{for(var r in e||(e={}))Qd.call(e,r)&&Ko(t,r,e[r]);if(Ho)for(var r of Ho(e))Zd.call(e,r)&&Ko(t,r,e[r]);return t};function tp(t,e="-"){const r={},i="relay"+e;return Object.keys(t).forEach(n=>{if(n.startsWith(i)){const s=n.replace(i,""),a=t[n];r[s]=a}}),r}function rp(t){const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,i=t.substring(0,e),n=t.substring(e+1,r).split("@"),s=typeof r<"u"?t.substring(r):"",a=Nr.parse(s);return{protocol:i,topic:ip(n[0]),version:parseInt(n[1],10),symKey:a.symKey,relay:tp(a)}}function ip(t){return t.startsWith("//")?t.substring(2):t}function np(t,e="-"){const r="relay",i={};return Object.keys(t).forEach(n=>{const s=r+e+n;t[n]&&(i[s]=t[n])}),i}function sp(t){return`${t.protocol}:${t.topic}@${t.version}?`+Nr.stringify(ep({symKey:t.symKey},np(t.relay)))}function hr(t){const e=[];return t.forEach(r=>{const[i,n]=r.split(":");e.push(`${i}:${n}`)}),e}function op(t){const e=[];return Object.values(t).forEach(r=>{e.push(...hr(r.accounts))}),e}function ap(t,e){const r=[];return Object.values(t).forEach(i=>{hr(i.accounts).includes(e)&&r.push(...i.methods)}),r}function cp(t,e){const r=[];return Object.values(t).forEach(i=>{hr(i.accounts).includes(e)&&r.push(...i.events)}),r}function up(t,e){const r=hi(t,e);if(r)throw new Error(r.message);const i={};for(const[n,s]of Object.entries(t))i[n]={methods:s.methods,events:s.events,chains:s.accounts.map(a=>`${a.split(":")[0]}:${a.split(":")[1]}`)};return i}const lp={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},hp={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function V(t,e){const{message:r,code:i}=hp[t];return{message:e?`${r} ${e}`:r,code:i}}function He(t,e){const{message:r,code:i}=lp[t];return{message:e?`${r} ${e}`:r,code:i}}function Fr(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function Ur(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function ut(t){return typeof t>"u"}function Ke(t,e){return e&&ut(t)?!0:typeof t=="string"&&!!t.trim().length}function mn(t,e){return e&&ut(t)?!0:typeof t=="number"&&!isNaN(t)}function fp(t,e){const{requiredNamespaces:r}=e,i=Object.keys(t.namespaces),n=Object.keys(r);let s=!0;return Qt(n,i)?(i.forEach(a=>{const{accounts:c,methods:h,events:l}=t.namespaces[a],d=hr(c),w=r[a];(!Qt(Po(a,w),d)||!Qt(w.methods,h)||!Qt(w.events,l))&&(s=!1)}),s):!1}function li(t){return Ke(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function dp(t){if(Ke(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&li(r)}}return!1}function pp(t){if(Ke(t,!1))try{return typeof new URL(t)<"u"}catch{return!1}return!1}function gp(t){var e;return(e=t?.proposer)==null?void 0:e.publicKey}function yp(t){return t?.topic}function _p(t,e){let r=null;return Ke(t?.publicKey,!1)||(r=V("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function Vo(t){let e=!0;return Fr(t)?t.length&&(e=t.every(r=>Ke(r,!1))):e=!1,e}function bp(t,e,r){let i=null;return Fr(e)&&e.length?e.forEach(n=>{i||li(n)||(i=He("UNSUPPORTED_CHAINS",`${r}, chain ${n} should be a string and conform to "namespace:chainId" format`))}):li(t)||(i=He("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}function wp(t,e,r){let i=null;return Object.entries(t).forEach(([n,s])=>{if(i)return;const a=bp(n,Po(n,s),`${e} ${r}`);a&&(i=a)}),i}function vp(t,e){let r=null;return Fr(t)?t.forEach(i=>{r||dp(i)||(r=He("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):r=He("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function mp(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const n=vp(i?.accounts,`${e} namespace`);n&&(r=n)}),r}function Ep(t,e){let r=null;return Vo(t?.methods)?Vo(t?.events)||(r=He("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=He("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function Go(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const n=Ep(i,`${e}, namespace`);n&&(r=n)}),r}function Sp(t,e,r){let i=null;if(t&&Ur(t)){const n=Go(t,e);n&&(i=n);const s=wp(t,e,r);s&&(i=s)}else i=V("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return i}function hi(t,e){let r=null;if(t&&Ur(t)){const i=Go(t,e);i&&(r=i);const n=mp(t,e);n&&(r=n)}else r=V("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function ko(t){return Ke(t.protocol,!0)}function Dp(t,e){let r=!1;return e&&!t?r=!0:t&&Fr(t)&&t.length&&t.forEach(i=>{r=ko(i)}),r}function Op(t){return typeof t=="number"}function dt(t){return typeof t<"u"&&typeof t!==null}function xp(t){return!(!t||typeof t!="object"||!t.code||!mn(t.code,!1)||!t.message||!Ke(t.message,!1))}function Ip(t){return!(ut(t)||!Ke(t.method,!1))}function Tp(t){return!(ut(t)||ut(t.result)&&ut(t.error)||!mn(t.id,!1)||!Ke(t.jsonrpc,!1))}function Np(t){return!(ut(t)||!Ke(t.name,!1))}function Wo(t,e){return!(!li(e)||!op(t).includes(e))}function Pp(t,e,r){return Ke(r,!1)?ap(t,e).includes(r):!1}function Rp(t,e,r){return Ke(r,!1)?cp(t,e).includes(r):!1}function Yo(t,e,r){let i=null;const n=Ap(t),s=Cp(e),a=Object.keys(n),c=Object.keys(s),h=Xo(Object.keys(t)),l=Xo(Object.keys(e)),d=h.filter(w=>!l.includes(w));return d.length&&(i=V("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${d.toString()}
      Received: ${Object.keys(e).toString()}`)),Qt(a,c)||(i=V("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${a.toString()}
      Approved: ${c.toString()}`)),Object.keys(e).forEach(w=>{if(!w.includes(":")||i)return;const y=hr(e[w].accounts);y.includes(w)||(i=V("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${w}
        Required: ${w}
        Approved: ${y.toString()}`))}),a.forEach(w=>{i||(Qt(n[w].methods,s[w].methods)?Qt(n[w].events,s[w].events)||(i=V("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${w}`)):i=V("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${w}`))}),i}function Ap(t){const e={};return Object.keys(t).forEach(r=>{var i;r.includes(":")?e[r]=t[r]:(i=t[r].chains)==null||i.forEach(n=>{e[n]={methods:t[r].methods,events:t[r].events}})}),e}function Xo(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function Cp(t){const e={};return Object.keys(t).forEach(r=>{if(r.includes(":"))e[r]=t[r];else{const i=hr(t[r].accounts);i?.forEach(n=>{e[n]={accounts:t[r].accounts.filter(s=>s.includes(`${n}:`)),methods:t[r].methods,events:t[r].events}})}}),e}function Lp(t,e){return mn(t,!1)&&t<=e.max&&t>=e.min}function Jo(){const t=Cr();return new Promise(e=>{switch(t){case yt.browser:e(Fp());break;case yt.reactNative:e(Up());break;case yt.node:e($p());break;default:e(!0)}})}function Fp(){return Ar()&&navigator?.onLine}async function Up(){if(Rr()&&typeof global<"u"&&global!=null&&global.NetInfo){const t=await(global==null?void 0:global.NetInfo.fetch());return t?.isConnected}return!0}function $p(){return!0}function Mp(t){switch(Cr()){case yt.browser:jp(t);break;case yt.reactNative:qp(t);break}}function jp(t){!Rr()&&Ar()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function qp(t){Rr()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(e=>t(e?.isConnected))}const En={};class fi{static get(e){return En[e]}static set(e,r){En[e]=r}static delete(e){delete En[e]}}const Bp="PARSE_ERROR",zp="INVALID_REQUEST",Hp="METHOD_NOT_FOUND",Kp="INVALID_PARAMS",Qo="INTERNAL_ERROR",Sn="SERVER_ERROR",Vp=[-32700,-32600,-32601,-32602,-32603],$r={[Bp]:{code:-32700,message:"Parse error"},[zp]:{code:-32600,message:"Invalid Request"},[Hp]:{code:-32601,message:"Method not found"},[Kp]:{code:-32602,message:"Invalid params"},[Qo]:{code:-32603,message:"Internal error"},[Sn]:{code:-32e3,message:"Server error"}},Zo=Sn;function Gp(t){return Vp.includes(t)}function ea(t){return Object.keys($r).includes(t)?$r[t]:$r[Zo]}function kp(t){const e=Object.values($r).find(r=>r.code===t);return e||$r[Zo]}function Wp(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var ta={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var Dn=function(t,e){return Dn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},Dn(t,e)};function Yp(t,e){Dn(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var On=function(){return On=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},On.apply(this,arguments)};function Xp(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function Jp(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(s=(n<3?a(s):n>3?a(e,r,s):a(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function Qp(t,e){return function(r,i){e(r,i,t)}}function Zp(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function eg(t,e,r,i){function n(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(d){try{l(i.next(d))}catch(w){a(w)}}function h(d){try{l(i.throw(d))}catch(w){a(w)}}function l(d){d.done?s(d.value):n(d.value).then(c,h)}l((i=i.apply(t,e||[])).next())})}function tg(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(l){return function(d){return h([l,d])}}function h(l){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=l[0]&2?n.return:l[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,l[1])).done)return s;switch(n=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,n=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(d){l=[6,d],n=0}finally{i=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function rg(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function ig(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function xn(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ra(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],a;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(c){a={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(a)throw a.error}}return s}function ng(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(ra(arguments[e]));return t}function sg(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],a=0,c=s.length;a<c;a++,n++)i[n]=s[a];return i}function Mr(t){return this instanceof Mr?(this.v=t,this):new Mr(t)}function og(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(y){i[y]&&(n[y]=function(m){return new Promise(function(S,R){s.push([y,m,S,R])>1||c(y,m)})})}function c(y,m){try{h(i[y](m))}catch(S){w(s[0][3],S)}}function h(y){y.value instanceof Mr?Promise.resolve(y.value.v).then(l,d):w(s[0][2],y)}function l(y){c("next",y)}function d(y){c("throw",y)}function w(y,m){y(m),s.shift(),s.length&&c(s[0][0],s[0][1])}}function ag(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(a){return(r=!r)?{value:Mr(t[n](a)),done:n==="return"}:s?s(a):a}:s}}function cg(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof xn=="function"?xn(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(a){return new Promise(function(c,h){a=t[s](a),n(c,h,a.done,a.value)})}}function n(s,a,c,h){Promise.resolve(h).then(function(l){s({value:l,done:c})},a)}}function ug(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function lg(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function hg(t){return t&&t.__esModule?t:{default:t}}function fg(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function dg(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var pg=Object.freeze({__proto__:null,__extends:Yp,get __assign(){return On},__rest:Xp,__decorate:Jp,__param:Qp,__metadata:Zp,__awaiter:eg,__generator:tg,__createBinding:rg,__exportStar:ig,__values:xn,__read:ra,__spread:ng,__spreadArrays:sg,__await:Mr,__asyncGenerator:og,__asyncDelegator:ag,__asyncValues:cg,__makeTemplateObject:ug,__importStar:lg,__importDefault:hg,__classPrivateFieldGet:fg,__classPrivateFieldSet:dg}),gg=Kt(pg),Rt={},ia;function yg(){if(ia)return Rt;ia=1,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.isBrowserCryptoAvailable=Rt.getSubtleCrypto=Rt.getBrowerCrypto=void 0;function t(){return Ze?.crypto||Ze?.msCrypto||{}}Rt.getBrowerCrypto=t;function e(){const i=t();return i.subtle||i.webkitSubtle}Rt.getSubtleCrypto=e;function r(){return!!t()&&!!e()}return Rt.isBrowserCryptoAvailable=r,Rt}var At={},na;function _g(){if(na)return At;na=1,Object.defineProperty(At,"__esModule",{value:!0}),At.isBrowser=At.isNode=At.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}At.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}At.isNode=e;function r(){return!t()&&!e()}return At.isBrowser=r,At}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=gg;e.__exportStar(yg(),t),e.__exportStar(_g(),t)})(ta);function In(t=3){const e=Date.now()*Math.pow(10,t),r=Math.floor(Math.random()*Math.pow(10,t));return e+r}function sa(t=6){return BigInt(In(t))}function fr(t,e,r){return{id:r||In(),jsonrpc:"2.0",method:t,params:e}}function Tn(t,e){return{id:t,jsonrpc:"2.0",result:e}}function Nn(t,e,r){return{id:t,jsonrpc:"2.0",error:bg(e,r)}}function bg(t,e){return typeof t>"u"?ea(Qo):(typeof t=="string"&&(t=Object.assign(Object.assign({},ea(Sn)),{message:t})),typeof e<"u"&&(t.data=e),Gp(t.code)&&(t=kp(t.code)),t)}class wg{}class vg extends wg{constructor(){super()}}class mg extends vg{constructor(e){super()}}const Eg="^wss?:";function Sg(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function Dg(t,e){const r=Sg(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function oa(t){return Dg(t,Eg)}function Og(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function aa(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function Pn(t){return aa(t)&&"method"in t}function di(t){return aa(t)&&(Ct(t)||St(t))}function Ct(t){return"result"in t}function St(t){return"error"in t}class xg extends mg{constructor(e){super(e),this.events=new ht.exports.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(fr(e.method,e.params||[],e.id||sa().toString()),r)}async requestStrict(e,r){return new Promise(async(i,n)=>{if(!this.connection.connected)try{await this.open()}catch(s){n(s)}this.events.on(`${e.id}`,s=>{St(s)?n(s.error):i(s.result)});try{await this.connection.send(e,r)}catch(s){n(s)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),di(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const Ig=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),Tg=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",ca=t=>t.split("?")[0],ua=10,Ng=Ig();class Pg{constructor(e){if(this.url=e,this.events=new ht.exports.EventEmitter,this.registering=!1,!oa(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=i=>{this.onClose(i),e()},this.socket.close()})}async send(e,r){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Yi(e))}catch(i){this.onError(e.id,i)}}register(e=this.url){if(!oa(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,n)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),n(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return n(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,i)=>{const n=ta.isReactNative()?void 0:{rejectUnauthorized:!Og(e)},s=new Ng(e,[],n);Tg()?s.onerror=a=>{const c=a;i(this.emitError(c.error))}:s.on("error",a=>{i(this.emitError(a))}),s.onopen=()=>{this.onOpen(s),r(s)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?Cs(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),n=i.message||i.toString(),s=Nn(e,n);this.events.emit("payload",s)}parseError(e,r=this.url){return Wp(e,ca(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>ua&&this.events.setMaxListeners(ua)}emitError(e){const r=this.parseError(new Error(e?.message||`WebSocket connection failed for host: ${ca(this.url)}`));return this.events.emit("register_error",r),r}}var Rn={exports:{}};(function(t,e){var r=200,i="__lodash_hash_undefined__",n=1,s=2,a=9007199254740991,c="[object Arguments]",h="[object Array]",l="[object AsyncFunction]",d="[object Boolean]",w="[object Date]",y="[object Error]",m="[object Function]",S="[object GeneratorFunction]",R="[object Map]",A="[object Number]",z="[object Null]",E="[object Object]",I="[object Promise]",_="[object Proxy]",v="[object RegExp]",p="[object Set]",o="[object String]",f="[object Symbol]",C="[object Undefined]",L="[object WeakMap]",H="[object ArrayBuffer]",G="[object DataView]",J="[object Float32Array]",x="[object Float64Array]",P="[object Int8Array]",k="[object Int16Array]",j="[object Int32Array]",U="[object Uint8Array]",M="[object Uint8ClampedArray]",F="[object Uint16Array]",q="[object Uint32Array]",te=/[\\^$.*+?()[\]{}|]/g,B=/^\[object .+?Constructor\]$/,Z=/^(?:0|[1-9]\d*)$/,Y={};Y[J]=Y[x]=Y[P]=Y[k]=Y[j]=Y[U]=Y[M]=Y[F]=Y[q]=!0,Y[c]=Y[h]=Y[H]=Y[d]=Y[G]=Y[w]=Y[y]=Y[m]=Y[R]=Y[A]=Y[E]=Y[v]=Y[p]=Y[o]=Y[L]=!1;var ee=typeof Ze=="object"&&Ze&&Ze.Object===Object&&Ze,N=typeof self=="object"&&self&&self.Object===Object&&self,T=ee||N||Function("return this")(),D=e&&!e.nodeType&&e,u=D&&!0&&t&&!t.nodeType&&t,b=u&&u.exports===D,K=b&&ee.process,W=function(){try{return K&&K.binding&&K.binding("util")}catch{}}(),he=W&&W.isTypedArray;function be(g,O){for(var $=-1,X=g==null?0:g.length,Te=0,se=[];++$<X;){var Le=g[$];O(Le,$,g)&&(se[Te++]=Le)}return se}function de(g,O){for(var $=-1,X=O.length,Te=g.length;++$<X;)g[Te+$]=O[$];return g}function me(g,O){for(var $=-1,X=g==null?0:g.length;++$<X;)if(O(g[$],$,g))return!0;return!1}function Fe(g,O){for(var $=-1,X=Array(g);++$<g;)X[$]=O($);return X}function Re(g){return function(O){return g(O)}}function ye(g,O){return g.has(O)}function pe(g,O){return g?.[O]}function fe(g){var O=-1,$=Array(g.size);return g.forEach(function(X,Te){$[++O]=[Te,X]}),$}function ue(g,O){return function($){return g(O($))}}function ce(g){var O=-1,$=Array(g.size);return g.forEach(function(X){$[++O]=X}),$}var ae=Array.prototype,oe=Function.prototype,re=Object.prototype,le=T["__core-js_shared__"],ge=oe.toString,ne=re.hasOwnProperty,we=function(){var g=/[^.]+$/.exec(le&&le.keys&&le.keys.IE_PROTO||"");return g?"Symbol(src)_1."+g:""}(),ve=re.toString,Se=RegExp("^"+ge.call(ne).replace(te,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),De=b?T.Buffer:void 0,Ee=T.Symbol,Ot=T.Uint8Array,Pt=re.propertyIsEnumerable,qt=ae.splice,_t=Ee?Ee.toStringTag:void 0,Zt=Object.getOwnPropertySymbols,Vr=De?De.isBuffer:void 0,mi=ue(Object.keys,Object),$e=pr(T,"DataView"),Ae=pr(T,"Map"),Me=pr(T,"Promise"),je=pr(T,"Set"),qe=pr(T,"WeakMap"),Ce=pr(Object,"create"),Ve=tr($e),Ge=tr(Ae),ke=tr(Me),We=tr(je),Ye=tr(qe),ze=Ee?Ee.prototype:void 0,Be=ze?ze.valueOf:void 0;function Ne(g){var O=-1,$=g==null?0:g.length;for(this.clear();++O<$;){var X=g[O];this.set(X[0],X[1])}}function Xe(){this.__data__=Ce?Ce(null):{},this.size=0}function Je(g){var O=this.has(g)&&delete this.__data__[g];return this.size-=O?1:0,O}function v_(g){var O=this.__data__;if(Ce){var $=O[g];return $===i?void 0:$}return ne.call(O,g)?O[g]:void 0}function m_(g){var O=this.__data__;return Ce?O[g]!==void 0:ne.call(O,g)}function E_(g,O){var $=this.__data__;return this.size+=this.has(g)?0:1,$[g]=Ce&&O===void 0?i:O,this}Ne.prototype.clear=Xe,Ne.prototype.delete=Je,Ne.prototype.get=v_,Ne.prototype.has=m_,Ne.prototype.set=E_;function Ft(g){var O=-1,$=g==null?0:g.length;for(this.clear();++O<$;){var X=g[O];this.set(X[0],X[1])}}function S_(){this.__data__=[],this.size=0}function D_(g){var O=this.__data__,$=Si(O,g);if($<0)return!1;var X=O.length-1;return $==X?O.pop():qt.call(O,$,1),--this.size,!0}function O_(g){var O=this.__data__,$=Si(O,g);return $<0?void 0:O[$][1]}function x_(g){return Si(this.__data__,g)>-1}function I_(g,O){var $=this.__data__,X=Si($,g);return X<0?(++this.size,$.push([g,O])):$[X][1]=O,this}Ft.prototype.clear=S_,Ft.prototype.delete=D_,Ft.prototype.get=O_,Ft.prototype.has=x_,Ft.prototype.set=I_;function er(g){var O=-1,$=g==null?0:g.length;for(this.clear();++O<$;){var X=g[O];this.set(X[0],X[1])}}function T_(){this.size=0,this.__data__={hash:new Ne,map:new(Ae||Ft),string:new Ne}}function N_(g){var O=Di(this,g).delete(g);return this.size-=O?1:0,O}function P_(g){return Di(this,g).get(g)}function R_(g){return Di(this,g).has(g)}function A_(g,O){var $=Di(this,g),X=$.size;return $.set(g,O),this.size+=$.size==X?0:1,this}er.prototype.clear=T_,er.prototype.delete=N_,er.prototype.get=P_,er.prototype.has=R_,er.prototype.set=A_;function Ei(g){var O=-1,$=g==null?0:g.length;for(this.__data__=new er;++O<$;)this.add(g[O])}function C_(g){return this.__data__.set(g,i),this}function L_(g){return this.__data__.has(g)}Ei.prototype.add=Ei.prototype.push=C_,Ei.prototype.has=L_;function Bt(g){var O=this.__data__=new Ft(g);this.size=O.size}function F_(){this.__data__=new Ft,this.size=0}function U_(g){var O=this.__data__,$=O.delete(g);return this.size=O.size,$}function $_(g){return this.__data__.get(g)}function M_(g){return this.__data__.has(g)}function j_(g,O){var $=this.__data__;if($ instanceof Ft){var X=$.__data__;if(!Ae||X.length<r-1)return X.push([g,O]),this.size=++$.size,this;$=this.__data__=new er(X)}return $.set(g,O),this.size=$.size,this}Bt.prototype.clear=F_,Bt.prototype.delete=U_,Bt.prototype.get=$_,Bt.prototype.has=M_,Bt.prototype.set=j_;function q_(g,O){var $=Oi(g),X=!$&&t1(g),Te=!$&&!X&&Hn(g),se=!$&&!X&&!Te&&ac(g),Le=$||X||Te||se,Qe=Le?Fe(g.length,String):[],rt=Qe.length;for(var Pe in g)(O||ne.call(g,Pe))&&!(Le&&(Pe=="length"||Te&&(Pe=="offset"||Pe=="parent")||se&&(Pe=="buffer"||Pe=="byteLength"||Pe=="byteOffset")||X_(Pe,rt)))&&Qe.push(Pe);return Qe}function Si(g,O){for(var $=g.length;$--;)if(ic(g[$][0],O))return $;return-1}function B_(g,O,$){var X=O(g);return Oi(g)?X:de(X,$(g))}function Gr(g){return g==null?g===void 0?C:z:_t&&_t in Object(g)?W_(g):e1(g)}function Za(g){return kr(g)&&Gr(g)==c}function ec(g,O,$,X,Te){return g===O?!0:g==null||O==null||!kr(g)&&!kr(O)?g!==g&&O!==O:z_(g,O,$,X,ec,Te)}function z_(g,O,$,X,Te,se){var Le=Oi(g),Qe=Oi(O),rt=Le?h:zt(g),Pe=Qe?h:zt(O);rt=rt==c?E:rt,Pe=Pe==c?E:Pe;var bt=rt==E,xt=Pe==E,st=rt==Pe;if(st&&Hn(g)){if(!Hn(O))return!1;Le=!0,bt=!1}if(st&&!bt)return se||(se=new Bt),Le||ac(g)?tc(g,O,$,X,Te,se):G_(g,O,rt,$,X,Te,se);if(!($&n)){var vt=bt&&ne.call(g,"__wrapped__"),mt=xt&&ne.call(O,"__wrapped__");if(vt||mt){var Ht=vt?g.value():g,Ut=mt?O.value():O;return se||(se=new Bt),Te(Ht,Ut,$,X,se)}}return st?(se||(se=new Bt),k_(g,O,$,X,Te,se)):!1}function H_(g){if(!oc(g)||Q_(g))return!1;var O=nc(g)?Se:B;return O.test(tr(g))}function K_(g){return kr(g)&&sc(g.length)&&!!Y[Gr(g)]}function V_(g){if(!Z_(g))return mi(g);var O=[];for(var $ in Object(g))ne.call(g,$)&&$!="constructor"&&O.push($);return O}function tc(g,O,$,X,Te,se){var Le=$&n,Qe=g.length,rt=O.length;if(Qe!=rt&&!(Le&&rt>Qe))return!1;var Pe=se.get(g);if(Pe&&se.get(O))return Pe==O;var bt=-1,xt=!0,st=$&s?new Ei:void 0;for(se.set(g,O),se.set(O,g);++bt<Qe;){var vt=g[bt],mt=O[bt];if(X)var Ht=Le?X(mt,vt,bt,O,g,se):X(vt,mt,bt,g,O,se);if(Ht!==void 0){if(Ht)continue;xt=!1;break}if(st){if(!me(O,function(Ut,rr){if(!ye(st,rr)&&(vt===Ut||Te(vt,Ut,$,X,se)))return st.push(rr)})){xt=!1;break}}else if(!(vt===mt||Te(vt,mt,$,X,se))){xt=!1;break}}return se.delete(g),se.delete(O),xt}function G_(g,O,$,X,Te,se,Le){switch($){case G:if(g.byteLength!=O.byteLength||g.byteOffset!=O.byteOffset)return!1;g=g.buffer,O=O.buffer;case H:return!(g.byteLength!=O.byteLength||!se(new Ot(g),new Ot(O)));case d:case w:case A:return ic(+g,+O);case y:return g.name==O.name&&g.message==O.message;case v:case o:return g==O+"";case R:var Qe=fe;case p:var rt=X&n;if(Qe||(Qe=ce),g.size!=O.size&&!rt)return!1;var Pe=Le.get(g);if(Pe)return Pe==O;X|=s,Le.set(g,O);var bt=tc(Qe(g),Qe(O),X,Te,se,Le);return Le.delete(g),bt;case f:if(Be)return Be.call(g)==Be.call(O)}return!1}function k_(g,O,$,X,Te,se){var Le=$&n,Qe=rc(g),rt=Qe.length,Pe=rc(O),bt=Pe.length;if(rt!=bt&&!Le)return!1;for(var xt=rt;xt--;){var st=Qe[xt];if(!(Le?st in O:ne.call(O,st)))return!1}var vt=se.get(g);if(vt&&se.get(O))return vt==O;var mt=!0;se.set(g,O),se.set(O,g);for(var Ht=Le;++xt<rt;){st=Qe[xt];var Ut=g[st],rr=O[st];if(X)var cc=Le?X(rr,Ut,st,O,g,se):X(Ut,rr,st,g,O,se);if(!(cc===void 0?Ut===rr||Te(Ut,rr,$,X,se):cc)){mt=!1;break}Ht||(Ht=st=="constructor")}if(mt&&!Ht){var xi=g.constructor,Ii=O.constructor;xi!=Ii&&"constructor"in g&&"constructor"in O&&!(typeof xi=="function"&&xi instanceof xi&&typeof Ii=="function"&&Ii instanceof Ii)&&(mt=!1)}return se.delete(g),se.delete(O),mt}function rc(g){return B_(g,n1,Y_)}function Di(g,O){var $=g.__data__;return J_(O)?$[typeof O=="string"?"string":"hash"]:$.map}function pr(g,O){var $=pe(g,O);return H_($)?$:void 0}function W_(g){var O=ne.call(g,_t),$=g[_t];try{g[_t]=void 0;var X=!0}catch{}var Te=ve.call(g);return X&&(O?g[_t]=$:delete g[_t]),Te}var Y_=Zt?function(g){return g==null?[]:(g=Object(g),be(Zt(g),function(O){return Pt.call(g,O)}))}:s1,zt=Gr;($e&&zt(new $e(new ArrayBuffer(1)))!=G||Ae&&zt(new Ae)!=R||Me&&zt(Me.resolve())!=I||je&&zt(new je)!=p||qe&&zt(new qe)!=L)&&(zt=function(g){var O=Gr(g),$=O==E?g.constructor:void 0,X=$?tr($):"";if(X)switch(X){case Ve:return G;case Ge:return R;case ke:return I;case We:return p;case Ye:return L}return O});function X_(g,O){return O=O??a,!!O&&(typeof g=="number"||Z.test(g))&&g>-1&&g%1==0&&g<O}function J_(g){var O=typeof g;return O=="string"||O=="number"||O=="symbol"||O=="boolean"?g!=="__proto__":g===null}function Q_(g){return!!we&&we in g}function Z_(g){var O=g&&g.constructor,$=typeof O=="function"&&O.prototype||re;return g===$}function e1(g){return ve.call(g)}function tr(g){if(g!=null){try{return ge.call(g)}catch{}try{return g+""}catch{}}return""}function ic(g,O){return g===O||g!==g&&O!==O}var t1=Za(function(){return arguments}())?Za:function(g){return kr(g)&&ne.call(g,"callee")&&!Pt.call(g,"callee")},Oi=Array.isArray;function r1(g){return g!=null&&sc(g.length)&&!nc(g)}var Hn=Vr||o1;function i1(g,O){return ec(g,O)}function nc(g){if(!oc(g))return!1;var O=Gr(g);return O==m||O==S||O==l||O==_}function sc(g){return typeof g=="number"&&g>-1&&g%1==0&&g<=a}function oc(g){var O=typeof g;return g!=null&&(O=="object"||O=="function")}function kr(g){return g!=null&&typeof g=="object"}var ac=he?Re(he):K_;function n1(g){return r1(g)?q_(g):V_(g)}function s1(){return[]}function o1(){return!1}t.exports=i1})(Rn,Rn.exports);var Rg=Rn.exports,Ag=Object.defineProperty,la=Object.getOwnPropertySymbols,Cg=Object.prototype.hasOwnProperty,Lg=Object.prototype.propertyIsEnumerable,ha=(t,e,r)=>e in t?Ag(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,lt=(t,e)=>{for(var r in e||(e={}))Cg.call(e,r)&&ha(t,r,e[r]);if(la)for(var r of la(e))Lg.call(e,r)&&ha(t,r,e[r]);return t};function Fg(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var s=t.charAt(n),a=s.charCodeAt(0);if(r[a]!==255)throw new TypeError(s+" is ambiguous");r[a]=n}var c=t.length,h=t.charAt(0),l=Math.log(c)/Math.log(256),d=Math.log(256)/Math.log(c);function w(S){if(S instanceof Uint8Array||(ArrayBuffer.isView(S)?S=new Uint8Array(S.buffer,S.byteOffset,S.byteLength):Array.isArray(S)&&(S=Uint8Array.from(S))),!(S instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(S.length===0)return"";for(var R=0,A=0,z=0,E=S.length;z!==E&&S[z]===0;)z++,R++;for(var I=(E-z)*d+1>>>0,_=new Uint8Array(I);z!==E;){for(var v=S[z],p=0,o=I-1;(v!==0||p<A)&&o!==-1;o--,p++)v+=256*_[o]>>>0,_[o]=v%c>>>0,v=v/c>>>0;if(v!==0)throw new Error("Non-zero carry");A=p,z++}for(var f=I-A;f!==I&&_[f]===0;)f++;for(var C=h.repeat(R);f<I;++f)C+=t.charAt(_[f]);return C}function y(S){if(typeof S!="string")throw new TypeError("Expected String");if(S.length===0)return new Uint8Array;var R=0;if(S[R]!==" "){for(var A=0,z=0;S[R]===h;)A++,R++;for(var E=(S.length-R)*l+1>>>0,I=new Uint8Array(E);S[R];){var _=r[S.charCodeAt(R)];if(_===255)return;for(var v=0,p=E-1;(_!==0||v<z)&&p!==-1;p--,v++)_+=c*I[p]>>>0,I[p]=_%256>>>0,_=_/256>>>0;if(_!==0)throw new Error("Non-zero carry");z=v,R++}if(S[R]!==" "){for(var o=E-z;o!==E&&I[o]===0;)o++;for(var f=new Uint8Array(A+(E-o)),C=A;o!==E;)f[C++]=I[o++];return f}}}function m(S){var R=y(S);if(R)return R;throw new Error(`Non-${e} character`)}return{encode:w,decodeUnsafe:y,decode:m}}var Ug=Fg,$g=Ug;const fa=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Mg=t=>new TextEncoder().encode(t),jg=t=>new TextDecoder().decode(t);class qg{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Bg{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return da(this,e)}}class zg{constructor(e){this.decoders=e}or(e){return da(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const da=(t,e)=>new zg(lt(lt({},t.decoders||{[t.prefix]:t}),e.decoders||{[e.prefix]:e}));class Hg{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new qg(e,r,i),this.decoder=new Bg(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const pi=({name:t,prefix:e,encode:r,decode:i})=>new Hg(t,e,r,i),jr=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=$g(r,e);return pi({prefix:t,name:e,encode:i,decode:s=>fa(n(s))})},Kg=(t,e,r,i)=>{const n={};for(let d=0;d<e.length;++d)n[e[d]]=d;let s=t.length;for(;t[s-1]==="=";)--s;const a=new Uint8Array(s*r/8|0);let c=0,h=0,l=0;for(let d=0;d<s;++d){const w=n[t[d]];if(w===void 0)throw new SyntaxError(`Non-${i} character`);h=h<<r|w,c+=r,c>=8&&(c-=8,a[l++]=255&h>>c)}if(c>=r||255&h<<8-c)throw new SyntaxError("Unexpected end of data");return a},Vg=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let s="",a=0,c=0;for(let h=0;h<t.length;++h)for(c=c<<8|t[h],a+=8;a>r;)a-=r,s+=e[n&c>>a];if(a&&(s+=e[n&c<<r-a]),i)for(;s.length*r&7;)s+="=";return s},tt=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>pi({prefix:e,name:t,encode(n){return Vg(n,i,r)},decode(n){return Kg(n,i,r,t)}}),Gg=pi({prefix:"\0",name:"identity",encode:t=>jg(t),decode:t=>Mg(t)});var kg=Object.freeze({__proto__:null,identity:Gg});const Wg=tt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Yg=Object.freeze({__proto__:null,base2:Wg});const Xg=tt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Jg=Object.freeze({__proto__:null,base8:Xg});const Qg=jr({prefix:"9",name:"base10",alphabet:"0123456789"});var Zg=Object.freeze({__proto__:null,base10:Qg});const ey=tt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),ty=tt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var ry=Object.freeze({__proto__:null,base16:ey,base16upper:ty});const iy=tt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),ny=tt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),sy=tt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),oy=tt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ay=tt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),cy=tt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),uy=tt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),ly=tt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),hy=tt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var fy=Object.freeze({__proto__:null,base32:iy,base32upper:ny,base32pad:sy,base32padupper:oy,base32hex:ay,base32hexupper:cy,base32hexpad:uy,base32hexpadupper:ly,base32z:hy});const dy=jr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),py=jr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var gy=Object.freeze({__proto__:null,base36:dy,base36upper:py});const yy=jr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),_y=jr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var by=Object.freeze({__proto__:null,base58btc:yy,base58flickr:_y});const wy=tt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),vy=tt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),my=tt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Ey=tt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Sy=Object.freeze({__proto__:null,base64:wy,base64pad:vy,base64url:my,base64urlpad:Ey});const pa=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Dy=pa.reduce((t,e,r)=>(t[r]=e,t),[]),Oy=pa.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function xy(t){return t.reduce((e,r)=>(e+=Dy[r],e),"")}function Iy(t){const e=[];for(const r of t){const i=Oy[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const Ty=pi({prefix:"\u{1F680}",name:"base256emoji",encode:xy,decode:Iy});var Ny=Object.freeze({__proto__:null,base256emoji:Ty}),Py=ya,ga=128,Ry=127,Ay=~Ry,Cy=Math.pow(2,31);function ya(t,e,r){e=e||[],r=r||0;for(var i=r;t>=Cy;)e[r++]=t&255|ga,t/=128;for(;t&Ay;)e[r++]=t&255|ga,t>>>=7;return e[r]=t|0,ya.bytes=r-i+1,e}var Ly=An,Fy=128,_a=127;function An(t,i){var r=0,i=i||0,n=0,s=i,a,c=t.length;do{if(s>=c)throw An.bytes=0,new RangeError("Could not decode varint");a=t[s++],r+=n<28?(a&_a)<<n:(a&_a)*Math.pow(2,n),n+=7}while(a>=Fy);return An.bytes=s-i,r}var Uy=Math.pow(2,7),$y=Math.pow(2,14),My=Math.pow(2,21),jy=Math.pow(2,28),qy=Math.pow(2,35),By=Math.pow(2,42),zy=Math.pow(2,49),Hy=Math.pow(2,56),Ky=Math.pow(2,63),Vy=function(t){return t<Uy?1:t<$y?2:t<My?3:t<jy?4:t<qy?5:t<By?6:t<zy?7:t<Hy?8:t<Ky?9:10},Gy={encode:Py,decode:Ly,encodingLength:Vy},ba=Gy;const wa=(t,e,r=0)=>(ba.encode(t,e,r),e),va=t=>ba.encodingLength(t),Cn=(t,e)=>{const r=e.byteLength,i=va(t),n=i+va(r),s=new Uint8Array(n+r);return wa(t,s,0),wa(r,s,i),s.set(e,n),new ky(t,r,e,s)};class ky{constructor(e,r,i,n){this.code=e,this.size=r,this.digest=i,this.bytes=n}}const ma=({name:t,code:e,encode:r})=>new Wy(t,e,r);class Wy{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Cn(this.code,r):r.then(i=>Cn(this.code,i))}else throw Error("Unknown type, must be binary type")}}const Ea=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Yy=ma({name:"sha2-256",code:18,encode:Ea("SHA-256")}),Xy=ma({name:"sha2-512",code:19,encode:Ea("SHA-512")});var Jy=Object.freeze({__proto__:null,sha256:Yy,sha512:Xy});const Sa=0,Qy="identity",Da=fa;var Zy=Object.freeze({__proto__:null,identity:{code:Sa,name:Qy,encode:Da,digest:t=>Cn(Sa,Da(t))}});new TextEncoder,new TextDecoder;const Oa=lt(lt(lt(lt(lt(lt(lt(lt(lt(lt({},kg),Yg),Jg),Zg),ry),fy),gy),by),Sy),Ny);lt(lt({},Jy),Zy);function xa(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function e0(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?xa(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Ia(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const Ta=Ia("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Ln=Ia("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=e0(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),t0=lt({utf8:Ta,"utf-8":Ta,hex:Oa.base16,latin1:Ln,ascii:Ln,binary:Ln},Oa);function r0(t,e="utf8"){const r=t0[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?xa(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}const Na="wc",i0=2,Fn="core",jt=`${Na}@2:${Fn}:`,n0={name:Fn,logger:"error"},s0={database:":memory:"},o0="crypto",Pa="client_ed25519_seed",a0=Q.ONE_DAY,c0="keychain",u0="0.3",l0="messages",h0="0.3",f0=Q.SIX_HOURS,d0="publisher",Ra="irn",p0="error",Aa="wss://relay.walletconnect.com",Ca="wss://relay.walletconnect.org",g0="relayer",nt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},y0="_subscription",Lt={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},_0=Q.ONE_SECOND,b0="2.10.2",w0=1e4,v0="0.3",m0="WALLETCONNECT_CLIENT_ID",Dt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},E0="subscription",S0="0.3",D0=Q.FIVE_SECONDS*1e3,O0="pairing",x0="0.3",qr={wc_pairingDelete:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:Q.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:Q.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:Q.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:0},res:{ttl:Q.ONE_DAY,prompt:!1,tag:0}}},Br={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Tt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},I0="history",T0="0.3",N0="expirer",wt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},P0="0.3",Un="verify-api",gi="https://verify.walletconnect.com",La="https://verify.walletconnect.org";class R0{constructor(e,r){this.core=e,this.logger=r,this.keychain=new Map,this.name=c0,this.version=u0,this.initialized=!1,this.storagePrefix=jt,this.init=async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}},this.has=i=>(this.isInitialized(),this.keychain.has(i)),this.set=async(i,n)=>{this.isInitialized(),this.keychain.set(i,n),await this.persist()},this.get=i=>{this.isInitialized();const n=this.keychain.get(i);if(typeof n>"u"){const{message:s}=V("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(s)}return n},this.del=async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()},this.core=e,this.logger=_e.generateChildLogger(r,this.name)}get context(){return _e.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,jo(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?qo(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class A0{constructor(e,r,i){this.core=e,this.logger=r,this.name=o0,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=n=>(this.isInitialized(),this.keychain.has(n)),this.getClientId=async()=>{this.isInitialized();const n=await this.getClientSeed(),s=lo(n);return uo(s.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const n=Td();return this.setPrivateKey(n.publicKey,n.privateKey)},this.signJWT=async n=>{this.isInitialized();const s=await this.getClientSeed(),a=lo(s),c=bn();return await Uf(c,n,a0,a)},this.generateSharedKey=(n,s,a)=>{this.isInitialized();const c=this.getPrivateKey(n),h=Nd(c,s);return this.setSymKey(h,a)},this.setSymKey=async(n,s)=>{this.isInitialized();const a=s||Pd(n);return await this.keychain.set(a,n),a},this.deleteKeyPair=async n=>{this.isInitialized(),await this.keychain.del(n)},this.deleteSymKey=async n=>{this.isInitialized(),await this.keychain.del(n)},this.encode=async(n,s,a)=>{this.isInitialized();const c=Lo(a),h=Yi(s);if(Fo(c)){const y=c.senderPublicKey,m=c.receiverPublicKey;n=await this.generateSharedKey(y,m)}const l=this.getSymKey(n),{type:d,senderPublicKey:w}=c;return Ad({type:d,symKey:l,message:h,senderPublicKey:w})},this.decode=async(n,s,a)=>{this.isInitialized();const c=Fd(s,a);if(Fo(c)){const h=c.receiverPublicKey,l=c.senderPublicKey;n=await this.generateSharedKey(h,l)}try{const h=this.getSymKey(n),l=Cd({symKey:h,encoded:s});return Cs(l)}catch(h){this.logger.error(`Failed to decode message from topic: '${n}', clientId: '${await this.getClientId()}'`),this.logger.error(h)}},this.getPayloadType=n=>{const s=ci(n);return Pr(s.type)},this.getPayloadSenderPublicKey=n=>{const s=ci(n);return s.senderPublicKey?at(s.senderPublicKey,ct):void 0},this.core=e,this.logger=_e.generateChildLogger(r,this.name),this.keychain=i||new R0(this.core,this.logger)}get context(){return _e.getLoggerContext(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Pa)}catch{e=bn(),await this.keychain.set(Pa,e)}return r0(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class C0 extends gl{constructor(e,r){super(e,r),this.logger=e,this.core=r,this.messages=new Map,this.name=l0,this.version=h0,this.initialized=!1,this.storagePrefix=jt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}},this.set=async(i,n)=>{this.isInitialized();const s=ur(n);let a=this.messages.get(i);return typeof a>"u"&&(a={}),typeof a[s]<"u"||(a[s]=n,this.messages.set(i,a),await this.persist()),s},this.get=i=>{this.isInitialized();let n=this.messages.get(i);return typeof n>"u"&&(n={}),n},this.has=(i,n)=>{this.isInitialized();const s=this.get(i),a=ur(n);return typeof s[a]<"u"},this.del=async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()},this.logger=_e.generateChildLogger(e,this.name),this.core=r}get context(){return _e.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,jo(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?qo(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class L0 extends yl{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.events=new ht.exports.EventEmitter,this.name=d0,this.queue=new Map,this.publishTimeout=Q.toMiliseconds(Q.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(i,n,s)=>{var a;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:n,opts:s}});try{const c=s?.ttl||f0,h=vn(s),l=s?.prompt||!1,d=s?.tag||0,w=s?.id||sa().toString(),y={topic:i,message:n,opts:{ttl:c,relay:h,prompt:l,tag:d,id:w}},m=setTimeout(()=>this.queue.set(w,y),this.publishTimeout);try{await await Lr(this.rpcPublish(i,n,c,h,l,d,w),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(w),this.relayer.events.emit(nt.publish,y)}catch(S){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(a=s?.internal)!=null&&a.throwOnFailedPublish)throw this.removeRequestFromQueue(w),S;return}finally{clearTimeout(m)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:n,opts:s}})}catch(c){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(c),c}},this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.relayer=e,this.logger=_e.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return _e.getLoggerContext(this.logger)}rpcPublish(e,r,i,n,s,a,c){var h,l,d,w;const y={method:ui(n.protocol).publish,params:{topic:e,message:r,ttl:i,prompt:s,tag:a},id:c};return ut((h=y.params)==null?void 0:h.prompt)&&((l=y.params)==null||delete l.prompt),ut((d=y.params)==null?void 0:d.tag)&&((w=y.params)==null||delete w.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:y}),this.relayer.request(y)}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:r,message:i,opts:n}=e;await this.publish(r,i,n)})}registerEventListeners(){this.relayer.core.heartbeat.on(sr.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(nt.connection_stalled);return}this.checkQueue()}),this.relayer.on(nt.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}class F0{constructor(){this.map=new Map,this.set=(e,r)=>{const i=this.get(e);this.exists(e,r)||this.map.set(e,[...i,r])},this.get=e=>this.map.get(e)||[],this.exists=(e,r)=>this.get(e).includes(r),this.delete=(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,r))return;const n=i.filter(s=>s!==r);if(!n.length){this.map.delete(e);return}this.map.set(e,n)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var U0=Object.defineProperty,$0=Object.defineProperties,M0=Object.getOwnPropertyDescriptors,Fa=Object.getOwnPropertySymbols,j0=Object.prototype.hasOwnProperty,q0=Object.prototype.propertyIsEnumerable,Ua=(t,e,r)=>e in t?U0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,zr=(t,e)=>{for(var r in e||(e={}))j0.call(e,r)&&Ua(t,r,e[r]);if(Fa)for(var r of Fa(e))q0.call(e,r)&&Ua(t,r,e[r]);return t},$n=(t,e)=>$0(t,M0(e));class B0 extends wl{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.subscriptions=new Map,this.topicMap=new F0,this.events=new ht.exports.EventEmitter,this.name=E0,this.version=S0,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=jt,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(i,n)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}});try{const s=vn(n),a={topic:i,relay:s};this.pending.set(i,a);const c=await this.rpcSubscribe(i,s);return this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}}),c}catch(s){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(s),s}},this.unsubscribe=async(i,n)=>{await this.restartToComplete(),this.isInitialized(),typeof n?.id<"u"?await this.unsubscribeById(i,n.id,n):await this.unsubscribeByTopic(i,n)},this.isSubscribed=async i=>this.topics.includes(i)?!0:await new Promise((n,s)=>{const a=new Q.Watch;a.start(this.pendingSubscriptionWatchLabel);const c=setInterval(()=>{!this.pending.has(i)&&this.topics.includes(i)&&(clearInterval(c),a.stop(this.pendingSubscriptionWatchLabel),n(!0)),a.elapsed(this.pendingSubscriptionWatchLabel)>=D0&&(clearInterval(c),a.stop(this.pendingSubscriptionWatchLabel),s(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=e,this.logger=_e.generateChildLogger(r,this.name),this.clientId=""}get context(){return _e.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,r){let i=!1;try{i=this.getSubscription(e).topic===r}catch{}return i}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const i=this.topicMap.get(e);await Promise.all(i.map(async n=>await this.unsubscribeById(e,n,r)))}async unsubscribeById(e,r,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}});try{const n=vn(i);await this.rpcUnsubscribe(e,r,n);const s=He("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}})}catch(n){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(n),n}}async rpcSubscribe(e,r){const i={method:ui(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await Lr(this.relayer.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(nt.connection_stalled)}return ur(e+this.clientId)}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,i={method:ui(r.protocol).batchSubscribe,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{return await await Lr(this.relayer.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(nt.connection_stalled)}}rpcUnsubscribe(e,r,i){const n={method:ui(i.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),this.relayer.request(n)}onSubscribe(e,r){this.setSubscription(e,$n(zr({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,zr({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,i){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r))}addSubscription(e,r){this.subscriptions.set(e,zr({},r)),this.topicMap.set(r.topic,e),this.events.emit(Dt.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:i}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(Dt.deleted,$n(zr({},i),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Dt.sync)}async reset(){if(this.cached.length){const e=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<e;r++){const i=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit(Dt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:r}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){if(!e.length)return;const r=await this.rpcBatchSubscribe(e);Fr(r)&&this.onBatchSubscribe(r.map((i,n)=>$n(zr({},e[n]),{id:i})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const e=[];this.pending.forEach(r=>{e.push(r)}),await this.batchSubscribe(e)}registerEventListeners(){this.relayer.core.heartbeat.on(sr.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(nt.connect,async()=>{await this.onConnect()}),this.relayer.on(nt.disconnect,()=>{this.onDisconnect()}),this.events.on(Dt.created,async e=>{const r=Dt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()}),this.events.on(Dt.deleted,async e=>{const r=Dt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(){this.restartInProgress&&await new Promise(e=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),e())},this.pollingInterval)})}}var z0=Object.defineProperty,$a=Object.getOwnPropertySymbols,H0=Object.prototype.hasOwnProperty,K0=Object.prototype.propertyIsEnumerable,Ma=(t,e,r)=>e in t?z0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,V0=(t,e)=>{for(var r in e||(e={}))H0.call(e,r)&&Ma(t,r,e[r]);if($a)for(var r of $a(e))K0.call(e,r)&&Ma(t,r,e[r]);return t};class G0 extends _l{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new ht.exports.EventEmitter,this.name=g0,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(i){throw this.logger.debug("Failed to Publish Request"),this.logger.error(i),i}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(nt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(nt.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(Lt.payload,this.onPayloadHandler),this.provider.on(Lt.connect,this.onConnectHandler),this.provider.on(Lt.disconnect,this.onDisconnectHandler),this.provider.on(Lt.error,this.onProviderErrorHandler)},this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?_e.generateChildLogger(e.logger,this.name):_e.pino(_e.getDefaultLoggerOptions({level:e.logger||p0})),this.messages=new C0(this.logger,e.core),this.subscriber=new B0(this,this.logger),this.publisher=new L0(this,this.logger),this.relayUrl=e?.relayUrl||Aa,this.projectId=e.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${Ca}...`),await this.restartTransport(Ca)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},w0)}get context(){return _e.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,r,i){this.isInitialized(),await this.publisher.publish(e,r,i),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now()})}async subscribe(e,r){var i;this.isInitialized();let n=((i=this.subscriber.topicMap.get(e))==null?void 0:i[0])||"";if(n)return n;let s;const a=c=>{c.topic===e&&(this.subscriber.off(Dt.created,a),s())};return await Promise.all([new Promise(c=>{s=c,this.subscriber.on(Dt.created,a)}),new Promise(async c=>{n=await this.subscriber.subscribe(e,r),c()})]),n}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await Lr(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(e){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(Dt.resubscribed,()=>{r()})}),new Promise(async(r,i)=>{try{await Lr(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(n){i(n);return}r()})])}catch(r){this.logger.error(r);const i=r;if(!this.isConnectionStalled(i.message))throw r;this.provider.events.emit(Lt.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(e){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Jo())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(e){return this.staleConnectionErrors.some(r=>e.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new xg(new Pg(Gd({sdkVersion:b0,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0}))),this.registerProviderListeners()}async recordMessageEvent(e){const{topic:r,message:i}=e;await this.messages.set(r,i)}async shouldIgnoreMessageEvent(e){const{topic:r,message:i}=e;if(!i||i.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const n=this.messages.has(r,i);return n&&this.logger.debug(`Ignoring duplicate message: ${i}`),n}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Pn(e)){if(!e.method.endsWith(y0))return;const r=e.params,{topic:i,message:n,publishedAt:s}=r.data,a={topic:i,message:n,publishedAt:s};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(V0({type:"event",event:r.id},a)),this.events.emit(r.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else di(e)&&this.events.emit(nt.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(nt.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const r=Tn(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(Lt.payload,this.onPayloadHandler),this.provider.off(Lt.connect,this.onConnectHandler),this.provider.off(Lt.disconnect,this.onDisconnectHandler),this.provider.off(Lt.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(nt.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let e=await Jo();Mp(async r=>{this.initialized&&e!==r&&(e=r,r?await this.restartTransport().catch(i=>this.logger.error(i)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(i=>this.logger.error(i))))})}onProviderDisconnect(){this.events.emit(nt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(e=>this.logger.error(e))},Q.toMiliseconds(_0)))}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(e=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),e())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var k0=Object.defineProperty,ja=Object.getOwnPropertySymbols,W0=Object.prototype.hasOwnProperty,Y0=Object.prototype.propertyIsEnumerable,qa=(t,e,r)=>e in t?k0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ba=(t,e)=>{for(var r in e||(e={}))W0.call(e,r)&&qa(t,r,e[r]);if(ja)for(var r of ja(e))Y0.call(e,r)&&qa(t,r,e[r]);return t};class yi extends bl{constructor(e,r,i,n=jt,s=void 0){super(e,r,i,n),this.core=e,this.logger=r,this.name=i,this.map=new Map,this.version=v0,this.cached=[],this.initialized=!1,this.storagePrefix=jt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>{this.getKey&&a!==null&&!ut(a)?this.map.set(this.getKey(a),a):gp(a)?this.map.set(a.id,a):yp(a)&&this.map.set(a.topic,a)}),this.cached=[],this.initialized=!0)},this.set=async(a,c)=>{this.isInitialized(),this.map.has(a)?await this.update(a,c):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:a,value:c}),this.map.set(a,c),await this.persist())},this.get=a=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:a}),this.getData(a)),this.getAll=a=>(this.isInitialized(),a?this.values.filter(c=>Object.keys(a).every(h=>Rg(c[h],a[h]))):this.values),this.update=async(a,c)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:a,update:c});const h=Ba(Ba({},this.getData(a)),c);this.map.set(a,h),await this.persist()},this.delete=async(a,c)=>{this.isInitialized(),this.map.has(a)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:a,reason:c}),this.map.delete(a),await this.persist())},this.logger=_e.generateChildLogger(r,this.name),this.storagePrefix=n,this.getKey=s}get context(){return _e.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){const{message:i}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class X0{constructor(e,r){this.core=e,this.logger=r,this.name=O0,this.version=x0,this.events=new ht.exports,this.initialized=!1,this.storagePrefix=jt,this.ignoredPayloadTypes=[Jt],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]},this.create=async()=>{this.isInitialized();const i=bn(),n=await this.core.crypto.setSymKey(i),s=Et(Q.FIVE_MINUTES),a={protocol:Ra},c={topic:n,expiry:s,relay:a,active:!1},h=sp({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:i,relay:a});return await this.pairings.set(n,c),await this.core.relayer.subscribe(n),this.core.expirer.set(n,s),{topic:n,uri:h}},this.pair=async i=>{this.isInitialized(),this.isValidPair(i);const{topic:n,symKey:s,relay:a}=rp(i.uri);let c;if(this.pairings.keys.includes(n)&&(c=this.pairings.get(n),c.active))throw new Error(`Pairing already exists: ${n}. Please try again with a new connection URI.`);this.core.crypto.keychain.has(n)||(await this.core.crypto.setSymKey(s,n),await this.core.relayer.subscribe(n,{relay:a}));const h=Et(Q.FIVE_MINUTES),l={topic:n,relay:a,expiry:h,active:!1};return await this.pairings.set(n,l),this.core.expirer.set(n,h),i.activatePairing&&await this.activate({topic:n}),this.events.emit(Br.create,l),l},this.activate=async({topic:i})=>{this.isInitialized();const n=Et(Q.THIRTY_DAYS);await this.pairings.update(i,{active:!0,expiry:n}),this.core.expirer.set(i,n)},this.ping=async i=>{this.isInitialized(),await this.isValidPing(i);const{topic:n}=i;if(this.pairings.keys.includes(n)){const s=await this.sendRequest(n,"wc_pairingPing",{}),{done:a,resolve:c,reject:h}=lr();this.events.once(Ue("pairing_ping",s),({error:l})=>{l?h(l):c()}),await a()}},this.updateExpiry=async({topic:i,expiry:n})=>{this.isInitialized(),await this.pairings.update(i,{expiry:n})},this.updateMetadata=async({topic:i,metadata:n})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:n})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:n}=i;this.pairings.keys.includes(n)&&(await this.sendRequest(n,"wc_pairingDelete",He("USER_DISCONNECTED")),await this.deletePairing(n))},this.sendRequest=async(i,n,s)=>{const a=fr(n,s),c=await this.core.crypto.encode(i,a),h=qr[n].req;return this.core.history.set(i,a),this.core.relayer.publish(i,c,h),a.id},this.sendResult=async(i,n,s)=>{const a=Tn(i,s),c=await this.core.crypto.encode(n,a),h=await this.core.history.get(n,i),l=qr[h.request.method].res;await this.core.relayer.publish(n,c,l),await this.core.history.resolve(a)},this.sendError=async(i,n,s)=>{const a=Nn(i,s),c=await this.core.crypto.encode(n,a),h=await this.core.history.get(n,i),l=qr[h.request.method]?qr[h.request.method].res:qr.unregistered_method.res;await this.core.relayer.publish(n,c,l),await this.core.history.resolve(a)},this.deletePairing=async(i,n)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,He("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),n?Promise.resolve():this.core.expirer.del(i)])},this.cleanup=async()=>{const i=this.pairings.getAll().filter(n=>Mt(n.expiry));await Promise.all(i.map(n=>this.deletePairing(n.topic)))},this.onRelayEventRequest=i=>{const{topic:n,payload:s}=i;switch(s.method){case"wc_pairingPing":return this.onPairingPingRequest(n,s);case"wc_pairingDelete":return this.onPairingDeleteRequest(n,s);default:return this.onUnknownRpcMethodRequest(n,s)}},this.onRelayEventResponse=async i=>{const{topic:n,payload:s}=i,a=(await this.core.history.get(n,s.id)).request.method;switch(a){case"wc_pairingPing":return this.onPairingPingResponse(n,s);default:return this.onUnknownRpcMethodResponse(a)}},this.onPairingPingRequest=async(i,n)=>{const{id:s}=n;try{this.isValidPing({topic:i}),await this.sendResult(s,i,!0),this.events.emit(Br.ping,{id:s,topic:i})}catch(a){await this.sendError(s,i,a),this.logger.error(a)}},this.onPairingPingResponse=(i,n)=>{const{id:s}=n;setTimeout(()=>{Ct(n)?this.events.emit(Ue("pairing_ping",s),{}):St(n)&&this.events.emit(Ue("pairing_ping",s),{error:n.error})},500)},this.onPairingDeleteRequest=async(i,n)=>{const{id:s}=n;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit(Br.delete,{id:s,topic:i})}catch(a){await this.sendError(s,i,a),this.logger.error(a)}},this.onUnknownRpcMethodRequest=async(i,n)=>{const{id:s,method:a}=n;try{if(this.registeredMethods.includes(a))return;const c=He("WC_METHOD_UNSUPPORTED",a);await this.sendError(s,i,c),this.logger.error(c)}catch(c){await this.sendError(s,i,c),this.logger.error(c)}},this.onUnknownRpcMethodResponse=i=>{this.registeredMethods.includes(i)||this.logger.error(He("WC_METHOD_UNSUPPORTED",i))},this.isValidPair=i=>{if(!dt(i)){const{message:n}=V("MISSING_OR_INVALID",`pair() params: ${i}`);throw new Error(n)}if(!pp(i.uri)){const{message:n}=V("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw new Error(n)}},this.isValidPing=async i=>{if(!dt(i)){const{message:s}=V("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(s)}const{topic:n}=i;await this.isValidPairingTopic(n)},this.isValidDisconnect=async i=>{if(!dt(i)){const{message:s}=V("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(s)}const{topic:n}=i;await this.isValidPairingTopic(n)},this.isValidPairingTopic=async i=>{if(!Ke(i,!1)){const{message:n}=V("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(n)}if(!this.pairings.keys.includes(i)){const{message:n}=V("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(n)}if(Mt(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:n}=V("EXPIRED",`pairing topic: ${i}`);throw new Error(n)}},this.core=e,this.logger=_e.generateChildLogger(r,this.name),this.pairings=new yi(this.core,this.logger,this.name,this.storagePrefix)}get context(){return _e.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(nt.message,async e=>{const{topic:r,message:i}=e;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const n=await this.core.crypto.decode(r,i);try{Pn(n)?(this.core.history.set(r,n),this.onRelayEventRequest({topic:r,payload:n})):di(n)&&(await this.core.history.resolve(n),await this.onRelayEventResponse({topic:r,payload:n}),this.core.history.delete(r,n.id))}catch(s){this.logger.error(s)}})}registerExpirerEvents(){this.core.expirer.on(wt.expired,async e=>{const{topic:r}=zo(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Br.expire,{topic:r}))})}}class J0 extends pl{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.records=new Map,this.events=new ht.exports.EventEmitter,this.name=I0,this.version=T0,this.cached=[],this.initialized=!1,this.storagePrefix=jt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(i,n,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:n,chainId:s}),this.records.has(n.id))return;const a={id:n.id,topic:i,request:{method:n.method,params:n.params||null},chainId:s,expiry:Et(Q.THIRTY_DAYS)};this.records.set(a.id,a),this.events.emit(Tt.created,a)},this.resolve=async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const n=await this.getRecord(i.id);typeof n.response>"u"&&(n.response=St(i)?{error:i.error}:{result:i.result},this.records.set(n.id,n),this.events.emit(Tt.updated,n))},this.get=async(i,n)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:n}),await this.getRecord(n)),this.delete=(i,n)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:n}),this.values.forEach(s=>{if(s.topic===i){if(typeof n<"u"&&s.id!==n)return;this.records.delete(s.id),this.events.emit(Tt.deleted,s)}})},this.exists=async(i,n)=>(this.isInitialized(),this.records.has(n)?(await this.getRecord(n)).topic===i:!1),this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.logger=_e.generateChildLogger(r,this.name)}get context(){return _e.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const i={topic:r.topic,request:fr(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:i}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Tt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Tt.created,e=>{const r=Tt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(Tt.updated,e=>{const r=Tt.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(Tt.deleted,e=>{const r=Tt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.core.heartbeat.on(sr.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(e=>{Q.toMiliseconds(e.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${e.id}`),this.delete(e.topic,e.id))})}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Q0 extends vl{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.expirations=new Map,this.events=new ht.exports.EventEmitter,this.name=N0,this.version=P0,this.cached=[],this.initialized=!1,this.storagePrefix=jt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=i=>{try{const n=this.formatTarget(i);return typeof this.getExpiration(n)<"u"}catch{return!1}},this.set=(i,n)=>{this.isInitialized();const s=this.formatTarget(i),a={target:s,expiry:n};this.expirations.set(s,a),this.checkExpiry(s,a),this.events.emit(wt.created,{target:s,expiration:a})},this.get=i=>{this.isInitialized();const n=this.formatTarget(i);return this.getExpiration(n)},this.del=i=>{if(this.isInitialized(),this.has(i)){const n=this.formatTarget(i),s=this.getExpiration(n);this.expirations.delete(n),this.events.emit(wt.deleted,{target:n,expiration:s})}},this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.logger=_e.generateChildLogger(r,this.name)}get context(){return _e.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return kd(e);if(typeof e=="number")return Wd(e);const{message:r}=V("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(wt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:i}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}checkExpiry(e,r){const{expiry:i}=r;Q.toMiliseconds(i)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(wt.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(sr.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(wt.created,e=>{const r=wt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(wt.expired,e=>{const r=wt.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(wt.deleted,e=>{const r=wt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Z0 extends ml{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,this.name=Un,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async()=>{if(this.verifyDisabled||Rr()||!Ar())return;const i=gi;this.verifyUrl!==i&&this.removeIframe(),this.verifyUrl=i;try{await this.createIframe()}catch(n){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(n)}if(!this.initialized){this.removeIframe(),this.verifyUrl=La;try{await this.createIframe()}catch(n){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(n),this.verifyDisabled=!0}}},this.register=async i=>{this.initialized?this.sendPost(i.attestationId):(this.addToQueue(i.attestationId),await this.init())},this.resolve=async i=>{if(this.isDevEnv)return"";const n=i?.verifyUrl||gi;let s;try{s=await this.fetchAttestation(i.attestationId,n)}catch(a){this.logger.info(`failed to resolve attestation: ${i.attestationId} from url: ${n}`),this.logger.info(a),s=await this.fetchAttestation(i.attestationId,La)}return s},this.fetchAttestation=async(i,n)=>{this.logger.info(`resolving attestation: ${i} from url: ${n}`);const s=this.startAbortTimer(Q.ONE_SECOND*2),a=await fetch(`${n}/attestation/${i}`,{signal:this.abortController.signal});return clearTimeout(s),a.status===200?await a.json():void 0},this.addToQueue=i=>{this.queue.push(i)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(i=>this.sendPost(i)),this.queue=[])},this.sendPost=i=>{var n;try{if(!this.iframe)return;(n=this.iframe.contentWindow)==null||n.postMessage(i,"*"),this.logger.info(`postMessage sent: ${i} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let i;const n=s=>{s.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",n),i())};await Promise.race([new Promise(s=>{if(document.getElementById(Un))return s();window.addEventListener("message",n);const a=document.createElement("iframe");a.id=Un,a.src=`${this.verifyUrl}/${this.projectId}`,a.style.display="none",document.body.append(a),this.iframe=a,i=s}),new Promise((s,a)=>setTimeout(()=>{window.removeEventListener("message",n),a("verify iframe load timeout")},Q.toMiliseconds(Q.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.logger=_e.generateChildLogger(r,this.name),this.verifyUrl=gi,this.abortController=new AbortController,this.isDevEnv=wn()&&process.env.IS_VITEST}get context(){return _e.getLoggerContext(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),Q.toMiliseconds(e))}}var e_=Object.defineProperty,za=Object.getOwnPropertySymbols,t_=Object.prototype.hasOwnProperty,r_=Object.prototype.propertyIsEnumerable,Ha=(t,e,r)=>e in t?e_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ka=(t,e)=>{for(var r in e||(e={}))t_.call(e,r)&&Ha(t,r,e[r]);if(za)for(var r of za(e))r_.call(e,r)&&Ha(t,r,e[r]);return t};class Mn extends dl{constructor(e){super(e),this.protocol=Na,this.version=i0,this.name=Fn,this.events=new ht.exports.EventEmitter,this.initialized=!1,this.on=(i,n)=>this.events.on(i,n),this.once=(i,n)=>this.events.once(i,n),this.off=(i,n)=>this.events.off(i,n),this.removeListener=(i,n)=>this.events.removeListener(i,n),this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||Aa,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const r=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:_e.pino(_e.getDefaultLoggerOptions({level:e?.logger||n0.logger}));this.logger=_e.generateChildLogger(r,this.name),this.heartbeat=new sr.HeartBeat,this.crypto=new A0(this,this.logger,e?.keychain),this.history=new J0(this,this.logger),this.expirer=new Q0(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Hc(Ka(Ka({},s0),e?.storageOptions)),this.relayer=new G0({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new X0(this,this.logger),this.verify=new Z0(this.projectId||"",this.logger)}static async init(e){const r=new Mn(e);await r.initialize();const i=await r.crypto.getClientId();return await r.storage.setItem(m0,i),r}get context(){return _e.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const i_=Mn,jn="wc",qn=2,Bn="client",_i=`${jn}@${qn}:${Bn}:`,bi={name:Bn,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},n_={session_proposal:"session_proposal",session_update:"session_update",session_extend:"session_extend",session_ping:"session_ping",session_delete:"session_delete",session_expire:"session_expire",session_request:"session_request",session_request_sent:"session_request_sent",session_event:"session_event",proposal_expire:"proposal_expire"},s_={database:":memory:"},zn="WALLETCONNECT_DEEPLINK_CHOICE",o_={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},a_="history",c_="0.3",Va="proposal",u_=Q.THIRTY_DAYS,Ga="Proposal expired",ka="session",Hr=Q.SEVEN_DAYS,Wa="engine",dr={wc_sessionPropose:{req:{ttl:Q.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:1104},res:{ttl:Q.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:1106},res:{ttl:Q.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:Q.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:Q.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:Q.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:Q.ONE_DAY,prompt:!1,tag:1112},res:{ttl:Q.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:Q.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:Q.THIRTY_SECONDS,prompt:!1,tag:1115}}},wi={min:Q.FIVE_MINUTES,max:Q.SEVEN_DAYS},Nt={idle:"IDLE",active:"ACTIVE"},Ya="request",Xa=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var l_=Object.defineProperty,h_=Object.defineProperties,f_=Object.getOwnPropertyDescriptors,Ja=Object.getOwnPropertySymbols,d_=Object.prototype.hasOwnProperty,p_=Object.prototype.propertyIsEnumerable,Qa=(t,e,r)=>e in t?l_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,pt=(t,e)=>{for(var r in e||(e={}))d_.call(e,r)&&Qa(t,r,e[r]);if(Ja)for(var r of Ja(e))p_.call(e,r)&&Qa(t,r,e[r]);return t},Kr=(t,e)=>h_(t,f_(e));class g_ extends Sl{constructor(e){super(e),this.name=Wa,this.events=new ht.exports,this.initialized=!1,this.ignoredPayloadTypes=[Jt],this.requestQueue={state:Nt.idle,queue:[]},this.sessionRequestQueue={state:Nt.idle,queue:[]},this.requestQueueDelay=Q.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(dr)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},Q.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const i=Kr(pt({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(i);const{pairingTopic:n,requiredNamespaces:s,optionalNamespaces:a,sessionProperties:c,relays:h}=i;let l=n,d,w=!1;if(l&&(w=this.client.core.pairing.pairings.get(l).active),!l||!w){const{topic:I,uri:_}=await this.client.core.pairing.create();l=I,d=_}const y=await this.client.core.crypto.generateKeyPair(),m=pt({requiredNamespaces:s,optionalNamespaces:a,relays:h??[{protocol:Ra}],proposer:{publicKey:y,metadata:this.client.metadata}},c&&{sessionProperties:c}),{reject:S,resolve:R,done:A}=lr(Q.FIVE_MINUTES,Ga);if(this.events.once(Ue("session_connect"),async({error:I,session:_})=>{if(I)S(I);else if(_){_.self.publicKey=y;const v=Kr(pt({},_),{requiredNamespaces:_.requiredNamespaces,optionalNamespaces:_.optionalNamespaces});await this.client.session.set(_.topic,v),await this.setExpiry(_.topic,_.expiry),l&&await this.client.core.pairing.updateMetadata({topic:l,metadata:_.peer.metadata}),R(v)}}),!l){const{message:I}=V("NO_MATCHING_KEY",`connect() pairing topic: ${l}`);throw new Error(I)}const z=await this.sendRequest({topic:l,method:"wc_sessionPropose",params:m}),E=Et(Q.FIVE_MINUTES);return await this.setProposal(z,pt({id:z,expiry:E},m)),{uri:d,approval:A}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:i,relayProtocol:n,namespaces:s,sessionProperties:a}=r,c=this.client.proposal.get(i);let{pairingTopic:h,proposer:l,requiredNamespaces:d,optionalNamespaces:w}=c;h=h||"",Ur(d)||(d=up(s,"approve()"));const y=await this.client.core.crypto.generateKeyPair(),m=l.publicKey,S=await this.client.core.crypto.generateSharedKey(y,m);h&&i&&(await this.client.core.pairing.updateMetadata({topic:h,metadata:l.metadata}),await this.sendResult({id:i,topic:h,result:{relay:{protocol:n??"irn"},responderPublicKey:y}}),await this.client.proposal.delete(i,He("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:h}));const R=pt({relay:{protocol:n??"irn"},namespaces:s,requiredNamespaces:d,optionalNamespaces:w,pairingTopic:h,controller:{publicKey:y,metadata:this.client.metadata},expiry:Et(Hr)},a&&{sessionProperties:a});await this.client.core.relayer.subscribe(S),await this.sendRequest({topic:S,method:"wc_sessionSettle",params:R,throwOnFailedPublish:!0});const A=Kr(pt({},R),{topic:S,pairingTopic:h,acknowledged:!1,self:R.controller,peer:{publicKey:l.publicKey,metadata:l.metadata},controller:y});return await this.client.session.set(S,A),await this.setExpiry(S,Et(Hr)),{topic:S,acknowledged:()=>new Promise(z=>setTimeout(()=>z(this.client.session.get(S)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:i,reason:n}=r,{pairingTopic:s}=this.client.proposal.get(i);s&&(await this.sendError(i,s,n),await this.client.proposal.delete(i,He("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:i,namespaces:n}=r,s=await this.sendRequest({topic:i,method:"wc_sessionUpdate",params:{namespaces:n}}),{done:a,resolve:c,reject:h}=lr();return this.events.once(Ue("session_update",s),({error:l})=>{l?h(l):c()}),await this.client.session.update(i,{namespaces:n}),{acknowledged:a}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:i}=r,n=await this.sendRequest({topic:i,method:"wc_sessionExtend",params:{}}),{done:s,resolve:a,reject:c}=lr();return this.events.once(Ue("session_extend",n),({error:h})=>{h?c(h):a()}),await this.setExpiry(i,Et(Hr)),{acknowledged:s}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:i,request:n,topic:s,expiry:a}=r,c=In(),{done:h,resolve:l,reject:d}=lr(a,"Request expired. Please try again.");return this.events.once(Ue("session_request",c),({error:w,result:y})=>{w?d(w):l(y)}),await Promise.all([new Promise(async w=>{await this.sendRequest({clientRpcId:c,topic:s,method:"wc_sessionRequest",params:{request:n,chainId:i},expiry:a,throwOnFailedPublish:!0}).catch(y=>d(y)),this.client.events.emit("session_request_sent",{topic:s,request:n,chainId:i,id:c}),w()}),new Promise(async w=>{const y=await this.client.core.storage.getItem(zn);Yd({id:c,topic:s,wcDeepLink:y}),w()}),h()]).then(w=>w[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:i,response:n}=r,{id:s}=n;Ct(n)?await this.sendResult({id:s,topic:i,result:n.result,throwOnFailedPublish:!0}):St(n)&&await this.sendError(s,i,n.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:i}=r;if(this.client.session.keys.includes(i)){const n=await this.sendRequest({topic:i,method:"wc_sessionPing",params:{}}),{done:s,resolve:a,reject:c}=lr();this.events.once(Ue("session_ping",n),({error:h})=>{h?c(h):a()}),await s()}else this.client.core.pairing.pairings.keys.includes(i)&&await this.client.core.pairing.ping({topic:i})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:i,event:n,chainId:s}=r;await this.sendRequest({topic:i,method:"wc_sessionEvent",params:{event:n,chainId:s}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:i}=r;this.client.session.keys.includes(i)?(await this.sendRequest({topic:i,method:"wc_sessionDelete",params:He("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(i)):await this.client.core.pairing.disconnect({topic:i})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(i=>fp(i,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const i=this.client.core.pairing.pairings.get(r.pairingTopic),n=this.client.core.pairing.pairings.getAll().filter(s=>{var a,c;return((a=s.peerMetadata)==null?void 0:a.url)&&((c=s.peerMetadata)==null?void 0:c.url)===r.peer.metadata.url&&s.topic&&s.topic!==i.topic});if(n.length===0)return;this.client.logger.info(`Cleaning up ${n.length} duplicate pairing(s)`),await Promise.all(n.map(s=>this.client.core.pairing.disconnect({topic:s.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(i){this.client.logger.error(i)}},this.deleteSession=async(r,i)=>{const{self:n}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,He("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(n.publicKey)&&await this.client.core.crypto.deleteKeyPair(n.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),i||this.client.core.expirer.del(r),this.client.core.storage.removeItem(zn).catch(s=>this.client.logger.warn(s))},this.deleteProposal=async(r,i)=>{await Promise.all([this.client.proposal.delete(r,He("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,i,n=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,i),n?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(s=>s.id!==r),n&&(this.sessionRequestQueue.state=Nt.idle)},this.setExpiry=async(r,i)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:i}),this.client.core.expirer.set(r,i)},this.setProposal=async(r,i)=>{await this.client.proposal.set(r,i),this.client.core.expirer.set(r,i.expiry)},this.setPendingSessionRequest=async r=>{const i=dr.wc_sessionRequest.req.ttl,{id:n,topic:s,params:a,verifyContext:c}=r;await this.client.pendingRequest.set(n,{id:n,topic:s,params:a,verifyContext:c}),i&&this.client.core.expirer.set(n,Et(i))},this.sendRequest=async r=>{const{topic:i,method:n,params:s,expiry:a,relayRpcId:c,clientRpcId:h,throwOnFailedPublish:l}=r,d=fr(n,s,h);if(Ar()&&Xa.includes(n)){const m=ur(JSON.stringify(d));this.client.core.verify.register({attestationId:m})}const w=await this.client.core.crypto.encode(i,d),y=dr[n].req;return a&&(y.ttl=a),c&&(y.id=c),this.client.core.history.set(i,d),l?(y.internal=Kr(pt({},y.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,w,y)):this.client.core.relayer.publish(i,w,y).catch(m=>this.client.logger.error(m)),d.id},this.sendResult=async r=>{const{id:i,topic:n,result:s,throwOnFailedPublish:a}=r,c=Tn(i,s),h=await this.client.core.crypto.encode(n,c),l=await this.client.core.history.get(n,i),d=dr[l.request.method].res;a?(d.internal=Kr(pt({},d.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,h,d)):this.client.core.relayer.publish(n,h,d).catch(w=>this.client.logger.error(w)),await this.client.core.history.resolve(c)},this.sendError=async(r,i,n)=>{const s=Nn(r,n),a=await this.client.core.crypto.encode(i,s),c=await this.client.core.history.get(i,r),h=dr[c.request.method].res;this.client.core.relayer.publish(i,a,h),await this.client.core.history.resolve(s)},this.cleanup=async()=>{const r=[],i=[];this.client.session.getAll().forEach(n=>{Mt(n.expiry)&&r.push(n.topic)}),this.client.proposal.getAll().forEach(n=>{Mt(n.expiry)&&i.push(n.id)}),await Promise.all([...r.map(n=>this.deleteSession(n)),...i.map(n=>this.deleteProposal(n))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===Nt.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Nt.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(i=>setTimeout(i,300))}catch(i){this.client.logger.warn(i)}}this.requestQueue.state=Nt.idle},this.processRequest=r=>{const{topic:i,payload:n}=r,s=n.method;switch(s){case"wc_sessionPropose":return this.onSessionProposeRequest(i,n);case"wc_sessionSettle":return this.onSessionSettleRequest(i,n);case"wc_sessionUpdate":return this.onSessionUpdateRequest(i,n);case"wc_sessionExtend":return this.onSessionExtendRequest(i,n);case"wc_sessionPing":return this.onSessionPingRequest(i,n);case"wc_sessionDelete":return this.onSessionDeleteRequest(i,n);case"wc_sessionRequest":return this.onSessionRequest(i,n);case"wc_sessionEvent":return this.onSessionEventRequest(i,n);default:return this.client.logger.info(`Unsupported request method ${s}`)}},this.onRelayEventResponse=async r=>{const{topic:i,payload:n}=r,s=(await this.client.core.history.get(i,n.id)).request.method;switch(s){case"wc_sessionPropose":return this.onSessionProposeResponse(i,n);case"wc_sessionSettle":return this.onSessionSettleResponse(i,n);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,n);case"wc_sessionExtend":return this.onSessionExtendResponse(i,n);case"wc_sessionPing":return this.onSessionPingResponse(i,n);case"wc_sessionRequest":return this.onSessionRequestResponse(i,n);default:return this.client.logger.info(`Unsupported response method ${s}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:i}=r,{message:n}=V("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(n)},this.onSessionProposeRequest=async(r,i)=>{const{params:n,id:s}=i;try{this.isValidConnect(pt({},i.params));const a=Et(Q.FIVE_MINUTES),c=pt({id:s,pairingTopic:r,expiry:a},n);await this.setProposal(s,c);const h=ur(JSON.stringify(i)),l=await this.getVerifyContext(h,c.proposer.metadata);this.client.events.emit("session_proposal",{id:s,params:c,verifyContext:l})}catch(a){await this.sendError(s,r,a),this.client.logger.error(a)}},this.onSessionProposeResponse=async(r,i)=>{const{id:n}=i;if(Ct(i)){const{result:s}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:s});const a=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const h=s.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:h});const l=await this.client.core.crypto.generateSharedKey(c,h);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:l});const d=await this.client.core.relayer.subscribe(l);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:d}),await this.client.core.pairing.activate({topic:r})}else St(i)&&(await this.client.proposal.delete(n,He("USER_DISCONNECTED")),this.events.emit(Ue("session_connect"),{error:i.error}))},this.onSessionSettleRequest=async(r,i)=>{const{id:n,params:s}=i;try{this.isValidSessionSettleRequest(s);const{relay:a,controller:c,expiry:h,namespaces:l,requiredNamespaces:d,optionalNamespaces:w,sessionProperties:y,pairingTopic:m}=i.params,S=pt({topic:r,relay:a,expiry:h,namespaces:l,acknowledged:!0,pairingTopic:m,requiredNamespaces:d,optionalNamespaces:w,controller:c.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:c.publicKey,metadata:c.metadata}},y&&{sessionProperties:y});await this.sendResult({id:i.id,topic:r,result:!0}),this.events.emit(Ue("session_connect"),{session:S}),this.cleanupDuplicatePairings(S)}catch(a){await this.sendError(n,r,a),this.client.logger.error(a)}},this.onSessionSettleResponse=async(r,i)=>{const{id:n}=i;Ct(i)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Ue("session_approve",n),{})):St(i)&&(await this.client.session.delete(r,He("USER_DISCONNECTED")),this.events.emit(Ue("session_approve",n),{error:i.error}))},this.onSessionUpdateRequest=async(r,i)=>{const{params:n,id:s}=i;try{const a=`${r}_session_update`,c=fi.get(a);if(c&&this.isRequestOutOfSync(c,s)){this.client.logger.info(`Discarding out of sync request - ${s}`);return}this.isValidUpdate(pt({topic:r},n)),await this.client.session.update(r,{namespaces:n.namespaces}),await this.sendResult({id:s,topic:r,result:!0}),this.client.events.emit("session_update",{id:s,topic:r,params:n}),fi.set(a,s)}catch(a){await this.sendError(s,r,a),this.client.logger.error(a)}},this.isRequestOutOfSync=(r,i)=>parseInt(i.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,i)=>{const{id:n}=i;Ct(i)?this.events.emit(Ue("session_update",n),{}):St(i)&&this.events.emit(Ue("session_update",n),{error:i.error})},this.onSessionExtendRequest=async(r,i)=>{const{id:n}=i;try{this.isValidExtend({topic:r}),await this.setExpiry(r,Et(Hr)),await this.sendResult({id:n,topic:r,result:!0}),this.client.events.emit("session_extend",{id:n,topic:r})}catch(s){await this.sendError(n,r,s),this.client.logger.error(s)}},this.onSessionExtendResponse=(r,i)=>{const{id:n}=i;Ct(i)?this.events.emit(Ue("session_extend",n),{}):St(i)&&this.events.emit(Ue("session_extend",n),{error:i.error})},this.onSessionPingRequest=async(r,i)=>{const{id:n}=i;try{this.isValidPing({topic:r}),await this.sendResult({id:n,topic:r,result:!0}),this.client.events.emit("session_ping",{id:n,topic:r})}catch(s){await this.sendError(n,r,s),this.client.logger.error(s)}},this.onSessionPingResponse=(r,i)=>{const{id:n}=i;setTimeout(()=>{Ct(i)?this.events.emit(Ue("session_ping",n),{}):St(i)&&this.events.emit(Ue("session_ping",n),{error:i.error})},500)},this.onSessionDeleteRequest=async(r,i)=>{const{id:n}=i;try{this.isValidDisconnect({topic:r,reason:i.params}),await Promise.all([new Promise(s=>{this.client.core.relayer.once(nt.publish,async()=>{s(await this.deleteSession(r))})}),this.sendResult({id:n,topic:r,result:!0})]),this.client.events.emit("session_delete",{id:n,topic:r})}catch(s){this.client.logger.error(s)}},this.onSessionRequest=async(r,i)=>{const{id:n,params:s}=i;try{this.isValidRequest(pt({topic:r},s));const a=ur(JSON.stringify(fr("wc_sessionRequest",s,n))),c=this.client.session.get(r),h=await this.getVerifyContext(a,c.peer.metadata),l={id:n,topic:r,params:s,verifyContext:h};await this.setPendingSessionRequest(l),this.addSessionRequestToSessionRequestQueue(l),this.processSessionRequestQueue()}catch(a){await this.sendError(n,r,a),this.client.logger.error(a)}},this.onSessionRequestResponse=(r,i)=>{const{id:n}=i;Ct(i)?this.events.emit(Ue("session_request",n),{result:i.result}):St(i)&&this.events.emit(Ue("session_request",n),{error:i.error})},this.onSessionEventRequest=async(r,i)=>{const{id:n,params:s}=i;try{const a=`${r}_session_event_${s.event.name}`,c=fi.get(a);if(c&&this.isRequestOutOfSync(c,n)){this.client.logger.info(`Discarding out of sync request - ${n}`);return}this.isValidEmit(pt({topic:r},s)),this.client.events.emit("session_event",{id:n,topic:r,params:s}),fi.set(a,n)}catch(a){await this.sendError(n,r,a),this.client.logger.error(a)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Nt.idle,this.processSessionRequestQueue()},Q.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===Nt.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=Nt.active,this.client.events.emit("session_request",r)}catch(i){this.client.logger.error(i)}},this.onPairingCreated=r=>{if(r.active)return;const i=this.client.proposal.getAll().find(n=>n.pairingTopic===r.topic);i&&this.onSessionProposeRequest(r.topic,fr("wc_sessionPropose",{requiredNamespaces:i.requiredNamespaces,optionalNamespaces:i.optionalNamespaces,relays:i.relays,proposer:i.proposer},i.id))},this.isValidConnect=async r=>{if(!dt(r)){const{message:h}=V("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(h)}const{pairingTopic:i,requiredNamespaces:n,optionalNamespaces:s,sessionProperties:a,relays:c}=r;if(ut(i)||await this.isValidPairingTopic(i),!Dp(c,!0)){const{message:h}=V("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(h)}!ut(n)&&Ur(n)!==0&&this.validateNamespaces(n,"requiredNamespaces"),!ut(s)&&Ur(s)!==0&&this.validateNamespaces(s,"optionalNamespaces"),ut(a)||this.validateSessionProps(a,"sessionProperties")},this.validateNamespaces=(r,i)=>{const n=Sp(r,"connect()",i);if(n)throw new Error(n.message)},this.isValidApprove=async r=>{if(!dt(r))throw new Error(V("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:i,namespaces:n,relayProtocol:s,sessionProperties:a}=r;await this.isValidProposalId(i);const c=this.client.proposal.get(i),h=hi(n,"approve()");if(h)throw new Error(h.message);const l=Yo(c.requiredNamespaces,n,"approve()");if(l)throw new Error(l.message);if(!Ke(s,!0)){const{message:d}=V("MISSING_OR_INVALID",`approve() relayProtocol: ${s}`);throw new Error(d)}ut(a)||this.validateSessionProps(a,"sessionProperties")},this.isValidReject=async r=>{if(!dt(r)){const{message:s}=V("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(s)}const{id:i,reason:n}=r;if(await this.isValidProposalId(i),!xp(n)){const{message:s}=V("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(n)}`);throw new Error(s)}},this.isValidSessionSettleRequest=r=>{if(!dt(r)){const{message:l}=V("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(l)}const{relay:i,controller:n,namespaces:s,expiry:a}=r;if(!ko(i)){const{message:l}=V("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const c=_p(n,"onSessionSettleRequest()");if(c)throw new Error(c.message);const h=hi(s,"onSessionSettleRequest()");if(h)throw new Error(h.message);if(Mt(a)){const{message:l}=V("EXPIRED","onSessionSettleRequest()");throw new Error(l)}},this.isValidUpdate=async r=>{if(!dt(r)){const{message:h}=V("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(h)}const{topic:i,namespaces:n}=r;await this.isValidSessionTopic(i);const s=this.client.session.get(i),a=hi(n,"update()");if(a)throw new Error(a.message);const c=Yo(s.requiredNamespaces,n,"update()");if(c)throw new Error(c.message)},this.isValidExtend=async r=>{if(!dt(r)){const{message:n}=V("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionTopic(i)},this.isValidRequest=async r=>{if(!dt(r)){const{message:h}=V("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(h)}const{topic:i,request:n,chainId:s,expiry:a}=r;await this.isValidSessionTopic(i);const{namespaces:c}=this.client.session.get(i);if(!Wo(c,s)){const{message:h}=V("MISSING_OR_INVALID",`request() chainId: ${s}`);throw new Error(h)}if(!Ip(n)){const{message:h}=V("MISSING_OR_INVALID",`request() ${JSON.stringify(n)}`);throw new Error(h)}if(!Pp(c,s,n.method)){const{message:h}=V("MISSING_OR_INVALID",`request() method: ${n.method}`);throw new Error(h)}if(a&&!Lp(a,wi)){const{message:h}=V("MISSING_OR_INVALID",`request() expiry: ${a}. Expiry must be a number (in seconds) between ${wi.min} and ${wi.max}`);throw new Error(h)}},this.isValidRespond=async r=>{if(!dt(r)){const{message:s}=V("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(s)}const{topic:i,response:n}=r;if(await this.isValidSessionTopic(i),!Tp(n)){const{message:s}=V("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(s)}},this.isValidPing=async r=>{if(!dt(r)){const{message:n}=V("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)},this.isValidEmit=async r=>{if(!dt(r)){const{message:c}=V("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(c)}const{topic:i,event:n,chainId:s}=r;await this.isValidSessionTopic(i);const{namespaces:a}=this.client.session.get(i);if(!Wo(a,s)){const{message:c}=V("MISSING_OR_INVALID",`emit() chainId: ${s}`);throw new Error(c)}if(!Np(n)){const{message:c}=V("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(c)}if(!Rp(a,s,n.name)){const{message:c}=V("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(c)}},this.isValidDisconnect=async r=>{if(!dt(r)){const{message:n}=V("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)},this.getVerifyContext=async(r,i)=>{const n={verified:{verifyUrl:i.verifyUrl||gi,validation:"UNKNOWN",origin:i.url||""}};try{const s=await this.client.core.verify.resolve({attestationId:r,verifyUrl:i.verifyUrl});s&&(n.verified.origin=s.origin,n.verified.isScam=s.isScam,n.verified.validation=s.origin===new URL(i.url).origin?"VALID":"INVALID")}catch(s){this.client.logger.info(s)}return this.client.logger.info(`Verify context: ${JSON.stringify(n)}`),n},this.validateSessionProps=(r,i)=>{Object.values(r).forEach(n=>{if(!Ke(n,!1)){const{message:s}=V("MISSING_OR_INVALID",`${i} must be in Record<string, string> format. Received: ${JSON.stringify(n)}`);throw new Error(s)}})}}async isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(nt.message,async e=>{const{topic:r,message:i}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(i)))return;const n=await this.client.core.crypto.decode(r,i);try{Pn(n)?(this.client.core.history.set(r,n),this.onRelayEventRequest({topic:r,payload:n})):di(n)?(await this.client.core.history.resolve(n),await this.onRelayEventResponse({topic:r,payload:n}),this.client.core.history.delete(r,n.id)):this.onRelayEventUnknownPayload({topic:r,payload:n})}catch(s){this.client.logger.error(s)}})}registerExpirerEvents(){this.client.core.expirer.on(wt.expired,async e=>{const{topic:r,id:i}=zo(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,V("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}registerPairingEvents(){this.client.core.pairing.events.on(Br.create,e=>this.onPairingCreated(e))}isValidPairingTopic(e){if(!Ke(e,!1)){const{message:r}=V("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=V("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(Mt(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=V("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!Ke(e,!1)){const{message:r}=V("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(!this.client.session.keys.includes(e)){const{message:r}=V("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(Mt(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:r}=V("EXPIRED",`session topic: ${e}`);throw new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(Ke(e,!1)){const{message:r}=V("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=V("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!Op(e)){const{message:r}=V("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=V("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(Mt(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:r}=V("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}}class y_ extends yi{constructor(e,r){super(e,r,Va,_i),this.core=e,this.logger=r}}class __ extends yi{constructor(e,r){super(e,r,ka,_i),this.core=e,this.logger=r}}class b_ extends yi{constructor(e,r){super(e,r,Ya,_i,i=>i.id),this.core=e,this.logger=r}}class vi extends El{constructor(e){super(e),this.protocol=jn,this.version=qn,this.name=bi.name,this.events=new ht.exports.EventEmitter,this.on=(i,n)=>this.events.on(i,n),this.once=(i,n)=>this.events.once(i,n),this.off=(i,n)=>this.events.off(i,n),this.removeListener=(i,n)=>this.events.removeListener(i,n),this.removeAllListeners=i=>this.events.removeAllListeners(i),this.connect=async i=>{try{return await this.engine.connect(i)}catch(n){throw this.logger.error(n.message),n}},this.pair=async i=>{try{return await this.engine.pair(i)}catch(n){throw this.logger.error(n.message),n}},this.approve=async i=>{try{return await this.engine.approve(i)}catch(n){throw this.logger.error(n.message),n}},this.reject=async i=>{try{return await this.engine.reject(i)}catch(n){throw this.logger.error(n.message),n}},this.update=async i=>{try{return await this.engine.update(i)}catch(n){throw this.logger.error(n.message),n}},this.extend=async i=>{try{return await this.engine.extend(i)}catch(n){throw this.logger.error(n.message),n}},this.request=async i=>{try{return await this.engine.request(i)}catch(n){throw this.logger.error(n.message),n}},this.respond=async i=>{try{return await this.engine.respond(i)}catch(n){throw this.logger.error(n.message),n}},this.ping=async i=>{try{return await this.engine.ping(i)}catch(n){throw this.logger.error(n.message),n}},this.emit=async i=>{try{return await this.engine.emit(i)}catch(n){throw this.logger.error(n.message),n}},this.disconnect=async i=>{try{return await this.engine.disconnect(i)}catch(n){throw this.logger.error(n.message),n}},this.find=i=>{try{return this.engine.find(i)}catch(n){throw this.logger.error(n.message),n}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}},this.name=e?.name||bi.name,this.metadata=e?.metadata||zd();const r=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:_e.pino(_e.getDefaultLoggerOptions({level:e?.logger||bi.logger}));this.core=e?.core||new i_(e),this.logger=_e.generateChildLogger(r,this.name),this.session=new __(this.core,this.logger),this.proposal=new y_(this.core,this.logger),this.pendingRequest=new b_(this.core,this.logger),this.engine=new g_(this)}static async init(e){const r=new vi(e);return await r.initialize(),r}get context(){return _e.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}const w_=vi;Oe.ENGINE_CONTEXT=Wa,Oe.ENGINE_QUEUE_STATES=Nt,Oe.ENGINE_RPC_OPTS=dr,Oe.HISTORY_CONTEXT=a_,Oe.HISTORY_EVENTS=o_,Oe.HISTORY_STORAGE_VERSION=c_,Oe.METHODS_TO_VERIFY=Xa,Oe.PROPOSAL_CONTEXT=Va,Oe.PROPOSAL_EXPIRY=u_,Oe.PROPOSAL_EXPIRY_MESSAGE=Ga,Oe.REQUEST_CONTEXT=Ya,Oe.SESSION_CONTEXT=ka,Oe.SESSION_EXPIRY=Hr,Oe.SESSION_REQUEST_EXPIRY_BOUNDARIES=wi,Oe.SIGN_CLIENT_CONTEXT=Bn,Oe.SIGN_CLIENT_DEFAULT=bi,Oe.SIGN_CLIENT_EVENTS=n_,Oe.SIGN_CLIENT_PROTOCOL=jn,Oe.SIGN_CLIENT_STORAGE_OPTIONS=s_,Oe.SIGN_CLIENT_STORAGE_PREFIX=_i,Oe.SIGN_CLIENT_VERSION=qn,Oe.SignClient=w_,Oe.WALLETCONNECT_DEEPLINK_CHOICE=zn,Oe.default=vi,Object.defineProperty(Oe,"__esModule",{value:!0})});
//# sourceMappingURL=index.umd.js.map
