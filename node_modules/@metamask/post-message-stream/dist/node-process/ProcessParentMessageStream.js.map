{"version":3,"file":"ProcessParentMessageStream.js","sourceRoot":"","sources":["../../src/node-process/ProcessParentMessageStream.ts"],"names":[],"mappings":";;;AACA,oEAAiE;AACjE,oCAA4D;AAM5D;;GAEG;AACH,MAAa,0BAA2B,SAAQ,6CAAqB;IAGnE;;;;;OAKG;IACH,YAAY,EAAE,OAAO,EAAkC;QACrD,KAAK,EAAE,CAAC;QAER,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;QACxB,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC7C,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,SAAS,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QAE7C,IAAI,CAAC,UAAU,EAAE,CAAC;IACpB,CAAC;IAES,YAAY,CAAC,IAAgB;QACrC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE,IAAI,EAAE,CAAC,CAAC;IAC/B,CAAC;IAEO,UAAU,CAAC,OAAgB;QACjC,IAAI,CAAC,IAAA,4BAAoB,EAAC,OAAO,CAAC,EAAE;YAClC,OAAO;SACR;QAED,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;IAC7B,CAAC;IAED,QAAQ;QACN,IAAI,CAAC,QAAQ,CAAC,cAAc,CAAC,SAAS,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;IAC3D,CAAC;CACF;AAlCD,gEAkCC","sourcesContent":["import type { ChildProcess } from 'child_process';\nimport { BasePostMessageStream } from '../BasePostMessageStream';\nimport { isValidStreamMessage, StreamData } from '../utils';\n\ninterface ProcessParentMessageStreamArgs {\n  process: ChildProcess;\n}\n\n/**\n * Parent-side Node.js `child_process` stream.\n */\nexport class ProcessParentMessageStream extends BasePostMessageStream {\n  private _process: ChildProcess;\n\n  /**\n   * Creates a stream for communicating with a Node.js `child_process` process.\n   *\n   * @param args - Options bag.\n   * @param args.process - The process to communicate with.\n   */\n  constructor({ process }: ProcessParentMessageStreamArgs) {\n    super();\n\n    this._process = process;\n    this._onMessage = this._onMessage.bind(this);\n    this._process.on('message', this._onMessage);\n\n    this._handshake();\n  }\n\n  protected _postMessage(data: StreamData): void {\n    this._process.send({ data });\n  }\n\n  private _onMessage(message: unknown): void {\n    if (!isValidStreamMessage(message)) {\n      return;\n    }\n\n    this._onData(message.data);\n  }\n\n  _destroy(): void {\n    this._process.removeListener('message', this._onMessage);\n  }\n}\n"]}