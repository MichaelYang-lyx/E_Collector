{"version":3,"file":"ProcessMessageStream.js","sourceRoot":"","sources":["../../src/node-process/ProcessMessageStream.ts"],"names":[],"mappings":";;;AAAA,oEAAiE;AACjE,oCAA4D;AAE5D;;GAEG;AACH,MAAa,oBAAqB,SAAQ,6CAAqB;IAC7D;QACE,KAAK,EAAE,CAAC;QAER,IAAI,OAAO,UAAU,CAAC,OAAO,CAAC,IAAI,KAAK,UAAU,EAAE;YACjD,MAAM,IAAI,KAAK,CACb,kGAAkG,CACnG,CAAC;SACH;QAED,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC7C,UAAU,CAAC,OAAO,CAAC,EAAE,CAAC,SAAS,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QAElD,IAAI,CAAC,UAAU,EAAE,CAAC;IACpB,CAAC;IAES,YAAY,CAAC,IAAgB;QACrC,oEAAoE;QACpE,UAAU,CAAC,OAAO,CAAC,IAAK,CAAC,EAAE,IAAI,EAAE,CAAC,CAAC;IACrC,CAAC;IAEO,UAAU,CAAC,OAAgB;QACjC,IAAI,CAAC,IAAA,4BAAoB,EAAC,OAAO,CAAC,EAAE;YAClC,OAAO;SACR;QAED,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;IAC7B,CAAC;IAED,QAAQ;QACN,UAAU,CAAC,OAAO,CAAC,cAAc,CAAC,SAAS,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;IAChE,CAAC;CACF;AAhCD,oDAgCC","sourcesContent":["import { BasePostMessageStream } from '../BasePostMessageStream';\nimport { isValidStreamMessage, StreamData } from '../utils';\n\n/**\n * Child process-side Node.js `child_process` stream.\n */\nexport class ProcessMessageStream extends BasePostMessageStream {\n  constructor() {\n    super();\n\n    if (typeof globalThis.process.send !== 'function') {\n      throw new Error(\n        'Parent IPC channel not found. This class should only be instantiated in a Node.js child process.',\n      );\n    }\n\n    this._onMessage = this._onMessage.bind(this);\n    globalThis.process.on('message', this._onMessage);\n\n    this._handshake();\n  }\n\n  protected _postMessage(data: StreamData): void {\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    globalThis.process.send!({ data });\n  }\n\n  private _onMessage(message: unknown): void {\n    if (!isValidStreamMessage(message)) {\n      return;\n    }\n\n    this._onData(message.data);\n  }\n\n  _destroy(): void {\n    globalThis.process.removeListener('message', this._onMessage);\n  }\n}\n"]}