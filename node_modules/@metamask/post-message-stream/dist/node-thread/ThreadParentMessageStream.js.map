{"version":3,"file":"ThreadParentMessageStream.js","sourceRoot":"","sources":["../../src/node-thread/ThreadParentMessageStream.ts"],"names":[],"mappings":";;;AACA,oEAAiE;AACjE,oCAA4D;AAM5D;;GAEG;AACH,MAAa,yBAA0B,SAAQ,6CAAqB;IAGlE;;;;;OAKG;IACH,YAAY,EAAE,MAAM,EAAiC;QACnD,KAAK,EAAE,CAAC;QAER,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;QACtB,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC7C,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,SAAS,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QAE5C,IAAI,CAAC,UAAU,EAAE,CAAC;IACpB,CAAC;IAES,YAAY,CAAC,IAAgB;QACrC,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,EAAE,IAAI,EAAE,CAAC,CAAC;IACrC,CAAC;IAEO,UAAU,CAAC,OAAgB;QACjC,IAAI,CAAC,IAAA,4BAAoB,EAAC,OAAO,CAAC,EAAE;YAClC,OAAO;SACR;QAED,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;IAC7B,CAAC;IAED,QAAQ;QACN,IAAI,CAAC,OAAO,CAAC,cAAc,CAAC,SAAS,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;IAC1D,CAAC;CACF;AAlCD,8DAkCC","sourcesContent":["import { Worker } from 'worker_threads';\nimport { BasePostMessageStream } from '../BasePostMessageStream';\nimport { isValidStreamMessage, StreamData } from '../utils';\n\ninterface ThreadParentMessageStreamArgs {\n  thread: Worker;\n}\n\n/**\n * Parent-side Node.js `worker_threads` stream.\n */\nexport class ThreadParentMessageStream extends BasePostMessageStream {\n  private _thread: Worker;\n\n  /**\n   * Creates a stream for communicating with a Node.js `worker_threads` thread.\n   *\n   * @param args - Options bag.\n   * @param args.thread - The thread to communicate with.\n   */\n  constructor({ thread }: ThreadParentMessageStreamArgs) {\n    super();\n\n    this._thread = thread;\n    this._onMessage = this._onMessage.bind(this);\n    this._thread.on('message', this._onMessage);\n\n    this._handshake();\n  }\n\n  protected _postMessage(data: StreamData): void {\n    this._thread.postMessage({ data });\n  }\n\n  private _onMessage(message: unknown): void {\n    if (!isValidStreamMessage(message)) {\n      return;\n    }\n\n    this._onData(message.data);\n  }\n\n  _destroy(): void {\n    this._thread.removeListener('message', this._onMessage);\n  }\n}\n"]}