{"version":3,"file":"ThreadMessageStream.js","sourceRoot":"","sources":["../../src/node-thread/ThreadMessageStream.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;AAAA,mDAA4C;AAC5C,oEAAiE;AACjE,oCAA4D;AAE5D;;GAEG;AACH,MAAa,mBAAoB,SAAQ,6CAAqB;IAG5D;QACE,KAAK,EAAE,CAAC;QAHV,kDAA8C;QAK5C,IAAI,CAAC,2BAAU,EAAE;YACf,MAAM,IAAI,KAAK,CACb,2FAA2F,CAC5F,CAAC;SACH;QAED,uBAAA,IAAI,mCAAe,2BAAU,MAAA,CAAC;QAE9B,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC7C,uBAAA,IAAI,uCAAY,CAAC,EAAE,CAAC,SAAS,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QAEhD,IAAI,CAAC,UAAU,EAAE,CAAC;IACpB,CAAC;IAES,YAAY,CAAC,IAAgB;QACrC,uBAAA,IAAI,uCAAY,CAAC,WAAW,CAAC,EAAE,IAAI,EAAE,CAAC,CAAC;IACzC,CAAC;IAEO,UAAU,CAAC,OAAgB;QACjC,IAAI,CAAC,IAAA,4BAAoB,EAAC,OAAO,CAAC,EAAE;YAClC,OAAO;SACR;QAED,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;IAC7B,CAAC;IAED,QAAQ;QACN,uBAAA,IAAI,uCAAY,CAAC,cAAc,CAAC,SAAS,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;IAC9D,CAAC;CACF;AAnCD,kDAmCC","sourcesContent":["import { parentPort } from 'worker_threads';\nimport { BasePostMessageStream } from '../BasePostMessageStream';\nimport { isValidStreamMessage, StreamData } from '../utils';\n\n/**\n * Child thread-side Node.js `worker_threads` stream.\n */\nexport class ThreadMessageStream extends BasePostMessageStream {\n  #parentPort: Exclude<typeof parentPort, null>;\n\n  constructor() {\n    super();\n\n    if (!parentPort) {\n      throw new Error(\n        'Parent port not found. This class should only be instantiated in a Node.js worker thread.',\n      );\n    }\n\n    this.#parentPort = parentPort;\n\n    this._onMessage = this._onMessage.bind(this);\n    this.#parentPort.on('message', this._onMessage);\n\n    this._handshake();\n  }\n\n  protected _postMessage(data: StreamData): void {\n    this.#parentPort.postMessage({ data });\n  }\n\n  private _onMessage(message: unknown): void {\n    if (!isValidStreamMessage(message)) {\n      return;\n    }\n\n    this._onData(message.data);\n  }\n\n  _destroy(): void {\n    this.#parentPort.removeListener('message', this._onMessage);\n  }\n}\n"]}